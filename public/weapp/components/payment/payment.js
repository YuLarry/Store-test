(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/payment/payment"],{3686:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}));var a={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"92aa"))},nsSwitch:function(){return n.e("components/ns-switch/ns-switch").then(n.bind(null,"1c63"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.payInfo?e._f("moneyFormat")(e.payMoney):null),a=e.payInfo&&e.balanceDeduct>0&&e.balanceUsable&&1==e.balanceConfig?e._f("moneyFormat")(e.balanceDeduct):null;e._isMounted||(e.e0=function(t,n){var a=arguments[arguments.length-1].currentTarget.dataset,i=a.eventParams||a["event-params"];n=i.index;e.payIndex=n}),e.$mp.data=Object.assign({},{$root:{f0:n,f1:a}})},s=[]},"4ef4":function(e,t,n){"use strict";n.r(t);var a=n("3686"),i=n("d925");for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);n("f47d");var o,c=n("f0c5"),u=Object(c["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);t["default"]=u.exports},6229:function(e,t,n){},cc03:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("92aa"))}.bind(null,n)).catch(n.oe)},i=function(){n.e("components/ns-switch/ns-switch").then(function(){return resolve(n("1c63"))}.bind(null,n)).catch(n.oe)},s={name:"payment",components:{uniPopup:a,nsSwitch:i},props:{balanceUsable:{type:Boolean,default:!0}},data:function(){return{payIndex:0,payTypeList:[{name:"微信支付",provider:"wxpay",icon:"iconweixin1",type:"wechatpay"}],payInfo:null,balanceConfig:0,sale:!0,isBalance:0,balance:0}},created:function(e){this.getPayType(),this.balanceUsable&&this.getBalanceConfig()},computed:{balanceDeduct:function(){var e=0;return this.payInfo&&this.balance&&(e=this.balance>this.payInfo.pay_money?this.payInfo.pay_money:this.balance),e},payMoney:function(){var e=0;return this.payInfo&&(e=this.payInfo.pay_money,this.balanceDeduct&&this.isBalance&&this.balanceUsable&&(e=this.payInfo.pay_money-this.balanceDeduct)),e}},methods:{close:function(){this.$emit("close"),this.$refs.choosePaymentPopup.close()},useBalance:function(){this.isBalance=this.isBalance?0:1,this.$emit("useBalance",this.isBalance)},confirm:function(){0==this.payTypeList.length&&this.payMoney>0?this.$util.showToast({title:"请选择支付方式！"}):(e.showLoading({title:"支付中...",mask:!0}),this.pay(),e.setStorageSync("pay_flag",1))},getPayInfo:function(e){var t=this;this.$api.sendRequest({url:"/api/pay/info",data:{out_trade_no:e},success:function(e){e.code>=0&&e.data?(t.payInfo=e.data,t.balanceConfig&&t.balanceUsable&&t.getMemberBalance(),setTimeout((function(){t.$refs.choosePaymentPopup.open()}))):t.$util.showToast({title:"未获取到支付信息！"})}})},getBalanceConfig:function(){var e=this;this.$api.sendRequest({url:"/api/pay/getBalanceConfig",data:{},success:function(t){e.balanceConfig=t.data.balance_show}})},getMemberBalance:function(){var e=this;this.$api.sendRequest({url:"/api/memberaccount/usablebalance",success:function(t){0==t.code&&t.data&&(e.balance=parseFloat(t.data.usable_balance))}})},getPayType:function(){var e=this;this.$api.sendRequest({url:"/api/pay/type",success:function(t){0==t.code&&(""==t.data.pay_type?e.payTypeList=[]:e.payTypeList.forEach((function(n,a){-1==t.data.pay_type.indexOf(n.type)&&e.payTypeList.splice(a,1)})))}})},pay:function(){var t=this,n=this.payTypeList[this.payIndex];n&&"wxpay"==n.provider&&this.$api.sendRequest({url:"/api/pay/pay",data:{out_trade_no:this.payInfo.out_trade_no,pay_type:n.type,scene:e.getStorageSync("is_test")?1175:wx.getLaunchOptionsSync().scene,is_balance:this.isBalance},success:function(a){if(e.hideLoading(),a.code>=0){if(a.data.pay_success)return void t.paySuccess();var i=a.data.data,s=e.getStorageSync("is_test")?1175:wx.getLaunchOptionsSync().scene;-1!=[1175,1176,1177,1191,1195].indexOf(s)?e.requestOrderPayment({timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:i.signType,paySign:i.paySign,success:function(e){t.paySuccess()},fail:function(n){t.flag=!1,"requestOrderPayment:fail cancel"==n.errMsg?(t.$util.showToast({title:"您已取消支付"}),t.resetpay()):(e.showModal({content:"支付失败,失败原因: "+n.errMsg,showCancel:!1}),setTimeout((function(){t.close()}),1500))}}):e.requestPayment({provider:n.provider,timeStamp:i.timeStamp,nonceStr:i.nonceStr,package:i.package,signType:i.signType,paySign:i.paySign,success:function(e){t.paySuccess()},fail:function(n){t.flag=!1,"requestPayment:fail cancel"==n.errMsg?(t.$util.showToast({title:"您已取消支付"}),t.resetpay()):(e.showModal({content:"支付失败,失败原因: "+n.errMsg,showCancel:!1}),setTimeout((function(){t.close()}),1500))}})}else t.$util.showToast({title:a.message})},fail:function(n){e.hideLoading(),t.$util.showToast({title:"request:fail"})}})},paySuccess:function(){"BlindboxGoodsOrderPayNotify"==this.payInfo.event?this.$util.redirectTo("/pages_promotion/blindbox/index",{outTradeNo:this.payInfo.out_trade_no},"redirectTo"):this.$util.redirectTo("/pages_tool/pay/result",{code:this.payInfo.out_trade_no},"redirectTo")},resetpay:function(){var e=this;this.$api.sendRequest({url:"/api/pay/resetpay",data:{out_trade_no:this.payInfo.out_trade_no},success:function(t){0==t.code&&e.getPayInfo(t.data)}})}}};t.default=s}).call(this,n("543d")["default"])},d925:function(e,t,n){"use strict";n.r(t);var a=n("cc03"),i=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=i.a},f47d:function(e,t,n){"use strict";var a=n("6229"),i=n.n(a);i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/payment/payment-create-component',
    {
        'components/payment/payment-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("4ef4"))
        })
    },
    [['components/payment/payment-create-component']]
]);
