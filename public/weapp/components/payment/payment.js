(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/payment/payment"],{"30d1":function(t,e,n){"use strict";n.r(e);var a=n("7c8c"),o=n("a755");for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("edcc");var i,c=n("f0c5"),u=Object(c["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);e["default"]=u.exports},"388f":function(t,e,n){},"7c8c":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a}));var a={uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"1fce"))},nsSwitch:function(){return n.e("components/ns-switch/ns-switch").then(n.bind(null,"94d5"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.$lang("common.currencySymbol")),a=t._f("moneyFormat")(t.payMoney);t._isMounted||(t.e0=function(e,n){var a=arguments[arguments.length-1].currentTarget.dataset,o=a.eventParams||a["event-params"];n=o.index;t.payIndex=n}),t.$mp.data=Object.assign({},{$root:{m0:n,f0:a}})},s=[]},a755:function(t,e,n){"use strict";n.r(e);var a=n("aa21"),o=n.n(a);for(var s in a)"default"!==s&&function(t){n.d(e,t,(function(){return a[t]}))}(s);e["default"]=o.a},aa21:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("1fce"))}.bind(null,n)).catch(n.oe)},o=function(){n.e("components/ns-switch/ns-switch").then(function(){return resolve(n("94d5"))}.bind(null,n)).catch(n.oe)},s=function(){Promise.all([n.e("common/vendor"),n.e("components/ns-show-toast/ns-show-toast")]).then(function(){return resolve(n("691c"))}.bind(null,n)).catch(n.oe)},i={name:"payment",components:{uniPopup:a,nsSwitch:o,nsShowToast:s},props:{balanceDeduct:{type:String,default:""},isBalance:{type:Number,default:0},payMoney:{type:[Number,String],default:0},isPayPassWord:{type:Number,default:0}},data:function(){return{isIphoneX:!1,payIndex:0,payTypeList:[{name:"微信支付",provider:"wxpay",icon:"iconweixinzhifu",type:"wechatpay"}],payPassWord:"",payInfo:{}}},created:function(){this.isIphoneX=this.$util.uniappIsIPhoneX(),this.getPayType()},methods:{open:function(){this.$refs.choosePaymentPopup.open()},close:function(){this.$refs.choosePaymentPopup.close()},useBalance:function(){this.$emit("useBalance")},checkPayPassWord:function(){6==this.payPassWord.length&&(t.showLoading({title:"支付中...",mask:!0}),this.$emit("confirm",this.payPassWord),this.$refs.choosePaymentPopup.close(),t.setStorageSync("pay_flag",1))},confirm:function(){if(1==this.isBalance){if(0==this.isPayPassWord)return void this.$util.showToast({title:"尚未设置支付密码，无法使用余额"});if(""==this.payPassWord)return void this.$util.showToast({title:"请输入支付密码"});this.checkPayPassWord()}else t.showLoading({title:"支付中...",mask:!0}),this.$refs.choosePaymentPopup.close(),this.$emit("confirm"),t.setStorageSync("pay_flag",1)},getPayInfo:function(t){var e=this;this.$api.sendRequest({url:"/api/pay/info",data:{out_trade_no:t},success:function(t){t.code>=0&&t.data?(e.payInfo=t.data,e.pay()):(e.$util.showToast({title:"未获取到支付信息！"}),setTimeout((function(){e.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1500))}})},getPayType:function(){var t=this;this.$api.sendRequest({url:"/api/pay/type",success:function(e){0==e.code&&t.payTypeList.forEach((function(n,a){-1==e.data.pay_type.indexOf(n.type)&&t.payTypeList.splice(a,1)}))}})},setPayPassword:function(){this.$util.redirectTo("/otherpages/member/pay_password/pay_password",{back:"/pages/order/payment/payment"})},pay:function(){var e=this,n=this.payTypeList[this.payIndex];n&&"wxpay"==n.provider&&this.$api.sendRequest({url:"/api/pay/pay",data:{out_trade_no:this.payInfo.out_trade_no,pay_type:n.type},success:function(a){if(a.code>=0){var o=a.data.data;t.requestPayment({provider:n.provider,timeStamp:o.timeStamp,nonceStr:o.nonceStr,package:o.package,signType:o.signType,paySign:o.paySign,success:function(t){e.$util.redirectTo("/pages/pay/result/result",{code:e.payInfo.out_trade_no},"","redirectTo")},fail:function(n){e.flag=!1,"requestPayment:fail cancel"==n.errMsg?e.$util.showToast({title:"您已取消支付"}):t.showModal({content:"支付失败,失败原因: "+n.errMsg,showCancel:!1}),setTimeout((function(){e.$util.redirectTo("/pages/pay/result/result",{code:e.payInfo.out_trade_no},"redirectTo")}),2e3)}})}else e.$util.showToast({title:a.message})},fail:function(t){e.$util.showToast({title:"request:fail"})}})}},filters:{moneyFormat:function(t){return parseFloat(t).toFixed(2)}}};e.default=i}).call(this,n("543d")["default"])},edcc:function(t,e,n){"use strict";var a=n("388f"),o=n.n(a);o.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/payment/payment-create-component',
    {
        'components/payment/payment-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("30d1"))
        })
    },
    [['components/payment/payment-create-component']]
]);
