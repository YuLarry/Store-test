(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/ns-goods-sku/ns-goods-sku-category"],{"235b":function(t,i,s){"use strict";s.d(i,"b",(function(){return o})),s.d(i,"c",(function(){return a})),s.d(i,"a",(function(){return e}));var e={uniPopup:function(){return s.e("components/uni-popup/uni-popup").then(s.bind(null,"92aa"))},nsLogin:function(){return s.e("components/ns-login/ns-login").then(s.bind(null,"2893"))}},o=function(){var t=this,i=t.$createElement,s=(t._self._c,t.$util.img(t.goodsDetail.sku_image,{size:"mid"})),e=t.__map(t.goodsDetail.goods_spec_format,(function(i,s){var e=t.__get_orig(i),o=t.__map(i.value,(function(i,s){var e=t.__get_orig(i),o=i.image?t.$util.img(i.image,{size:"small"}):null;return{$orig:e,g1:o}}));return{$orig:e,l0:o}}));t.$mp.data=Object.assign({},{$root:{g0:s,l1:e}})},a=[]},"449f":function(t,i,s){"use strict";s.r(i);var e=s("235b"),o=s("b3c8");for(var a in o)"default"!==a&&function(t){s.d(i,t,(function(){return o[t]}))}(a);s("d421");var u,n=s("f0c5"),r=Object(n["a"])(o["default"],e["b"],e["c"],!1,null,"e0e0d45a",null,!1,e["a"],u);i["default"]=r.exports},"54ea":function(t,i,s){},"5f35":function(t,i,s){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;e(s("ce70"));function e(t){return t&&t.__esModule?t:{default:t}}var o=function(){s.e("components/uni-popup/uni-popup-sku-new").then(function(){return resolve(s("aa96"))}.bind(null,s)).catch(s.oe)},a={name:"ns-goods-sku-category",components:{uniPopup:o},props:{disabled:{type:Boolean,default:!1},pointLimit:{type:[Number,String]}},data:function(){return{isIphoneX:!1,systemInfo:{},number:0,btnSwitch:!1,type:"",callback:null,skuId:0,limitNumber:0,cartData:[],cartIdArr:[],goodsDetail:{},maxBuy:0,minBuy:0,isLoad:!1,goodsCartNumber:0}},created:function(){this.isIphoneX=this.$util.uniappIsIPhoneX(),this.systemInfo=t.getSystemInfoSync()},watch:{pointLimit:function(t,i){this.limitNumber=Number(t)},goodsDetail:function(t,i){this.skuId=t.sku_id},minBuy:function(t,i){this.minBuy>1&&(this.number=Number(this.minBuy))}},methods:{show:function(t,i,s){this.goodsDetail=i,this.dealData(),this.$refs.skuPopup.open(),this.type=t,this.callback=s,this.skuId=this.goodsDetail.sku_id,this.maxBuy=this.goodsDetail.max_buy,this.minBuy=this.goodsDetail.min_buy,this.isLoad=!0,this.getCartData(),this.getGoodsCartNum()},hide:function(){this.$refs.skuPopup.close()},change:function(t,i){if(!this.disabled){this.btnSwitch=!1,this.skuId=t;for(var s=0;s<this.goodsDetail.goods_spec_format.length;s++)for(var e=this.goodsDetail.goods_spec_format[s],o=0;o<e.value.length;o++)i==this.goodsDetail.goods_spec_format[s].value[o].spec_id&&(this.goodsDetail.goods_spec_format[s].value[o].selected=!1);this.isLoad=!0,this.getGoodsSkuInfo()}},previewMedia:function(){var i=[];i.push(this.$util.img(this.goodsDetail.sku_image,{size:"big"})),t.previewImage({current:1,urls:i})},getGoodsSkuInfo:function(){var t=this;this.getCartData();this.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",data:{sku_id:void 0==this.skuId?this.goodsDetail.sku_id:this.skuId},success:function(i){var s=i.data;if(null!=s){s.unit=s.unit||"件",t.goodsDetail=s,t.dealData(),t.btnSwitch=!1;var e=t.goodsDetail;e.num=void 0!==t.cartData[t.skuId]?t.cartData[t.skuId]:0,t.$emit("refresh",e)}else t.$util.redirectTo("/pages/index/index",{},"reLaunch")},fail:function(i){t.btnSwitch=!1,t.$util.redirectTo("/pages/index/index",{},"reLaunch")}})},dealData:function(){1==this.goodsDetail.promotion_type?this.goodsDetail.member_price&&this.goodsDetail.member_price<=this.goodsDetail.price?this.goodsDetail.show_price=this.goodsDetail.member_price:this.goodsDetail.show_price=this.goodsDetail.discount_price:this.goodsDetail.member_price?this.goodsDetail.show_price=this.goodsDetail.member_price:this.goodsDetail.show_price=this.goodsDetail.price,this.goodsDetail.sku_spec_format&&"string"==typeof this.goodsDetail.sku_spec_format&&(this.goodsDetail.sku_spec_format=JSON.parse(this.goodsDetail.sku_spec_format)),this.goodsDetail.goods_spec_format&&"string"==typeof this.goodsDetail.goods_spec_format&&(this.goodsDetail.goods_spec_format=JSON.parse(this.goodsDetail.goods_spec_format)),this.goodsDetail.unit=this.goodsDetail.unit||"件",this.keyInput(!1)},changeNum:function(i,s){var e=this;if(0!=this.goodsDetail.stock){var o=this.goodsDetail.stock,a=1;if(1==this.goodsDetail.is_limit&&this.maxBuy>0&&this.maxBuy<o&&(o=this.maxBuy),1==this.goodsDetail.is_limit&&2==this.goodsDetail.limit_type&&this.maxBuy>0&&this.goodsDetail.purchased_num>0){var u=this.maxBuy-this.goodsDetail.purchased_num;o=u<this.goodsDetail.stock?u:this.goodsDetail.stock}if(this.minBuy>1&&(a=this.minBuy),"+"==i){if(this.number<o)this.number++;else{if(this.number>=this.goodsDetail.stock)return void this.$util.showToast({title:"库存不足"});if(1==this.goodsDetail.is_limit&&this.maxBuy>0){if(1==this.goodsDetail.limit_type)return void this.$util.showToast({title:"该商品每次最多购买"+this.maxBuy+this.goodsDetail.unit});if(2==this.goodsDetail.limit_type){var n="该商品每人限购"+this.maxBuy+this.goodsDetail.unit;return n+=this.goodsDetail.purchased_num>0?"，您已购买了"+this.goodsDetail.purchased_num+this.goodsDetail.unit:"",void this.$util.showToast({title:n})}}}var r=t.createSelectorQuery().in(this);r.select("#"+s.currentTarget.id+" .click-event").boundingClientRect((function(t){t&&e.$emit("addCart",t.left,t.top)})).exec()}else"-"==i&&(this.number>a?this.number-=1:this.number=0);this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.number?this.cartNumChange(this.number,this.cartIdArr[this.skuId]):this.deleteCart()}},blur:function(){var t=this;if(this.number||(this.number=1),this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.goodsDetail.is_limit&&this.maxBuy>0){var i=this.maxBuy-this.goodsDetail.purchased_num;this.number>i&&(this.number=i)}this.number<this.minBuy&&this.minBuy>0&&(this.number=this.minBuy);var s=parseInt(this.number);this.isLoad=!1,setTimeout((function(){t.number=s,t.cartNumChange(t.number,t.cartIdArr[t.skuId])}),0)},keyInput:function(t,i){var s=this;setTimeout((function(){var e=s.goodsDetail.stock;0!=s.goodsDetail.stock?(t&&0==s.number.length&&(s.number=1),t&&(s.number<=0||isNaN(s.number))&&(s.number=1),s.number>e&&(s.number=e),s.minBuy>1&&s.number<s.minBuy&&(s.number=s.minBuy),t&&(s.number=parseInt(s.number)),i&&i()):s.number=0}),0)},confirm:function(i){var s=this;t.getStorageSync("token")?(this.number=1,this.keyInput(!0,(function(){if(0!=s.goodsDetail.stock)if(s.number>s.goodsDetail.stock)s.$util.showToast({title:"库存不足"});else if(1==s.goodsDetail.is_limit&&1==s.goodsDetail.limit_type&&s.maxBuy>0&&s.number>s.maxBuy)s.$util.showToast({title:"该商品每次最多购买"+s.maxBuy+s.goodsDetail.unit});else{if(1==s.goodsDetail.is_limit&&2==s.goodsDetail.limit_type&&s.maxBuy>0&&s.number+s.goodsDetail.purchased_num>s.maxBuy){var t="该商品每人限购"+s.maxBuy+s.goodsDetail.unit;return t+=s.goodsDetail.purchased_num>0?"，您已购买了"+s.goodsDetail.purchased_num+s.goodsDetail.unit:"",void s.$util.showToast({title:t})}s.$emit("addCart",i.detail.x,i.detail.y),s.btnSwitch||(s.btnSwitch=!0,s.$api.sendRequest({url:"/api/cart/add",data:{sku_id:s.goodsDetail.sku_id,num:s.number},success:function(t){var i=t.data;i>0&&(s.getCartData(),s.getGoodsSkuInfo(),s.$store.dispatch("getCartNumber"),s.$util.showToast({title:"加入购物车成功"}),s.callback&&s.callback()),s.btnSwitch=!1},fail:function(t){s.$refs.skuPopup.close(),s.btnSwitch=!1}}))}else s.$util.showToast({title:"商品已售罄"})}))):this.$refs.login.open()},closeSkuPopup:function(){this.$refs.skuPopup.close()},imageError:function(){this.goodsDetail.sku_image=this.$util.getDefaultImage().goods,this.$forceUpdate()},valueImageError:function(t,i){this.goodsDetail.goods_spec_format[t].value[i].image=this.$util.getDefaultImage().goods,this.$forceUpdate()},getCartData:function(){var t=this;this.$api.sendRequest({url:"/api/cart/lists",success:function(i){if(i.code>=0){var s=[],e=[];if(i.data.length)for(var o=0;o<i.data.length;o++)s[i.data[o].sku_id]=i.data[o].num,e[i.data[o].sku_id]=i.data[o].cart_id;t.cartData=s,t.cartIdArr=e}t.number=t.cartData[t.skuId]?t.cartData[t.skuId]:0,t.$forceUpdate()}})},cartNumChange:function(t,i){var s=this;t<1&&(t=1),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:i},success:function(i){i.code>=0&&(s.cartData[s.skuId]=t,s.$store.dispatch("getCartNumber"),s.getGoodsCartNum())}})},deleteCart:function(){var t=this;this.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:this.cartIdArr[this.skuId]},success:function(i){i.code>=0&&(t.$store.dispatch("getCartNumber"),t.getCartData(),t.getGoodsCartNum())}})},getGoodsCartNum:function(){var t=this;this.$api.sendRequest({url:"/api/cart/goodsnum",data:{goods_id:this.goodsDetail.goods_id},success:function(i){i.code>=0&&(t.goodsCartNumber=i.data)}})}}};i.default=a}).call(this,s("543d")["default"])},b3c8:function(t,i,s){"use strict";s.r(i);var e=s("5f35"),o=s.n(e);for(var a in e)"default"!==a&&function(t){s.d(i,t,(function(){return e[t]}))}(a);i["default"]=o.a},d421:function(t,i,s){"use strict";var e=s("54ea"),o=s.n(e);o.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/ns-goods-sku/ns-goods-sku-category-create-component',
    {
        'components/ns-goods-sku/ns-goods-sku-category-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("449f"))
        })
    },
    [['components/ns-goods-sku/ns-goods-sku-category-create-component']]
]);
