<page-meta page-style="{{themeColor}}"></page-meta><view><view class="container"><scroll-view class="scroll-view" scroll-y="{{true}}" show-scrollbar="{{false}}"><block wx:if="{{hasData}}"><block><block wx:if="{{cartData.length}}"><view class="cart-header fixed"><view class="num-wrap">{{'共'+cartData[0].cartList.length+'种商品'}}</view><view data-event-opts="{{[['tap',[['changeAction',['$event']]]]]}}" class="cart-action" bindtap="__e">{{isAction?$root.m0:$root.m1}}</view></view></block><block wx:for="{{$root.l1}}" wx:for-item="siteItem" wx:for-index="siteIndex" wx:key="siteIndex"><view class="cart-wrap"><block wx:if="{{discount.coupon_info}}"><view class="coupon-use-tips"><view><text class="title color-base-text">优惠券</text><text class="desc">{{"领券结算最高可减"+$root.f0+"元"}}</text></view><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="color-base-text" bindtap="__e">{{"点击"+(discount.coupon_info.receive_type=='wait'?'领取':'查看')}}<text class="iconfont iconright"></text></view></view></block><block wx:for="{{siteItem.l0}}" wx:for-item="item" wx:for-index="cartIndex" wx:key="cartIndex"><block><view class="cart-goods"><view class="{{['goods-wrap',(item.$orig.edit)?'edit':'']}}"><view data-event-opts="{{[['tap',[['singleElection',[siteIndex,cartIndex]]]]]}}" class="{{['iconfont',item.$orig.checked?'iconyuan_checked color-base-text':'iconyuan_checkbox']}}" bindtap="__e"></view><view data-event-opts="{{[['tap',[['toGoodsDetail',['$0'],[[['cartData','',siteIndex],['cartList','',cartIndex]]]]]]]}}" class="goods-img" bindtap="__e"><image src="{{item.g0}}" mode="aspectFill" data-event-opts="{{[['error',[['imageError',[siteIndex,cartIndex]]]]]}}" binderror="__e"></image></view><view class="goods-info"><view><view data-event-opts="{{[['tap',[['toGoodsDetail',['$0'],[[['cartData','',siteIndex],['cartList','',cartIndex]]]]]]]}}" class="goods-name" bindtap="__e">{{item.$orig.goods_name}}</view><view><view class="sku"><block wx:if="{{item.$orig.sku_spec_format.length}}"><view data-event-opts="{{[['tap',[['selectSku',['$0'],[[['cartData','',siteIndex],['cartList','',cartIndex]]]]]]]}}" class="goods-spec" bindtap="__e"><block wx:for="{{item.$orig.sku_spec_format}}" wx:for-item="x" wx:for-index="i" wx:key="i"><block>{{''+x.spec_name+":"+x.spec_value_name+" "+(i<item.$orig.sku_spec_format.length-1?';':'')+''}}</block></block></view></block><block wx:if="{{item.$orig.sku_spec_format.length}}"><text class="iconfont iconunfold"></text></block></view></view></view><view class="goods-sub-section"><block wx:if="{{item.$orig.promotion_type==1}}"><block><block wx:if="{{item.m2}}"><block><view class="goods-price "><view class="bottom-price price-style large"><text class="unit price-style small">{{item.m3}}</text>{{''+item.g1[0]+''}}<text class="unit price-style small">{{"."+item.g2[1]}}</text><image src="{{item.g3}}"></image></view></view></block></block><block wx:else><block><view class="goods-price "><view class="bottom-price price-style large"><text class="unit price-style small">{{item.m4}}</text>{{''+item.g4[0]+''}}<text class="unit price-style small">{{"."+item.g5[1]}}</text><image src="{{item.g6}}"></image></view></view></block></block></block></block><block wx:else><block><block wx:if="{{item.m5>0}}"><block><view class="goods-price "><view class="bottom-price price-style large"><text class="unit price-style small">{{item.m6}}</text>{{''+item.g7[0]+''}}<text class="unit price-style small">{{"."+item.g8[1]}}</text><image src="{{item.g9}}"></image></view></view></block></block><block wx:else><block><view class="goods-price "><view class="bottom-price price-style large"><text class="unit price-style small">{{item.m7}}</text>{{''+item.g10[0]+''}}<text class="unit price-style small">{{"."+item.g11[1]}}</text></view></view></block></block></block></block><uni-number-box vue-id="{{'e780df58-1-'+siteIndex+'-'+cartIndex}}" min="{{item.$orig.min_buy>1?item.$orig.min_buy:1}}" max="{{item.$orig.max_buy>0&&item.$orig.max_buy<item.$orig.stock?item.$orig.max_buy:item.$orig.stock}}" value="{{item.m8}}" size="small" modifyFlag="{{modifyFlag}}" data-event-opts="{{[['^change',[['cartNumChange',['$event',['o',['siteIndex',siteIndex],['cartIndex',cartIndex]]]]]],['^limit',[['goodsLimit',['$event',cartIndex]]]]]}}" bind:change="__e" bind:limit="__e" bind:__l="__l"></uni-number-box></view><block wx:if="{{manjian&&manjian['sku_'+item.$orig.sku_id]}}"><view class="discount-wrap"><text class="discount-tag">满减</text><scroll-view class="scroll-view" scroll-x="true"><block wx:for="{{manjian['sku_'+item.$orig.sku_id]}}" wx:for-item="mitem" wx:for-index="key" wx:key="key"><block><block wx:if="{{mitem.discount_money}}"><text>{{mitem.limit+"减"+mitem.discount_money}}</text></block><block wx:if="{{mitem.discount_money}}"><text class="interval"></text></block></block></block></scroll-view></view></block></view></view></view></block></block></view></block><block wx:if="{{invalidGoods.length}}"><view class="cart-wrap invalid"><view class="cart-header"><view class="num-wrap"><text class="font-size-base">{{"失效商品"+invalidGoods.length+"件"}}</text></view><view data-event-opts="{{[['tap',[['clearInvalidGoods',['$event']]]]]}}" class="cart-action color-base-text" bindtap="__e">清空</view></view><block wx:for="{{$root.l2}}" wx:for-item="goodsItem" wx:for-index="goodsIndex" wx:key="goodsIndex"><block><view class="cart-goods invalid-goods"><view class="goods-wrap"><view class="iconfont iconyuan_checked color-tip"></view><view class="goods-img"><image src="{{goodsItem.g12}}" mode="aspectFill"></image></view><view class="goods-info"><view class="goods-name">{{goodsItem.$orig.sku_name}}</view><view><view class="sku"><block wx:if="{{goodsItem.$orig.sku_spec_format.length}}"><view class="goods-spec"><block wx:for="{{goodsItem.$orig.sku_spec_format}}" wx:for-item="x" wx:for-index="i" wx:key="i"><block>{{''+x.spec_name+":"+x.spec_value_name+" "+(i<goodsItem.$orig.sku_spec_format.length-1?'; ':'')+''}}</block></block></view></block></view></view><view class="goods-sub-section"><text class="goods-price price-style large"><block wx:if="{{goodsItem.$orig.member_price>0&&goodsItem.$orig.member_price<goodsItem.$orig.discount_price}}"><text class="unit price-style small">{{goodsItem.m9}}</text>{{''+goodsItem.g13[0]+''}}<text class="unit price-style small">{{"."+goodsItem.g14[1]}}</text><image src="{{goodsItem.g15}}"></image></block><block wx:else><text class="unit price-style small">{{goodsItem.m10}}</text>{{''+goodsItem.g16[0]+''}}<text class="unit price-style small">{{"."+goodsItem.g17[1]}}</text></block></text><text class="invalid-mark">已失效</text></view></view></view></view></block></block></view></block></block></block><block wx:else><block><view class="cart-empty"><image src="{{$root.g18}}" mode="aspectFit"></image><view class="color-tip margin-top margin-bottom">{{$root.m11}}</view><block wx:if="{{token!=''}}"><button class="button" type="primary" size="mini" data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" bindtap="__e">去逛逛</button></block><block wx:else><button class="button" type="primary" size="mini" data-event-opts="{{[['tap',[['toLogin',['$event']]]]]}}" bindtap="__e">去登录</button></block></view></block></block><ns-goods-recommend class="vue-ref" vue-id="e780df58-2" route="cart" data-ref="goodrecommend" bind:__l="__l"></ns-goods-recommend><uni-popup class="vue-ref" vue-id="e780df58-3" type="bottom" data-ref="discountPopup" bind:__l="__l" vue-slots="{{['default']}}"><block wx:if="{{$root.g19.length}}"><view class="discount-popup popup"><view class="popup-header"><text class="tit">优惠明细</text><text data-event-opts="{{[['tap',[['toggleDiscountPopup',['$event']]]]]}}" class="iconfont iconclose" bindtap="__e"></text></view><view data-event-opts="{{[['tap',[['toggleDiscountPopup',['$event']]]]]}}" class="{{['popup-body',(isIphoneX)?'safe-area':'']}}" bindtap="__e"><view class="detail-item"><view class="title">商品总额</view><view class="money price-font">{{"￥"+$root.f1}}</view></view><block wx:if="{{discount.coupon_money>0}}"><view class="detail-item"><view class="title">优惠券</view><view class="money price-font reduce">{{"-￥"+$root.f2}}</view></view></block><block wx:if="{{discount.promotion_money>0}}"><view class="detail-item"><view class="title">满减</view><view class="money reduce price-font">{{"-￥"+$root.f3}}</view></view></block><view class="detail-item total"><view class="title">合计</view><view class="money price-font ">{{"￥"+$root.f4}}</view></view></view></view></block></uni-popup><block wx:if="{{discount.coupon_info}}"><uni-popup class="vue-ref" vue-id="e780df58-4" type="bottom" data-ref="couponPopup" bind:__l="__l" vue-slots="{{['default']}}"><view class="coupon-popup popup"><view class="popup-header"><text class="tit">优惠券</text><text data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="iconfont iconclose" bindtap="__e"></text></view><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" class="{{['popup-body',(isIphoneX)?'safe-area':'']}}" bindtap="__e"><view class="coupon-item"><view class="coupon-info" style="{{'background-color:'+(discount.coupon_info.receive_type!='wait'?'#F2F2F2':'var(--main-color-shallow)')+';'}}"><view class="info-wrap"><image class="coupon-line" mode="heightFix" src="{{$root.g20}}"></image><view class="coupon-money"><block wx:if="{{discount.coupon_info.type=='reward'}}"><text class="unit">{{$root.m12}}</text><text class="money">{{$root.m13}}</text></block><block wx:else><block wx:if="{{discount.coupon_info.type=='discount'}}"><text class="money">{{$root.m14}}</text><text class="unit">折</text></block></block><view class="at-least"><block wx:if="{{discount.coupon_info.at_least>0}}">{{'满'+discount.coupon_info.at_least+'可用'}}</block><block wx:else>无门槛</block></view></view></view><view class="desc-wrap"><view class="coupon-name">{{discount.coupon_info.coupon_name}}</view><block wx:if="{{discount.coupon_info.type=='discount'&&discount.coupon_info.discount_limit>0}}"><view class="limit">{{"最多可抵￥"+discount.coupon_info.discount_limit}}</view></block><block wx:if="{{discount.coupon_info.validity_type==0}}"><view class="time font-size-goods-tag">{{"有效期："+$root.g21}}</view></block><block wx:else><block wx:if="{{discount.coupon_info.validity_type==1}}"><view class="time font-size-goods-tag">{{"有效期：领取之日起"+discount.coupon_info.fixed_term+"天内有效"}}</view></block><block wx:else><view class="time font-size-goods-tag">有效期：长期有效</view></block></block></view><block wx:if="{{discount.coupon_info.receive_type!='wait'}}"><button type="primary" disabled="{{true}}">已领取</button></block><block wx:else><button type="primary" data-event-opts="{{[['tap',[['receiveCoupon',['$0'],['discount.coupon_info.coupon_type_id']]]]]}}" catchtap="__e">领取</button></block></view></view></view></view></uni-popup></block></scroll-view><block wx:if="{{hasData}}"><view class="{{['cart-bottom',(isIphoneX)?'active':'']}}"><view data-event-opts="{{[['tap',[['allElection',['$event']]]]]}}" class="all-election" bindtap="__e"><view class="{{['iconfont',checkAll?'iconyuan_checked color-base-text':'iconyuan_checkbox']}}"></view><text>{{$root.m15}}</text></view><view class="settlement-info" style="{{'visibility:'+(isAction?'hidden':'visible')+';'}}"><view class="money">{{''+$root.m16+'：'}}<text class="unit price-font">{{$root.m17+''}}</text><block wx:if="{{$root.g22.length}}"><block><text class="value price-font">{{$root.g23[0]}}</text><text class="unit price-font">{{"."+$root.g24[1]}}</text></block></block><block wx:else><block><text class="value price-font">{{$root.g25[0]}}</text><text class="unit price-font">{{"."+$root.g26[1]}}</text></block></block></view><block wx:if="{{$root.g27.length}}"><view data-event-opts="{{[['tap',[['toggleDiscountPopup',['$event']]]]]}}" class="detail" bindtap="__e">优惠明细<text class="{{['iconfont','iconunfold',(!discountPopupShow)?'open':'']}}"></text></view></block></view><block wx:if="{{isAction}}"><view class="action-btn"><button type="primary" size="mini" data-event-opts="{{[['tap',[['deleteCart',['all']]]]]}}" bindtap="__e">{{$root.m18}}</button></view></block><block wx:else><view class="action-btn"><block wx:if="{{totalCount!=0}}"><button type="primary" size="mini" data-event-opts="{{[['tap',[['settlement',['$event']]]]]}}" bindtap="__e">{{''+(discount.coupon_info&&discount.coupon_info.receive_type=='wait'?'领券':'立即')+"结算("+totalCount+')'}}</button></block><block wx:else><button type="primary" size="mini" disabled="{{true}}" data-event-opts="{{[['tap',[['settlement',['$event']]]]]}}" bindtap="__e">{{$root.m19+"("+totalCount+")"}}</button></block></view></block></view></block></view><block wx:if="{{goodsSkuDetail}}"><ns-goods-sku class="vue-ref" vue-id="e780df58-5" goods-detail="{{goodsSkuDetail}}" max-buy="{{goodsSkuDetail.max_buy}}" min-buy="{{goodsSkuDetail.min_buy}}" data-ref="selectSku" data-event-opts="{{[['^refresh',[['refreshSkuDetail']]]]}}" bind:refresh="__e" bind:__l="__l"></ns-goods-sku></block><loading-cover class="vue-ref" vue-id="e780df58-6" data-ref="loadingCover" bind:__l="__l"></loading-cover><view id="tab-bar"><diy-bottom-nav vue-id="e780df58-7" type="shop" bind:__l="__l"></diy-bottom-nav></view><block wx:if="{{showTop}}"><to-top bind:toTop="__e" vue-id="e780df58-8" data-event-opts="{{[['^toTop',[['scrollToTopNative']]]]}}" bind:__l="__l"></to-top></block><ns-login class="vue-ref" vue-id="e780df58-9" data-ref="login" bind:__l="__l"></ns-login></view>