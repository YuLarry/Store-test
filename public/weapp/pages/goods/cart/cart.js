(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/cart/cart"],{"0dcd":function(t,n,e){"use strict";e.r(n);var o=e("b7bd"),i=e.n(o);for(var a in o)"default"!==a&&function(t){e.d(n,t,(function(){return o[t]}))}(a);n["default"]=i.a},"41d1":function(t,n,e){},"852c":function(t,n,e){"use strict";e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return a})),e.d(n,"a",(function(){return o}));var o={uniNumberBox:function(){return e.e("components/uni-number-box/uni-number-box").then(e.bind(null,"2520"))},loadingCover:function(){return e.e("components/loading-cover/loading-cover").then(e.bind(null,"30be"))},diyBottomNav:function(){return e.e("components/diy-bottom-nav/diy-bottom-nav").then(e.bind(null,"aac7"))},nsShowToast:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-show-toast/ns-show-toast")]).then(e.bind(null,"691c"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"2e9e"))}},i=function(){var t=this,n=t.$createElement,e=(t._self._c,t.isBottom?t.__map(t.cartData,(function(n,e){var o=t.__get_orig(n),i=n.edit?t.$lang("complete"):null,a=n.edit?null:t.$lang("edit"),c=t.$lang("del"),r=t.__map(n.cartList,(function(n,e){var o=t.__get_orig(n),i=t.$util.img(n.sku_image,{size:"mid"}),a=1==n.promotion_type?Number(n.member_price):null,c=1==n.promotion_type?Number(n.member_price):null,r=1==n.promotion_type?Number(n.discount_price):null,s=1==n.promotion_type&&a>0&&c<r?t.$lang("common.currencySymbol"):null,u=1==n.promotion_type&&a>0&&c<r?t.$util.img("upload/uniapp/index/VIP.png"):null,l=1!=n.promotion_type||a>0&&c<r?null:t.$lang("common.currencySymbol"),d=1!=n.promotion_type||a>0&&c<r?null:t.$util.img("upload/uniapp/index/discount.png"),m=1!=n.promotion_type?Number(n.member_price):null,h=1!=n.promotion_type&&m>0?t.$lang("common.currencySymbol"):null,f=1!=n.promotion_type&&m>0?t.$util.img("upload/uniapp/index/VIP.png"):null,g=1==n.promotion_type||m>0?null:t.$lang("common.currencySymbol"),p=t.initNum(n);return{$orig:o,g0:i,m2:a,m3:c,m4:r,m5:s,g1:u,m6:l,g2:d,m7:m,m8:h,g3:f,m9:g,m10:p}}));return{$orig:o,m0:i,m1:a,m11:c,l0:r}})):null),o=t.$lang("common.currencySymbol"),i=t.isBottom&&t.invalidGoods.length?t.__map(t.invalidGoods,(function(n,e){var o=t.__get_orig(n),i=t.$util.img(n.sku_image,{size:"mid"}),a=n.member_price>0&&n.member_price<n.discount_price?t.$lang("common.currencySymbol"):null;return{$orig:o,g4:i,m12:a}})):null,a=t.isBottom?null:t.$util.img("upload/uniapp/common-empty.png"),c=t.isBottom?null:t.$lang("emptyTips"),r=t.cartData.length||t.invalidGoods.length?t.$lang("allElection"):null,s=t.cartData.length||t.invalidGoods.length?t.$lang("total"):null,u=t.cartData.length||t.invalidGoods.length?t.$lang("common.currencySymbol"):null,l=(t.cartData.length||t.invalidGoods.length)&&0!=t.totalCount?t.$lang("settlement"):null,d=(t.cartData.length||t.invalidGoods.length)&&0==t.totalCount?t.$lang("settlement"):null;t._isMounted||(t.e0=function(n){return t.$util.redirectTo("/pages/index/index/index")}),t.$mp.data=Object.assign({},{$root:{l1:e,m13:o,l2:i,g5:a,m14:c,m15:r,m16:s,m17:u,m18:l,m19:d}})},a=[]},8822:function(t,n,e){"use strict";e.r(n);var o=e("852c"),i=e("0dcd");for(var a in i)"default"!==a&&function(t){e.d(n,t,(function(){return i[t]}))}(a);e("e415");var c,r=e("f0c5"),s=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);n["default"]=s.exports},b7bd:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=a(e("dada")),i=a(e("ccd8"));function a(t){return t&&t.__esModule?t:{default:t}}var c=function(){Promise.all([e.e("common/vendor"),e.e("components/ns-goods-recommend/ns-goods-recommend")]).then(function(){return resolve(e("d6df"))}.bind(null,e)).catch(e.oe)},r=function(){e.e("components/uni-number-box/uni-number-box").then(function(){return resolve(e("2520"))}.bind(null,e)).catch(e.oe)},s=function(){e.e("components/diy-bottom-nav/diy-bottom-nav").then(function(){return resolve(e("aac7"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("components/toTop/toTop").then(function(){return resolve(e("1051"))}.bind(null,e)).catch(e.oe)},l=function(){Promise.all([e.e("common/vendor"),e.e("components/ns-show-toast/ns-show-toast")]).then(function(){return resolve(e("691c"))}.bind(null,e)).catch(e.oe)},d={components:{nsGoodsRecommend:c,uniNumberBox:r,diyBottomNav:s,toTop:u,nsShowToast:l},mixins:[o.default,i.default],data:function(){return{token:"",cartData:[],checkAll:!1,totalPrice:"0.00",totalCount:0,modifyFlag:!1,isSub:!1,invalidGoods:[],isIphoneX:!1,cartBottom:"56px"}},onLoad:function(){t.hideTabBar()},onShow:function(){this.$langConfig.refresh(),t.getStorageSync("token")?this.getCartData():(this.token="",this.cartData=[],this.calculationTotalPrice()),this.isIphoneX=this.$util.uniappIsIPhoneX(),this.$util.uniappIsIPhone11()&&(this.cartBottom="90px")},onReady:function(){t.getStorageSync("token")||this.$refs.loadingCover&&this.$refs.loadingCover.hide()},computed:{isBottom:function(){return this.cartData.length>0||this.invalidGoods.length>0},storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(t,n){t&&this.getCartData()}},methods:{initNum:function(t){var n=t.max_buy>0&&t.max_buy<t.stock?t.max_buy:t.stock;return n=0==n?1:n,t.num>n?n:t.num},getCartData:function(){var n=this;this.$api.sendRequest({url:"/api/cart/goodslists",success:function(e){e.code>=0?(n.token=t.getStorageSync("token"),e.data.length?n.handleCartData(e.data):n.cartData=[]):n.token="",n.$refs.loadingCover&&n.$refs.loadingCover.hide()},fail:function(t){n.$refs.loadingCover&&n.$refs.loadingCover.hide()}})},handleCartData:function(t){var n=this;this.invalidGoods=[],this.cartData=[];var e={};t.forEach((function(t,o){1==t.goods_state?t.min_buy>0&&t.min_buy>t.stock?n.invalidGoods.push(t):(t.checked=!0,void 0!=e["site_"+t.site_id]?e["site_"+t.site_id].cartList.push(t):e["site_"+t.site_id]={siteId:t.site_id,siteName:t.site_name,edit:!1,checked:!0,cartList:[t]}):n.invalidGoods.push(t)})),this.cartData=[],Object.keys(e).forEach((function(t){n.cartData.push(e[t])})),this.calculationTotalPrice(),this.cartData.length&&this.cartData[0].cartList.forEach((function(t){t.sku_spec_format?t.sku_spec_format=JSON.parse(t.sku_spec_format):t.sku_spec_format=[]}))},singleElection:function(t,n){this.cartData[t].cartList[n].checked=!this.cartData[t].cartList[n].checked,this.calculationTotalPrice()},siteAllElection:function(t,n){this.cartData[n].checked=t,this.cartData[n].cartList.forEach((function(n){n.checked=t})),this.calculationTotalPrice()},allElection:function(t){var n=this;this.checkAll="boolean"==typeof t?t:!this.checkAll,this.cartData.length&&this.cartData.forEach((function(t){t.checked=n.checkAll,t.cartList.forEach((function(t){t.checked=n.checkAll}))})),this.calculationTotalPrice()},calculationTotalPrice:function(){if(this.cartData.length){var t=0,n=0,e=0;this.cartData.forEach((function(o){var i=0;o.cartList.forEach((function(e){e.checked&&(i+=1,n+=parseInt(e.num),Number(e.member_price)>0&&Number(e.member_price)<Number(e.discount_price)?t+=e.member_price*e.num:t+=e.discount_price*e.num)})),o.cartList.length==i?(o.checked=!0,e+=1):o.checked=!1})),this.totalPrice=t.toFixed(2),this.totalCount=n,this.checkAll=this.cartData.length==e}else this.totalPrice="0.00",this.totalCount=0;this.modifyFlag=!1},deleteCart:function(t,n){var e=this;this.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:this.cartData[t].cartList[n].cart_id},success:function(o){o.code>=0?(e.cartData[t].cartList.splice(n,1),0==e.cartData[t].cartList.length&&e.cartData.splice(t,1),e.calculationTotalPrice(),e.getCartNumber()):e.$util.showToast({title:o.message})}})},cartNumChange:function(t,n){var e=this;if(!isNaN(t)){var o=this.cartData[n.siteIndex].cartList[n.cartIndex],i=o.max_buy>0&&o.max_buy<o.stock?o.max_buy:o.stock,a=o.min_buy>0?o.min_buy:1;t>i&&(t=i),t<a&&(t=a),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:this.cartData[n.siteIndex].cartList[n.cartIndex].cart_id},success:function(o){o.code>=0?(e.cartData[n.siteIndex].cartList[n.cartIndex].num=t,e.calculationTotalPrice(),e.getCartNumber()):e.$util.showToast({title:o.message})}})}},settlement:function(){var n=this;if(this.totalCount>0){var e=[];if(this.cartData.forEach((function(t){t.cartList.forEach((function(t){t.checked&&e.push(t.cart_id)}))})),this.isSub)return;this.isSub=!0,t.setStorage({key:"orderCreateData",data:{cart_ids:e.toString()},success:function(){n.$util.redirectTo("/pages/order/payment/payment"),n.isSub=!1}})}},edit:function(t){this.cartData[t].edit=!this.cartData[t].edit},clearInvalidGoods:function(){var t=this,n=[];this.invalidGoods.forEach((function(t){n.push(t.cart_id)})),n.length&&this.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:n.toString()},success:function(n){n.code>=0?(t.invalidGoods=[],t.getCartNumber()):t.$util.showToast({title:n.message})}})},imageError:function(t,n){this.cartData[t].cartList[n].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},toGoodsDetail:function(t){this.$util.redirectTo("/pages/goods/detail/detail",{sku_id:t.sku_id})},getCartNumber:function(){t.getStorageSync("token")&&this.$store.dispatch("getCartNumber")},goodsLimit:function(t,n){var e=this.cartData[0].cartList[n];"plus"==t.type?e.max_buy>0&&e.max_buy<e.stock?this.$util.showToast({title:"该商品每人限购"+e.max_buy+"件"}):this.$util.showToast({title:"库存不足"}):this.$util.showToast({title:"最少购买"+t.value+"件"})},toLogin:function(){this.$refs.login.open()}}};n.default=d}).call(this,e("543d")["default"])},da74:function(t,n,e){"use strict";(function(t){e("5558");o(e("66fd"));var n=o(e("8822"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},e415:function(t,n,e){"use strict";var o=e("41d1"),i=e.n(o);i.a}},[["da74","common/runtime","common/vendor"]]]);