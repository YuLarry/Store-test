(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/list/list"],{"0091":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r("b8ea")),s=a(r("b6ac"));function a(e){return e&&e.__esModule?e:{default:e}}var i=function(){r.e("components/uni-load-more/uni-load-more").then(function(){return resolve(r("274b"))}.bind(null,r)).catch(r.oe)},n=function(){r.e("components/payment/payment").then(function(){return resolve(r("fa8d"))}.bind(null,r)).catch(r.oe)},u={data:function(){return{scrollInto:"",orderStatus:"all",statusList:[],orderList:[],contentText:{},mergePayOrder:[],isIphoneX:!1,evaluateConfig:{evaluate_audit:1,evaluate_show:0,evaluate_status:1},orderData:{},payMoney:0,payMoneyMerge:0,token:null,order_id:0,searchText:"",pageText:""}},components:{uniLoadMore:i,nsPayment:n},mixins:[o.default,s.default],onLoad:function(e){e.status&&(this.orderStatus=e.status),e.order_id&&(this.order_id=e.order_id)},onShow:function(){var t=this;this.$langConfig.refresh(),this.isIphoneX=this.$util.uniappIsIPhoneX(),this.getEvaluateConfig(),this.getOrderStatus(),e.getStorageSync("token")?(this.token=e.getStorageSync("token"),this.$refs.mescroll&&this.$refs.mescroll.refresh()):setTimeout((function(){t.$refs.login.open("/pages/order/list/list?status="+t.orderStatus)}))},methods:{ontabtap:function(e){var t=e.target.dataset.current||e.currentTarget.dataset.current;this.orderStatus=this.statusList[t].status,""==this.orderStatus&&(this.mergePayOrder=[]),this.$refs.loadingCover.show(),this.$refs.mescroll.refresh()},getListData:function(e){var t=this;this.$api.sendRequest({url:"/api/order/lists",data:{page:e.num,page_size:e.size,order_status:this.orderStatus,order_id:this.order_id,searchText:this.pageText},success:function(r){var o=[],s=r.message,a=0;0==r.code&&r.data?(o=r.data.list,a=r.data.auto_close):t.$util.showToast({title:s}),e.endSuccess(o.length),1==e.num&&(t.orderList=[],t.order_id=0),t.orderList=t.orderList.concat(o);var i=Date.parse(new Date)/1e3;t.orderList.forEach((function(e){e.discountTimeMachine=t.$util.countDown(e.create_time+a-i),e.order_goods.forEach((function(e){if(e.sku_spec_format)try{e.sku_spec_format=JSON.parse(e.sku_spec_format)}catch(t){e.sku_spec_format=e.sku_spec_format}else e.sku_spec_format=[]}))})),t.$refs.loadingCover&&t.$refs.loadingCover.hide()},fail:function(r){e.endErr(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},getOrderStatus:function(){this.statusList=[{status:"all",name:this.$lang("all"),id:"status_0"},{status:"waitpay",name:this.$lang("waitPay"),id:"status_1"},{status:"waitsend",name:this.$lang("readyDelivery"),id:"status_2"},{status:"waitconfirm",name:this.$lang("waitDelivery"),id:"status_3"},{status:"waitrate",name:this.$lang("waitEvaluate"),id:"status_4"}]},operation:function(e,t){var r=this;this.status;switch(e){case"orderPay":this.orderData=t,this.payMoney=parseFloat(t.pay_money),this.orderPay(t);break;case"orderClose":this.orderClose(t.order_id,(function(){r.$refs.mescroll.refresh()}));break;case"memberTakeDelivery":this.orderDelivery(t.order_id,(function(){r.$refs.mescroll.refresh()}));break;case"trace":this.$util.redirectTo("/otherpages/order/logistics/logistics",{order_id:t.order_id});break;case"memberOrderEvaluation":this.$util.redirectTo("/otherpages/order/evaluate/evaluate",{order_id:t.order_id});break}},orderDetail:function(e){switch(parseInt(e.order_type)){case 2:this.$util.redirectTo("/pages/order/detail_pickup/detail_pickup",{order_id:e.order_id});break;case 3:this.$util.redirectTo("/pages/order/detail_local_delivery/detail_local_delivery",{order_id:e.order_id});break;case 4:this.$util.redirectTo("/otherpages/order/detail_virtual/detail_virtual",{order_id:e.order_id});break;default:this.$util.redirectTo("/pages/order/detail/detail",{order_id:e.order_id});break}},selectOrder:function(e,t){-1!=this.$util.inArray(e,this.mergePayOrder)?(this.mergePayOrder.splice(this.$util.inArray(e,this.mergePayOrder),1),this.payMoneyMerge-=parseFloat(t)):(this.payMoneyMerge+=parseFloat(t),this.mergePayOrder.push(e))},mergePay:function(){var e=this;this.mergePayOrder.length&&this.$api.sendRequest({url:"/api/order/pay",data:{order_ids:this.mergePayOrder.toString()},success:function(t){t.code>=0?e.$refs.choosePaymentMergePopup.getPayInfo(t.data):e.$util.showToast({title:t.message})}})},imageError:function(e,t){this.orderList[e].order_goods[t].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},getEvaluateConfig:function(){var e=this;this.$api.sendRequest({url:"/api/goodsevaluate/config",success:function(t){if(0==t.code){var r=t.data;e.evaluateConfig=r}}})},openChoosePayment:function(){this.$refs.choosePaymentPopup.open()},openChoosePaymentMerge:function(){this.$refs.choosePaymentMergePopup.open()},search:function(){this.pageText=this.searchText,this.$refs.mescroll.refresh()}},computed:{mpOrderList:function(){if(this.orderList[this.status])return this.orderList[this.status].list||[]},storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(e,t){e&&(this.token=e,this.$refs.mescroll.refresh())}}};t.default=u}).call(this,r("543d")["default"])},"0293":function(e,t,r){"use strict";r.r(t);var o=r("09df"),s=r("25e6");for(var a in s)"default"!==a&&function(e){r.d(t,e,(function(){return s[e]}))}(a);r("2aa0"),r("b0a8");var i,n=r("f0c5"),u=Object(n["a"])(s["default"],o["b"],o["c"],!1,null,"cb62cc50",null,!1,o["a"],i);t["default"]=u.exports},"04dc":function(e,t,r){"use strict";(function(e){r("67ba");o(r("66fd"));var t=o(r("0293"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},"0509":function(e,t,r){},"09df":function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o}));var o={uniCountDown:function(){return r.e("components/uni-count-down/uni-count-down").then(r.bind(null,"9fb1"))},nsEmpty:function(){return r.e("components/ns-empty/ns-empty").then(r.bind(null,"90af"))},nsLogin:function(){return Promise.all([r.e("common/vendor"),r.e("components/ns-login/ns-login")]).then(r.bind(null,"2bc6"))},loadingCover:function(){return r.e("components/loading-cover/loading-cover").then(r.bind(null,"4c1d"))}},s=function(){var e=this,t=e.$createElement,r=(e._self._c,e.$lang("common.currencySymbol")),o=e.token&&e.orderList.length>0?e.__map(e.orderList,(function(t,r){var o=e.__get_orig(t),s="waitpay"==e.orderStatus&&0==t.order_status?e.$util.inArray(t.order_id,e.mergePayOrder):null,a=e.$lang("common.currencySymbol"),i=e.__map(t.order_goods,(function(t,r){var o=e.__get_orig(t),s=e.$util.img(t.sku_image,{size:"mid"});return{$orig:o,g1:s}})),n=t.action.length>0&&0==t.order_status?e.$util.img("/upload/uniapp/order/time.png"):null;return{$orig:o,g0:s,m0:a,l0:i,g2:n}})):null,s=!e.token||e.orderList.length>0?null:e.$lang("emptyTips");e.$mp.data=Object.assign({},{$root:{m1:r,l1:o,m2:s}})},a=[]},"25e6":function(e,t,r){"use strict";r.r(t);var o=r("0091"),s=r.n(o);for(var a in o)"default"!==a&&function(e){r.d(t,e,(function(){return o[e]}))}(a);t["default"]=s.a},"2aa0":function(e,t,r){"use strict";var o=r("30d7"),s=r.n(o);s.a},"30d7":function(e,t,r){},b0a8:function(e,t,r){"use strict";var o=r("0509"),s=r.n(o);s.a}},[["04dc","common/runtime","common/vendor"]]]);