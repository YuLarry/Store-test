(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/presale/order_list/order_list"],{"145f":function(e,t,n){"use strict";n.r(t);var r=n("6500"),a=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);t["default"]=a.a},"5ae0":function(e,t,n){"use strict";(function(e){n("4b62");r(n("66fd"));var t=r(n("f86c"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},6500:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n("8c65")),a=s(n("245b"));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(){n.e("components/uni-load-more/uni-load-more").then(function(){return resolve(n("3fb4"))}.bind(null,n)).catch(n.oe)},i=function(){n.e("components/payment/payment").then(function(){return resolve(n("53a5"))}.bind(null,n)).catch(n.oe)},u={data:function(){return{scrollInto:"",orderStatus:"",statusList:[],orderList:[],contentText:{},isIphoneX:!1,orderData:null,payMoney:0,payType:"",timestamp:0,memberBalance:0,isBalance:0,isSub:!1,token:null}},components:{uniLoadMore:o,nsPayment:i},mixins:[r.default,a.default],onLoad:function(e){e.status&&(this.orderStatus=e.status)},computed:{balanceDeduct:function(){if(this.orderData&&1==this.orderData.order_status&&""==this.orderData.final_out_trade_no&&this.memberBalance>0){var e=this.orderData.order_money-this.orderData.presale_deposit_money;return(this.memberBalance>e?e:this.memberBalance).toFixed(2)}return 0},storeToken:function(){return this.$store.state.token}},onShow:function(){var t=this;this.$langConfig.refresh(),this.isIphoneX=this.$util.uniappIsIPhoneX(),this.getOrderStatus(),e.getStorageSync("token")?(this.token=e.getStorageSync("token"),this.getMmemberBalance()):setTimeout((function(){t.$refs.login.open("/promotionpages/presale/order_list/order_list")}))},methods:{getMmemberBalance:function(){var e=this;this.$api.sendRequest({url:"/api/memberaccount/info",data:{account_type:"balance,balance_money"},success:function(t){t.data&&(e.memberBalance=parseFloat(t.data.balance)+parseFloat(t.data.balance_money))}})},ontabtap:function(e){var t=e.target.dataset.current||e.currentTarget.dataset.current;this.orderStatus=this.statusList[t].status,this.$refs.loadingCover.show(),this.$refs.mescroll.refresh()},getListData:function(e){var t=this;this.$api.sendRequest({url:"/presale/api/order/page",data:{page:e.num,page_size:e.size,order_status:this.orderStatus},success:function(n){t.timestamp=n.timestamp;var r=[],a=n.message;0==n.code&&n.data?r=n.data.list:t.$util.showToast({title:a}),e.endSuccess(r.length),1==e.num&&(t.orderList=[]),t.orderList=t.orderList.concat(r),t.$refs.loadingCover&&t.$refs.loadingCover.hide()},fail:function(n){e.endErr(),t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},getOrderStatus:function(){this.statusList=[{status:"",name:"全部",id:"status_0"},{status:0,name:"待付款",id:"status_0"},{status:1,name:"待付尾款",id:"status_1"},{status:2,name:"已完成",id:"status_2"},{status:-1,name:"已关闭",id:"status_3"}]},operation:function(e,t){var n=this;switch(e){case"deleteOrder":this.deleteOrder(t.id,(function(){n.$refs.mescroll.refresh()}));break;case"orderClose":this.orderClose(t.id,(function(){n.$refs.mescroll.refresh()}));break;case"orderPayDeposit":this.orderData=t,this.openPaymentPopup(t,"presale_deposit_money");break;case"refundDeposit":this.refundDeposit(t.id,(function(){n.$refs.mescroll.refresh()}));break;case"orderPayFinal":this.orderData=t,this.openPaymentPopup(t,"final_money");break}},orderDetail:function(e){this.$util.redirectTo("/promotionpages/presale/order_detail/order_detail",{order_id:e.id})},imageError:function(e){this.orderList[e].sku_image=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},pay:function(){var e=this;this.isSub||(this.isSub=!0,"final_money"==this.payType?this.orderPayFinal(this.orderData,(function(){e.$refs.mescroll.refresh()})):"presale_deposit_money"==this.payType&&this.orderPayDeposit(this.orderData,(function(){e.$refs.mescroll.refresh()})))},useBalance:function(){this.isBalance?(this.isBalance=0,this.payMoney+=parseFloat(this.balanceDeduct)):(this.isBalance=1,this.payMoney-=parseFloat(this.balanceDeduct))}},watch:{storeToken:function(e,t){e&&(this.token=e,this.getMmemberBalance(),this.$refs.mescroll.refresh())}}};t.default=u}).call(this,n("543d")["default"])},"88d5":function(e,t,n){"use strict";var r=n("b4f6"),a=n.n(r);a.a},"985e":function(e,t,n){"use strict";var r=n("d669"),a=n.n(r);a.a},b4f6:function(e,t,n){},d669:function(e,t,n){},d676:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r}));var r={nsEmpty:function(){return n.e("components/ns-empty/ns-empty").then(n.bind(null,"0e02"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"61d0"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"b1ae"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$lang("common.currencySymbol")),r=e.token&&e.orderList.length>0?e.__map(e.orderList,(function(t,n){var r=e.__get_orig(t),a=e.$util.img(t.sku_image,{size:"mid"}),s=0===t.order_status?e.$lang("common.currencySymbol"):null,o=0!==t.order_status&&1===t.order_status?e.$lang("common.currencySymbol"):null,i=0!==t.order_status&&1!==t.order_status&&2===t.order_status?e.$lang("common.currencySymbol"):null,u=0!==t.order_status&&1!==t.order_status&&2!==t.order_status&&-1===t.order_status?e.$lang("common.currencySymbol"):null;return{$orig:r,g0:a,m1:s,m2:o,m3:i,m4:u}})):null,a=!e.token||e.orderList.length>0?null:e.$lang("emptyTips");e.$mp.data=Object.assign({},{$root:{m0:n,l0:r,m5:a}})},s=[]},f86c:function(e,t,n){"use strict";n.r(t);var r=n("d676"),a=n("145f");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("88d5"),n("985e");var o,i=n("f0c5"),u=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"21f471da",null,!1,r["a"],o);t["default"]=u.exports}},[["5ae0","common/runtime","common/vendor"]]]);