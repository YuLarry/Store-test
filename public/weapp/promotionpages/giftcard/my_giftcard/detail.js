(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/giftcard/my_giftcard/detail"],{2387:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var a={uniNumberBox:function(){return i.e("components/uni-number-box/uni-number-box").then(i.bind(null,"5d46"))},loadingCover:function(){return i.e("components/loading-cover/loading-cover").then(i.bind(null,"b1ae"))},nsLogin:function(){return Promise.all([i.e("common/vendor"),i.e("components/ns-login/ns-login")]).then(i.bind(null,"61d0"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.$util.img(t.giftcardDetail.card_cover)),a=i?t.$util.img(t.giftcardDetail.card_cover):null,n=1!=t.giftcardDetail.time_type&&2==t.giftcardDetail.time_type?t.$util.timeStampTurnTime(t.giftcardDetail.youxiao_time):null,o=t.giftcardDetail.goods_list?t.__map(t.giftcardDetail.goods_list,(function(e,i){var a=t.__get_orig(e),n=t.goodsImg(e.sku_image);return{$orig:a,m0:n}})):null;t.$mp.data=Object.assign({},{$root:{g0:i,g1:a,g2:n,l0:o}})},o=[]},"4e49":function(t,e,i){"use strict";i.r(e);var a=i("fc27"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},8637:function(t,e,i){},"921c":function(t,e,i){"use strict";i.r(e);var a=i("2387"),n=i("4e49");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("e6f4");var r,s=i("f0c5"),c=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);e["default"]=c.exports},b292:function(t,e,i){"use strict";(function(t){i("4b62");a(i("66fd"));var e=a(i("921c"));function a(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},e6f4:function(t,e,i){"use strict";var a=i("8637"),n=i.n(a);n.a},fc27:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(){i.e("components/payment/payment").then(function(){return resolve(i("53a5"))}.bind(null,i)).catch(i.oe)},n={components:{nsPayment:a},data:function(){return{order:1,giftcardDetail:{},max_buy:0,num:1,id:"",isSub:!1,is_balance:0,payMoney:1}},onLoad:function(t){var e=t.id;this.getData(e),this.id=t.id},onShow:function(){this.$langConfig.refresh()},methods:{goodsImg:function(t){var e=t.split(",");return e[0]?this.$util.img(e[0],{size:"mid"}):this.$util.getDefaultImage().default_goods_img},getData:function(t){var e=this;this.$api.sendRequest({url:"/giftcard/api/giftcard/giftcardDetail",data:{id:t},success:function(t){0==t.code&&t.data?(e.giftcardDetail=t.data,e.max_buy=parseFloat(t.data.max_buy),e.$refs.loadingCover&&e.$refs.loadingCover.hide()):e.$refs.loadingCover&&e.$refs.loadingCover.hide()},fail:function(t){}})},change:function(t){this.num=t},openChoosePayment:function(){if(0!=this.payMoney&&(this.payMoney=this.giftcardDetail.selling_price*this.num),!t.getStorageSync("token"))return this.$refs.login.open("/promotionpages/giftcard/my_giftcard/detail?id="+this.id),!1;0==this.giftcardDetail.card_count?this.$util.showToast({title:"库存不足"}):(t.setStorageSync("paySource","giftcard"),this.$refs.choosePaymentPopup.open(),this.subscribeMessage())},subscribeMessage:function(){this.$api.sendRequest({url:"/weapp/api/weapp/messagetmplids",data:{keywords:"ORDER_PAY,ORDER_DELIVERY,ORDER_TAKE_DELIVERY"},success:function(e){e.data.length&&t.requestSubscribeMessage({tmplIds:e.data,success:function(t){},fail:function(t){console.log("fail",t)}})}})},gotoBuy:function(){var e=this;this.$api.sendRequest({url:"/giftcard/api/giftcard/createorder",data:{id:this.id,selling_price:this.giftcardDetail.selling_price,num:this.num,order_total_price:this.num*this.giftcardDetail.selling_price,is_balance:this.is_balance},success:function(i){i.data&&0==i.code?0==e.payMoney?e.$util.redirectTo("/otherpages/pay/result/result",{code:i.data},"redirectTo"):(t.setStorageSync("paySource","giftcard"),e.out_trade_no=i.data,e.$refs.choosePaymentPopup.getPayInfo(i.data),e.isSub=!1):(e.isSub=!1,t.hideLoading(),e.$util.showToast({title:i.message}))}})},useBalance:function(){this.is_balance?this.is_balance=0:(this.payMoney=0,this.is_balance=1),this.$forceUpdate()}},watch:{is_balance:function(t,e){0==t?this.payMoney=this.giftcardDetail.selling_price*this.num:this.giftcardDetail.member_info.balance_total-this.giftcardDetail.selling_price>=0?this.payMoney=0:this.payMoney=this.giftcardDetail.selling_price-this.giftcardDetail.member_info.balance_total}},computed:{balanceDeduct:function(){if(1==this.giftcardDetail.is_balance)return this.giftcardDetail.member_info.balance_total<=parseFloat(this.giftcardDetail.selling_price).toFixed(2)?parseFloat(this.giftcardDetail.member_info.balance_total).toFixed(2):parseFloat(this.giftcardDetail.selling_price).toFixed(2)*this.num}}};e.default=n}).call(this,i("543d")["default"])}},[["b292","common/runtime","common/vendor"]]]);