(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/jielong/jielong"],{3124:function(e,t,i){"use strict";(function(e){i("67ba");n(i("66fd"));var t=n(i("72e7"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},"5b76":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return n}));var n={uniCountDown:function(){return i.e("components/uni-count-down/uni-count-down").then(i.bind(null,"9fb1"))},uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,"d7b6"))},nsLogin:function(){return Promise.all([i.e("common/vendor"),i.e("components/ns-login/ns-login")]).then(i.bind(null,"2bc6"))},loadingCover:function(){return i.e("components/loading-cover/loading-cover").then(i.bind(null,"4c1d"))}},o=function(){var e=this,t=e.$createElement,i=(e._self._c,e.__map(e.jielong_list,(function(t,i){var n=e.__get_orig(t),o=e.goodsImg(t.goods_image),s=t.member_headimg.length>0?e.__map(t.member_headimg.slice(0,3),(function(t,i){var n=e.__get_orig(t),o=e.$util.img(t),s=o?e.$util.img(t):null,a=o?null:e.$util.getDefaultImage();return{$orig:n,g0:o,g1:s,g2:a}})):null;return{$orig:n,m0:o,l0:s}}))),n=0==e.jielong_buy_page.count?e.$util.img("upload/uniapp/jielong/left.png"):null,o=0==e.jielong_buy_page.count?e.$util.img("upload/uniapp/jielong/right.png"):null,s=0==e.jielong_buy_page.count?e.$util.img("upload/uniapp/jielong/wuren.png"):null,a=0!=e.jielong_buy_page.count?e.$util.img("upload/uniapp/jielong/left.png"):null,u=0!=e.jielong_buy_page.count?e.$util.img("upload/uniapp/jielong/right.png"):null,r=0!=e.jielong_buy_page.count?e.__map((e.jielong_buy_page.list||"").slice(0,e.cutting),(function(t,i){var n=e.__get_orig(t),o=""==t.headimg?e.$util.getDefaultImage():null,s=""!=t.headimg?e.$util.img(t.headimg):null,a=e.$util.timeStampTurnTime(t.pay_time);return{$orig:n,g8:o,g9:s,g10:a}})):null,l=0==e.returnShoping.length?e.$util.img("upload/uniapp/jielong/wurenOne.png"):null,g=0!=e.returnShoping.length?e.__map(e.returnShoping,(function(t,i){var n=e.__get_orig(t),o=e.bottomImage(t.sku_image),s=o?null:e.$util.img(t.sku_image);return{$orig:n,m1:o,g12:s}})):null,c=e.switchImage?null:e.$util.img(e.specifications.sku_image),d=e.$util.img(e.shareImage),p=e.horseRace&&""==e.lantern.headimg?e.$util.getDefaultImage():null,h=e.horseRace&&""!=e.lantern.headimg?e.$util.img(e.lantern.headimg):null;e.$mp.data=Object.assign({},{$root:{l1:i,g3:n,g4:o,g5:s,g6:a,g7:u,l2:r,g11:l,l3:g,g13:c,g14:d,g15:p,g16:h}})},s=[]},"60b1":function(e,t,i){"use strict";i.r(t);var n=i("af1a"),o=i.n(n);for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);t["default"]=o.a},"62b6":function(e,t,i){},"72e7":function(e,t,i){"use strict";i.r(t);var n=i("5b76"),o=i("60b1");for(var s in o)"default"!==s&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("bccb");var a,u=i("f0c5"),r=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"13a35a26",null,!1,n["a"],a);t["default"]=r.exports},af1a:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(i("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t,i,n,o,s,a){try{var u=e[s](a),r=u.value}catch(l){return void i(l)}u.done?t(r):Promise.resolve(r).then(n,o)}function a(e){return function(){var t=this,i=arguments;return new Promise((function(n,o){var a=e.apply(t,i);function u(e){s(a,n,o,u,r,"next",e)}function r(e){s(a,n,o,u,r,"throw",e)}u(void 0)}))}}var u=function(){i.e("components/uni-popup/uni-popup").then(function(){return resolve(i("d7b6"))}.bind(null,i)).catch(i.oe)},r=function(){Promise.all([i.e("common/vendor"),i.e("components/ns-goods-sku/ns-goods-sku-category")]).then(function(){return resolve(i("2230"))}.bind(null,i)).catch(i.oe)},l={data:function(){return{jielong_id:"",jielong_info:{},jielong_list:[{goods_image:"",member_headimg:[]}],jielong_buy_page:{},time:"",timer:"",selsectDetails:[],num:"",money:0,specifications:{},specificationsItem:[{spec_name:"",spec_value_name:"",value:[{sku_id:"",spec_value_name:""}]}],index:0,zIndex:!0,addshop:[],shoplist:[],display:!1,returnShoping:[],shareImage:"",switchImage:!1,seeMores:!0,status:"",cutting:5,horseRace:!0,lantern:{},token:"",memberId:0,shareImg:""}},components:{uniPopup:u,nsGoodsSkuCategory:r},onLoad:function(t){var i=this;if(this.jielong_id=t.jielong_id,t.scene){var n=decodeURIComponent(t.scene);n=n.split("&"),n.length&&n.forEach((function(e){-1!=e.indexOf("jielong_id")&&(i.jielong_id=e.split("-")[1])}))}if(this.$util.getMemberId().then((function(e){i.memberId=e})).catch((function(e){console.log("reject",e)})),t.source_member&&e.setStorageSync("source_member",t.source_member),t.scene){n=decodeURIComponent(t.scene);n=n.split("&"),n.length&&n.forEach((function(t){-1!=t.indexOf("sku_id")&&(i.skuId=t.split("-")[1]),-1!=t.indexOf("m")&&e.setStorageSync("source_member",t.split("-")[1]),-1!=t.indexOf("is_test")&&e.setStorageSync("is_test",1)}))}this.token=e.getStorageSync("token"),this.getJielongDetail(),this.getJielongBuyPage(),this.shopList(),this.openCartPopup()},onshow:function(){e.getStorageSync("token")&&e.getStorageSync("source_member")&&this.$util.onSourceMember(e.getStorageSync("source_member"))},onShareAppMessage:function(e){var t=this.jielong_info.jielong_name,i=this.$util.getCurrentShareRoute(this.memberId),n=i.path;return{title:t,path:n,imageUrl:"",success:function(e){},fail:function(e){}}},onShareTimeline:function(){var e=this.$util.getCurrentShareRoute(this.memberId),t=e.query;return{title:this.jielong_info.jielong_name,query:t,imageUrl:""}},methods:{toLogin:function(){if(!e.getStorageSync("token")&&this.$refs.login)return this.$refs.login.open("/promotionpages/jielong/jielong?jielong_id="+this.jielong_id),!0},getJielongDetail:function(){var e=this;this.$api.sendRequest({url:"/jielong/api/Goods/jielongDetail",data:{jielong_id:this.jielong_id},success:function(t){e.status=t.data.info.status,0==t.code&&t.data&&(e.jielong_info=t.data.info,e.jielong_list=t.data.list,e.timer=t.timestamp,e.jielong_info.start_time>e.timer?e.time=e.$util.countDown(e.jielong_info.start_time-e.timer):e.jielong_info.start_time<e.timer&&e.jielong_info.end_time>e.timer&&(e.time=e.$util.countDown(e.jielong_info.end_time-e.timer)),e.$refs.loadingCover&&e.$refs.loadingCover.hide())}})},getJielongBuyPage:function(){var e=this;this.$api.sendRequest({url:"/jielong/api/Goods/jielongBuyPage",data:{jielong_id:this.jielong_id},success:function(t){0==t.code&&t.data&&(e.jielong_buy_page=t.data,e.jielong_buy_page.list.length>0?(e.horseRace=!0,e.running()):e.horseRace=!1)}})},goodsImg:function(e){var t=e.split(",");return t[0]?this.$util.img(t[0],{size:"mid"}):this.$util.getDefaultImage().default_goods_img},getGoodsSkuDetail:function(t){var i=this;return a(n.default.mark((function o(){var s,a;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getStorageSync("token")){n.next=3;break}return i.$refs.login.open(i.currentRoute),n.abrupt("return");case 3:return n.next=5,i.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",async:!1,data:{sku_id:t}});case 5:s=n.sent,a=s.data,a?(i.goodsSkuDetail=a,0==i.skuId&&(i.skuId=i.goodsSkuDetail.sku_id),i.goodsSkuDetail.unit=i.goodsSkuDetail.unit||"件",i.goodsSkuDetail.show_price=i.goodsSkuDetail.discount_price,i.goodsSkuDetail.sku_spec_format&&(i.goodsSkuDetail.sku_spec_format=JSON.parse(i.goodsSkuDetail.sku_spec_format)),i.goodsSkuDetail.goods_spec_format&&(i.goodsSkuDetail.goods_spec_format=JSON.parse(i.goodsSkuDetail.goods_spec_format))):i.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 8:case"end":return n.stop()}}),o)})))()},settlement:function(){var t=this,i=[];if(0==this.shoplist.length)return!1;this.shoplist.forEach((function(e){i.push(e.cart_id)})),i=i.toString(),this.$util.redirectTo("/pages/order/payment/payment"),e.setStorage({key:"orderCreateData",data:{cart_ids:i,jielong_id:this.jielong_id},success:function(){t.$util.redirectTo("/pages/order/payment/payment")}})},CartPopup:function(){if(this.toLogin())return this.toLogin(),!1;this.$refs.cartPopup.open(),this.openCartPopup()},openCartPopup:function(){var e=this;this.$api.sendRequest({url:"/jielong/api/cart/goodsLists",data:{jielong_id:this.jielong_id},success:function(t){e.num=0,e.money=0;var i=t.data;i.length>0&&i.forEach((function(t){e.num=parseInt(t.num)+e.num,e.money=parseInt(t.price)*parseInt(t.num)+e.money})),e.returnShoping=i}})},closeCartPopup:function(){this.$refs.cartPopup.close()},singleSkuReduce:function(e){var t=this,i=e.sku_id;this.shoplist.forEach((function(e){if(i==e.sku_id&&e.num>1){var n=--e.num;t.edit(e.cart_id,n)}else i==e.sku_id&&1===e.num&&t.delectItem(e.cart_id)})),this.getJielongDetail()},singleSkuPlus:function(t){var i=this;if(!e.getStorageSync("token"))return this.toLogin(),!1;if(0==this.status)return e.showToast({title:"活动未开始",icon:"none"}),!1;var n=t.sku_id,o=!0;0==this.shoplist.length?this.addShop(n):(this.shoplist.forEach((function(e){if(n===e.sku_id){var t=++e.num;i.edit(e.cart_id,t),o=!1}})),o&&this.addShop(n)),this.getJielongDetail()},delect:function(){var t=this;if(!e.getStorageSync("token"))return this.toLogin(),!1;this.$api.sendRequest({url:"/jielong/api/cart/clear",data:{jielong_id:this.jielong_id},success:function(e){t.shopList(),t.openCartPopup(),t.getJielongDetail()}})},codeView:function(t){var i=this;if(!e.getStorageSync("token"))return this.toLogin(),!1;if(0==this.status)return e.showToast({title:"活动未开始",icon:"none"}),!1;this.switchs(t),this.$refs.erWeiPopup.open(),this.zIndex=!1,this.display=!1;0==this.shoplist.length?this.display=!1:this.shoplist.forEach((function(e){t==e.sku_id&&(i.display=!0)}))},close:function(){this.$refs.erWeiPopup.close(),this.zIndex=!0},switchs:function(e){var t=this;this.title="",this.shopList(),this.openCartPopup(),this.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",data:{sku_id:e},success:function(i){t.specifications=i.data,t.specificationsItem=JSON.parse(t.specifications.goods_spec_format),t.specificationsItem.forEach((function(i){i.value.forEach((function(i){i.sku_id==e&&(t.title=t.title+i.spec_value_name+"/")}))})),t.specifications.title=t.title,t.switchImage=t.specifications.sku_image.includes("http")}}),this.display=!1,this.shoplist.forEach((function(i){e==i.sku_id&&(t.display=!0)}))},shopList:function(){var e=this;this.toLogin(),this.$api.sendRequest({url:"/jielong/api/cart/lists",data:{jielong_id:this.jielong_id},success:function(t){e.shoplist=t.data}})},addShop:function(e){var t=this;this.$api.sendRequest({url:"/jielong/api/cart/add",data:{jielong_id:this.jielong_id,num:1,sku_id:e},success:function(e){t.addshop=e.data,t.shopList(),t.openCartPopup(),t.getJielongDetail(),-1!=e.code||t.$util.showToast({title:e.message})}})},edit:function(e,t){var i=this;this.$api.sendRequest({url:"/jielong/api/cart/edit",data:{jielong_id:this.jielong_id,num:t,cart_id:e},success:function(e){i.shopList(),i.openCartPopup(),i.getJielongDetail(),-1!=e.code||i.$util.showToast({title:e.message})}})},delectItem:function(e){var t=this;this.$api.sendRequest({url:"/jielong/api/cart/delete",data:{num:0,cart_id:e},success:function(e){t.shopList(),t.openCartPopup(),t.getJielongDetail()}}),this.display=!1},shoppingCart:function(e){this.display=!0;var t=e.sku_id;this.addShop(t),this.openCartPopup(),this.getJielongDetail()},share:function(){var t=this;if(!e.getStorageSync("token"))return this.toLogin(),!1;this.shareImage="",e.showLoading({title:"加载中"}),this.$refs.share.open();var i=JSON.stringify({jielong_id:this.jielong_id});this.$api.sendRequest({url:"/jielong/api/goods/poster",data:{page:"/promotionpages/jielong/jielong",qrcode_param:i},success:function(i){e.hideLoading(),t.shareImage=i.data.poster_path}})},order:function(){this.$util.redirectTo("/pages/order/list/list")},bottomImage:function(e){return!!e.includes("http")},seeMore:function(){this.seeMores=!this.seeMores,this.seeMores?this.cutting=5:this.cutting=this.jielong_buy_page.count},running:function(){var e=this,t=JSON.parse(JSON.stringify(this.jielong_buy_page.list)),i=1,n=t[0].nickname;n=n.slice(0,1),t[0].content=n+"**",this.lantern=t[0],setInterval((function(){i<t.length?(n=t[i].nickname,n=n.slice(0,1),t[i].content=n+"**",e.lantern=t[i],i++):i=0}),1e4)}}};t.default=l}).call(this,i("543d")["default"])},bccb:function(e,t,i){"use strict";var n=i("62b6"),o=i.n(n);o.a}},[["3124","common/runtime","common/vendor"]]]);