(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["promotionpages/jielong/jielong"],{"2970e":function(t,i,e){},6900:function(t,i,e){"use strict";e.r(i);var n=e("d58e"),o=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(i,t,(function(){return n[t]}))}(s);i["default"]=o.a},"776b":function(t,i,e){"use strict";e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return s})),e.d(i,"a",(function(){return n}));var n={uniCountDown:function(){return e.e("components/uni-count-down/uni-count-down").then(e.bind(null,"d753"))},uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"2d2c"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"61d0"))}},o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.__map(t.jielong_list,(function(i,e){var n=t.__get_orig(i),o=t.goodsImg(i.goods_image),s=i.member_headimg.length>0?t.__map(i.member_headimg.slice(0,3),(function(i,e){var n=t.__get_orig(i),o=t.$util.img(i),s=o?t.$util.img(i):null,a=o?null:t.$util.getDefaultImage();return{$orig:n,g0:o,g1:s,g2:a}})):null;return{$orig:n,m0:o,l0:s}}))),n=0==t.jielong_buy_page.count?t.$util.img("upload/uniapp/jielong/left.png"):null,o=0==t.jielong_buy_page.count?t.$util.img("upload/uniapp/jielong/right.png"):null,s=0==t.jielong_buy_page.count?t.$util.img("upload/uniapp/jielong/wuren.png"):null,a=0!=t.jielong_buy_page.count?t.$util.img("upload/uniapp/jielong/left.png"):null,u=0!=t.jielong_buy_page.count?t.$util.img("upload/uniapp/jielong/right.png"):null,r=0!=t.jielong_buy_page.count?t.__map((t.jielong_buy_page.list||"").slice(0,t.cutting),(function(i,e){var n=t.__get_orig(i),o=""==i.headimg?t.$util.getDefaultImage():null,s=""!=i.headimg?t.$util.img(i.headimg):null,a=t.$util.timeStampTurnTime(i.pay_time);return{$orig:n,g8:o,g9:s,g10:a}})):null,l=0==t.returnShoping.length?t.$util.img("upload/uniapp/jielong/wurenOne.png"):null,g=0!=t.returnShoping.length?t.__map(t.returnShoping,(function(i,e){var n=t.__get_orig(i),o=t.bottomImage(i.sku_image),s=o?null:t.$util.img(i.sku_image);return{$orig:n,m1:o,g12:s}})):null,c=t.switchImage?null:t.$util.img(t.specifications.sku_image),d=t.$util.img(t.shareImage),p=t.horseRace&&""==t.lantern.headimg?t.$util.getDefaultImage():null,h=t.horseRace&&""!=t.lantern.headimg?t.$util.img(t.lantern.headimg):null;t.$mp.data=Object.assign({},{$root:{l1:e,g3:n,g4:o,g5:s,g6:a,g7:u,l2:r,g11:l,l3:g,g13:c,g14:d,g15:p,g16:h}})},s=[]},"9c85":function(t,i,e){"use strict";var n=e("2970e"),o=e.n(n);o.a},a018:function(t,i,e){"use strict";(function(t){e("4b62");n(e("66fd"));var i=n(e("b352"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(i.default)}).call(this,e("543d")["createPage"])},b352:function(t,i,e){"use strict";e.r(i);var n=e("776b"),o=e("6900");for(var s in o)"default"!==s&&function(t){e.d(i,t,(function(){return o[t]}))}(s);e("9c85");var a,u=e("f0c5"),r=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"99033666",null,!1,n["a"],a);i["default"]=r.exports},d58e:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=o(e("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,i,e,n,o,s,a){try{var u=t[s](a),r=u.value}catch(l){return void e(l)}u.done?i(r):Promise.resolve(r).then(n,o)}function a(t){return function(){var i=this,e=arguments;return new Promise((function(n,o){var a=t.apply(i,e);function u(t){s(a,n,o,u,r,"next",t)}function r(t){s(a,n,o,u,r,"throw",t)}u(void 0)}))}}var u=function(){e.e("components/uni-popup/uni-popup").then(function(){return resolve(e("2d2c"))}.bind(null,e)).catch(e.oe)},r=function(){Promise.all([e.e("common/vendor"),e.e("components/ns-goods-sku/ns-goods-sku-category")]).then(function(){return resolve(e("9cab"))}.bind(null,e)).catch(e.oe)},l={data:function(){return{jielong_id:"",jielong_info:{},jielong_list:[{goods_image:"",member_headimg:[]}],jielong_buy_page:{},time:"",timer:"",selsectDetails:[],num:"",money:0,specifications:{},specificationsItem:[{spec_name:"",spec_value_name:"",value:[{sku_id:"",spec_value_name:""}]}],index:0,zIndex:!0,addshop:[],shoplist:[],display:!1,returnShoping:[],shareImage:"",switchImage:!1,seeMores:!0,status:"",cutting:5,horseRace:!0,lantern:{},token:""}},components:{uniPopup:u,nsGoodsSkuCategory:r},onLoad:function(i){var e=this;if(this.jielong_id=i.jielong_id,i.scene){var n=decodeURIComponent(i.scene);n=n.split("&"),n.length&&n.forEach((function(t){-1!=t.indexOf("jielong_id")&&(e.jielong_id=t.split("-")[1])}))}this.token=t.getStorageSync("token"),this.getJielongDetail(),this.getJielongBuyPage(),this.shopList(),this.openCartPopup()},methods:{toLogin:function(){if(!t.getStorageSync("token"))return this.$refs.login.open("/promotionpages/jielong/jielong?jielong_id="+this.jielong_id),!0},getJielongDetail:function(){var t=this;this.$api.sendRequest({url:"/jielong/api/Goods/jielongDetail",data:{jielong_id:this.jielong_id},success:function(i){t.status=i.data.info.status,0==i.code&&i.data&&(t.jielong_info=i.data.info,t.jielong_list=i.data.list,t.timer=i.timestamp,t.jielong_info.start_time>t.timer?t.time=t.$util.countDown(t.jielong_info.start_time-t.timer):t.jielong_info.start_time<t.timer&&t.jielong_info.end_time>t.timer&&(t.time=t.$util.countDown(t.jielong_info.end_time-t.timer)))}})},getJielongBuyPage:function(){var t=this;this.$api.sendRequest({url:"/jielong/api/Goods/jielongBuyPage",data:{jielong_id:this.jielong_id},success:function(i){0==i.code&&i.data&&(t.jielong_buy_page=i.data,t.jielong_buy_page.list.length>0?(t.horseRace=!0,t.running()):t.horseRace=!1)}})},goodsImg:function(t){var i=t.split(",");return i[0]?this.$util.img(i[0],{size:"mid"}):this.$util.getDefaultImage().default_goods_img},getGoodsSkuDetail:function(i){var e=this;return a(n.default.mark((function o(){var s,a;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.getStorageSync("token")){n.next=3;break}return e.$refs.login.open(e.currentRoute),n.abrupt("return");case 3:return n.next=5,e.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",async:!1,data:{sku_id:i}});case 5:s=n.sent,a=s.data,a?(e.goodsSkuDetail=a,0==e.skuId&&(e.skuId=e.goodsSkuDetail.sku_id),e.goodsSkuDetail.unit=e.goodsSkuDetail.unit||"件",e.goodsSkuDetail.show_price=e.goodsSkuDetail.discount_price,e.goodsSkuDetail.sku_spec_format&&(e.goodsSkuDetail.sku_spec_format=JSON.parse(e.goodsSkuDetail.sku_spec_format)),e.goodsSkuDetail.goods_spec_format&&(e.goodsSkuDetail.goods_spec_format=JSON.parse(e.goodsSkuDetail.goods_spec_format))):e.$util.redirectTo("/pages/index/index/index",{},"reLaunch");case 8:case"end":return n.stop()}}),o)})))()},settlement:function(){var i=this,e=[];if(0==this.shoplist.length)return!1;this.shoplist.forEach((function(t){e.push(t.cart_id)})),e=e.toString(),this.$util.redirectTo("/pages/order/payment/payment"),t.setStorage({key:"orderCreateData",data:{cart_ids:e,jielong_id:this.jielong_id},success:function(){i.$util.redirectTo("/pages/order/payment/payment")}})},CartPopup:function(){if(this.toLogin())return this.toLogin(),!1;this.$refs.cartPopup.open(),this.openCartPopup()},openCartPopup:function(){var t=this;this.$api.sendRequest({url:"/jielong/api/cart/goodsLists",data:{jielong_id:this.jielong_id},success:function(i){t.num=0,t.money=0;var e=i.data;e.forEach((function(i){t.num=parseInt(i.num)+t.num,t.money=parseInt(i.price)*parseInt(i.num)+t.money})),t.returnShoping=e}})},closeCartPopup:function(){this.$refs.cartPopup.close()},singleSkuReduce:function(t){var i=this,e=t.sku_id;this.shoplist.forEach((function(t){if(e==t.sku_id&&t.num>1){var n=--t.num;i.edit(t.cart_id,n)}else e==t.sku_id&&1===t.num&&i.delectItem(t.cart_id)})),this.getJielongDetail()},singleSkuPlus:function(i){var e=this;if(!t.getStorageSync("token"))return this.toLogin(),!1;if(0==this.status)return t.showToast({title:"活动未开始",icon:"none"}),!1;var n=i.sku_id,o=!0;0==this.shoplist.length?this.addShop(n):(this.shoplist.forEach((function(t){if(n===t.sku_id){var i=++t.num;e.edit(t.cart_id,i),o=!1}})),o&&this.addShop(n)),this.getJielongDetail()},delect:function(){var i=this;if(!t.getStorageSync("token"))return this.toLogin(),!1;this.$api.sendRequest({url:"/jielong/api/cart/clear",data:{jielong_id:this.jielong_id},success:function(t){i.shopList(),i.openCartPopup(),i.getJielongDetail()}})},codeView:function(i){var e=this;if(!t.getStorageSync("token"))return this.toLogin(),!1;if(0==this.status)return t.showToast({title:"活动未开始",icon:"none"}),!1;this.switchs(i),this.$refs.erWeiPopup.open(),this.zIndex=!1,this.display=!1;0==this.shoplist.length?this.display=!1:this.shoplist.forEach((function(t){i==t.sku_id&&(e.display=!0)}))},close:function(){this.$refs.erWeiPopup.close(),this.zIndex=!0},switchs:function(t){var i=this;this.title="",this.shopList(),this.openCartPopup(),this.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",data:{sku_id:t},success:function(e){i.specifications=e.data,i.specificationsItem=JSON.parse(i.specifications.goods_spec_format),i.specificationsItem.forEach((function(e){e.value.forEach((function(e){e.sku_id==t&&(i.title=i.title+e.spec_value_name+"/")}))})),i.specifications.title=i.title,i.switchImage=i.specifications.sku_image.includes("http")}}),this.display=!1,this.shoplist.forEach((function(e){t==e.sku_id&&(i.display=!0)}))},shopList:function(){var t=this;this.toLogin(),this.$api.sendRequest({url:"/jielong/api/cart/lists",data:{jielong_id:this.jielong_id},success:function(i){t.shoplist=i.data}})},addShop:function(t){var i=this;this.$api.sendRequest({url:"/jielong/api/cart/add",data:{jielong_id:this.jielong_id,num:1,sku_id:t},success:function(t){i.addshop=t.data,i.shopList(),i.openCartPopup(),i.getJielongDetail(),-1!=t.code||i.$util.showToast({title:t.message})}})},edit:function(t,i){var e=this;this.$api.sendRequest({url:"/jielong/api/cart/edit",data:{jielong_id:this.jielong_id,num:i,cart_id:t},success:function(t){e.shopList(),e.openCartPopup(),e.getJielongDetail(),-1!=t.code||e.$util.showToast({title:t.message})}})},delectItem:function(t){var i=this;this.$api.sendRequest({url:"/jielong/api/cart/delete",data:{num:0,cart_id:t},success:function(t){i.shopList(),i.openCartPopup(),i.getJielongDetail()}}),this.display=!1},shoppingCart:function(t){this.display=!0;var i=t.sku_id;this.addShop(i),this.openCartPopup(),this.getJielongDetail()},share:function(){var i=this;if(!t.getStorageSync("token"))return this.toLogin(),!1;this.shareImage="",t.showLoading({title:"加载中"}),this.$refs.share.open();var e=JSON.stringify({jielong_id:this.jielong_id});this.$api.sendRequest({url:"/jielong/api/goods/poster",data:{page:"/promotionpages/jielong/jielong",qrcode_param:e},success:function(e){t.hideLoading(),i.shareImage=e.data.poster_path}})},order:function(){this.$util.redirectTo("/pages/order/list/list")},bottomImage:function(t){return!!t.includes("http")},seeMore:function(){this.seeMores=!this.seeMores,this.seeMores?this.cutting=5:this.cutting=this.jielong_buy_page.count},running:function(){var t=this,i=JSON.parse(JSON.stringify(this.jielong_buy_page.list)),e=1,n=i[0].nickname;n=n.slice(0,1),i[0].content=n+"**",this.lantern=i[0],setInterval((function(){e<i.length?(n=i[e].nickname,n=n.slice(0,1),i[e].content=n+"**",t.lantern=i[e],e++):e=0}),1e4)}}};i.default=l}).call(this,e("543d")["default"])}},[["a018","common/runtime","common/vendor"]]]);