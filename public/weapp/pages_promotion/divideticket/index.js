(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_promotion/divideticket/index"],{"10af":function(i,t,e){"use strict";var n=e("2cea"),o=e.n(n);o.a},"2cea":function(i,t,e){},4030:function(i,t,e){"use strict";(function(i){e("34b0");n(e("66fd"));var t=n(e("9053"));function n(i){return i&&i.__esModule?i:{default:i}}wx.__webpack_require_UNI_MP_PLUGIN__=e,i(t.default)}).call(this,e("543d")["createPage"])},"59be":function(i,t,e){"use strict";(function(i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){e.e("components/uni-popup/uni-popup").then(function(){return resolve(e("92aa"))}.bind(null,e)).catch(e.oe)},o=function(){e.e("components/ns-goods-recommend/ns-goods-recommend").then(function(){return resolve(e("1044"))}.bind(null,e)).catch(e.oe)},u={components:{nsGoodsRecommend:o,uniPopup:n},data:function(){return{guafenInfo:{},groupInfoList:[],goodsRecommend:[],isShow:!1,isNow:!1,seckillH:"",seckillI:"",seckillS:"",seckillInterval:null,poster:"-1",posterMsg:"",posterHeight:0,couponId:"",groupId:"",memberInfo:{},money:"",memberList:[],inviterId:"",inviterInfo:{},is_exit:0,g_member_state:0,start_time_coupon:"",end_time_coupon:"",token:null,memberId:0}},onLoad:function(t){var e=this;if(t.source_member&&i.setStorageSync("source_member",t.source_member),t.scene){var n=decodeURIComponent(t.scene);n=n.split("&"),n.length&&n.forEach((function(t){-1!=t.indexOf("cid")&&(e.couponId=t.split("-")[1]),-1!=t.indexOf("id")&&(e.inviterId=t.split("-")[1]),-1!=t.indexOf("gid")&&(e.groupId=t.split("-")[1]),-1!=t.indexOf("m")&&i.setStorageSync("source_member",t.split("-")[1]),-1!=t.indexOf("is_test")&&i.setStorageSync("is_test",1)}))}else t.cid?(t.cid&&(this.couponId=t.cid),t.id&&(this.inviterId=t.id),t.gid&&(this.groupId=t.gid)):(t.coupon_id&&(this.couponId=t.coupon_id),t.inviter_id&&(this.inviterId=t.inviter_id),t.group_id&&(this.groupId=t.group_id))},filters:{date:function(i){return String(i).slice(0,10)},guolv:function(i){return i=String(i),i.length>=6?i.substr(0,1)+"****"+i.substr(i.split("").length-1,i.split("").length):i},int:function(i){var t=String(i),e=t.split(".");return parseInt(e[1])>0?t:e[0]}},onShow:function(){var t=this;this.getInfo(),this.getMemberInfo(),this.$util.getMemberId().then((function(i){t.memberId=i,t.guafenInfo.coupon_id&&t.setPublicShare()})),i.getStorageSync("token")&&i.getStorageSync("source_member")&&this.$util.onSourceMember(i.getStorageSync("source_member"))},methods:{closeGetItNow:function(){this.$refs.linkSuccessPopup.close()},openSharePopup:function(){this.$refs.sharePopup.open(),this.getGoodsPoster()},closeSharePopup:function(){this.$refs.sharePopup.close()},showPrice:function(i){var t=i.discount_price;return i.member_price&&parseFloat(i.member_price)<parseFloat(t)&&(t=i.member_price),t},openRulePopup:function(){this.$refs.rulePopup.open()},closeRulePopup:function(){this.$refs.rulePopup.close()},toIndex:function(){this.$util.redirectTo("/pages/index/index",{})},toList:function(){var i=this.guafenInfo.goods_ids.split(",").filter((function(i){return i&&i.trim()}));this.$util.redirectTo("/pages/goods/list",{goods_id_arr:i})},toGuaFen:function(){this.$util.redirectTo("/pages_promotion/divideticket/list",{})},toDetail:function(i){this.$util.redirectTo("/pages/goods/detail",{goods_id:i.goods_id})},closeFriend:function(){this.$refs.friendsPopup.close()},friend:function(){this.$refs.friendsPopup.open()},goFriend:function(){this.closeFriend(),this.openSharePopup()},GetItNowPopup:function(){this.$refs.linkSuccessPopup.open()},getInfo:function(){var i=this;this.$api.sendRequest({url:"/divideticket/api/divideticket/info",data:{coupon_id:this.couponId,inviter_id:""==this.inviterId?0:this.inviterId,group_id:""==this.groupId?0:this.groupId},success:function(t){if(t.code>=0){if(i.guafenInfo=t.data,i.groupInfoList=t.data.group_info,i.memberList=t.data.group_info.member_list,i.groupId=t.data.group_info.group_id,i.guafenInfo.inviter_info&&(i.inviterInfo=t.data.inviter_info),i.memberList&&i.memberList.forEach((function(t){i.guafenInfo.member_id==t.member_id&&(i.money=t.money,i.start_time_coupon=t.coupon_start_time,i.end_time_coupon=t.coupon_end_time)})),""!=t.data.group_info){var e=Date.parse(new Date)/1e3,n=i.$util.countDown(i.groupInfoList.end_time-e);if(i.seckillH=n.h,i.seckillI=n.i,i.seckillS=n.s,t.data.member_id!=t.data.group_info.header_id){var o=0;t.data.group_info.member_list.some((function(i){i.member_id==t.data.member_id&&(o+=1)})),1==t.data.group_info.status&&0==o?i.g_member_state=1:0==o&&(o+=1,i.$refs.linkPopup.open())}}i.setPublicShare()}}})},join:function(){var t=this;i.getStorageSync("token")?this.$api.sendRequest({url:"/divideticket/api/divideticket/divideticket",data:{group_id:this.groupId},success:function(i){i.code>=0?(t.$util.showToast({title:"加入成功"}),t.closeLinkPopup(),t.getInfo(),t.groupInfoList.num-t.groupInfoList.member_list.length>1&&t.friend(),t.groupInfoList.num-t.groupInfoList.member_list.length<=1&&t.GetItNowPopup()):(t.$util.showToast({title:i.message}),t.closeLinkPopup())}}):setTimeout((function(){t.$refs.login.open("/pages_tool/hongbao/index?coupon_id="+t.couponId+"&group_id="+t.groupId)}))},getLaunch:function(){var t=this;i.getStorageSync("token")?this.$api.sendRequest({url:"/divideticket/api/divideticket/launch",data:{coupon_id:this.couponId},success:function(i){i.code>=0?(t.groupId=i.data,t.isShow,t.getInfo()):t.$util.showToast({title:"优惠券已被瓜分完，下次再来吧"}),t.$forceUpdate()}}):setTimeout((function(){t.$refs.login.open("/pages_promotion/divideticket/index?coupon_id="+t.couponId+"&group_id="+t.groupId)}))},openPosterPopup:function(){this.$util.redirectTo("/pages_promotion/divideticket/poster",{coupon_id:this.couponId,group_id:this.groupId,inviter_id:this.guafenInfo.member_id})},getGoodsPoster:function(){var i=this;this.$api.sendRequest({url:"/divideticket/api/divideticket/poster",data:{coupon_id:this.couponId,group_id:""==this.groupId?0:this.groupId},success:function(t){0==t.code?i.poster=t.data.path+"?time="+(new Date).getTime():i.posterMsg=t.message}})},closePosterPopup:function(){this.$refs.posterPopup.close()},closeLinkPopup:function(){this.$refs.linkPopup.close()},copyUrl:function(){var i=this,t=this.$config.h5Domain+"/pages_promotion/divideticket/index";this.couponId&&(t+="?coupon_id="+this.couponId+"&group_id="+this.groupInfoList.group_id+"&inviter_id="+this.guafenInfo.member_id),this.$util.copy(t,(function(){i.closeSharePopup()}))},imageError:function(i){this.list[i].goods_image=this.$util.getDefaultImage().goods,this.$forceUpdate()},headerimageError:function(i){this.list[i].headimg=this.$util.getDefaultImage().head,this.$forceUpdate()},onPageHide:function(){clearInterval(this.seckillInterval)},getMemberInfo:function(){var i=this;this.$api.sendRequest({url:"/api/member/info",success:function(t){0==t.code&&(i.memberInfo=t.data),i.$refs.loadingCover&&i.$refs.loadingCover.hide()},fail:function(t){i.$refs.loadingCover&&i.$refs.loadingCover.hide()}})},setPublicShare:function(){var i=this.$config.h5Domain+"/pages_promotion/divideticket/index?cid="+this.guafenInfo.coupon_id+"&gid="+this.groupInfoList.group_id+"&id="+this.guafenInfo.member_id;this.memberId&&(i+="&source_member="+this.memberId),this.$util.setPublicShare({title:"邀请好友瓜分优惠券，一起享优惠",desc:"仅差一人即可瓜分"+this.guafenInfo.money+"元优惠券",link:i,imgUrl:this.$store.state.site_info.logo_square})}},onShareAppMessage:function(i){var t="/pages_promotion/divideticket/index?cid="+this.guafenInfo.coupon_id+"&gid="+this.groupInfoList.group_id+"&id="+this.guafenInfo.member_id;return this.memberId&&(t+="&source_member="+this.memberId),{title:"仅差一人即可瓜分"+this.guafenInfo.money+"元优惠券",path:t,imageUrl:"",success:function(i){},fail:function(i){}}},onShareTimeline:function(){var i="仅差一人即可瓜分"+this.guafenInfo.money+"元优惠券",t=t="?cid="+this.guafenInfo.coupon_id+"&gid="+this.groupInfoList.group_id+"&id="+this.guafenInfo.member_id;return this.memberId&&(t+="&source_member="+this.memberId),{title:i,query:t,imageUrl:""}}};t.default=u}).call(this,e("543d")["default"])},"7cbb":function(i,t,e){"use strict";e.r(t);var n=e("59be"),o=e.n(n);for(var u in n)"default"!==u&&function(i){e.d(t,i,(function(){return n[i]}))}(u);t["default"]=o.a},"82cb":function(i,t,e){"use strict";var n=e("8617"),o=e.n(n);o.a},8617:function(i,t,e){},9053:function(i,t,e){"use strict";e.r(t);var n=e("dbf6"),o=e("7cbb");for(var u in o)"default"!==u&&function(i){e.d(t,i,(function(){return o[i]}))}(u);e("b5a7"),e("10af"),e("82cb");var s,r=e("f0c5"),a=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"4be48bc6",null,!1,n["a"],s);t["default"]=a.exports},b5a7:function(i,t,e){"use strict";var n=e("e5db"),o=e.n(n);o.a},dbf6:function(i,t,e){"use strict";e.d(t,"b",(function(){return o})),e.d(t,"c",(function(){return u})),e.d(t,"a",(function(){return n}));var n={uniCountDown:function(){return e.e("components/uni-count-down/uni-count-down").then(e.bind(null,"1339"))},uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"92aa"))},nsLogin:function(){return e.e("components/ns-login/ns-login").then(e.bind(null,"2893"))},loadingCover:function(){return e.e("components/loading-cover/loading-cover").then(e.bind(null,"790a"))}},o=function(){var i=this,t=i.$createElement,e=(i._self._c,2!=i.groupInfoList.status?i.$util.img("public/uniapp/divideticket/guafen_bg.png"):null),n=2!=i.groupInfoList.status?i.$util.img("public/uniapp/hongbao/index.png"):null,o=2!=i.groupInfoList.status&&""==i.groupInfoList&&1==i.guafenInfo.status?i.$util.img("public/uniapp/divideticket/guafen_success_bg.png"):null,u=2!=i.groupInfoList.status&&(""!=i.groupInfoList&&1==i.guafenInfo.status&&0==i.groupInfoList.status||2==i.groupInfoList.status)?i.$util.img("public/uniapp/divideticket/guafen_success_bg.png"):null,s=2!=i.groupInfoList.status&&(""!=i.groupInfoList&&1==i.guafenInfo.status&&0==i.groupInfoList.status||2==i.groupInfoList.status)&&i.groupInfoList.member_list.length>0?i.__map(i.groupInfoList.member_list,(function(t,e){var n=i.__get_orig(t),o=""!=t.headimg?i.$util.img(t.headimg):null,u=""==t.headimg?i.$util.img("public/uniapp/default_img/head.png"):null;return{$orig:n,g4:o,g5:u}})):null,r=2!=i.groupInfoList.status&&(""!=i.groupInfoList&&1==i.guafenInfo.status&&0==i.groupInfoList.status||2==i.groupInfoList.status)?i.$util.img("public/uniapp/divideticket/bg_left.png"):null,a=2!=i.groupInfoList.status&&(""!=i.groupInfoList&&1==i.guafenInfo.status&&0==i.groupInfoList.status||2==i.groupInfoList.status)?i.$util.img("public/uniapp/divideticket/bg_right.png"):null,p=2!=i.groupInfoList.status&&""!=i.groupInfoList&&1==i.groupInfoList.status&&0==i.g_member_state?i.$util.img("public/uniapp/divideticket/guafen_success_bg.png"):null,g=2!=i.groupInfoList.status&&""!=i.groupInfoList&&1==i.groupInfoList.status&&0==i.g_member_state&&i.groupInfoList.member_list.length>0?i.__map(i.groupInfoList.member_list,(function(t,e){var n=i.__get_orig(t),o=""!=t.headimg?i.$util.img(t.headimg):null,u=""==t.headimg?i.$util.img("public/uniapp/default_img/head.png"):null;return{$orig:n,g9:o,g10:u}})):null,f=2!=i.groupInfoList.status&&""!=i.groupInfoList&&1==i.groupInfoList.status&&0==i.g_member_state&&1==i.guafenInfo.is_limit?i._f("int")(i.guafenInfo.at_least):null,d=2!=i.groupInfoList.status&&""!=i.groupInfoList&&1==i.groupInfoList.status&&0==i.g_member_state?i._f("date")(i.$util.timeStampTurnTime(i.start_time_coupon)):null,c=2!=i.groupInfoList.status&&""!=i.groupInfoList&&1==i.groupInfoList.status&&0==i.g_member_state?i._f("date")(i.$util.timeStampTurnTime(i.end_time_coupon)):null,l=2!=i.groupInfoList.status&&(1!=i.groupInfoList.status&&-1==i.guafenInfo.status||1!=i.groupInfoList.status&&2==i.guafenInfo.status)?i.$util.img("public/uniapp/divideticket/guafen_success_bg.png"):null,m=2!=i.groupInfoList.status&&1==i.guafenInfo.status&&1==i.g_member_state?i.$util.img("public/uniapp/divideticket/guafen_success_bg.png"):null,_=2==i.groupInfoList.status?i.$util.img("public/uniapp/order/status-wrap-bg.png"):null,I=2==i.groupInfoList.status&&i.groupInfoList.member_list.length>0?i.__map(i.groupInfoList.member_list,(function(t,e){var n=i.__get_orig(t),o=""!=t.headimg?i.$util.img(t.headimg):null,u=""==t.headimg?i.$util.img("public/uniapp/default_img/head.png"):null;return{$orig:n,g14:o,g15:u}})):null,h=2==i.groupInfoList.status?i.$util.timeStampTurnTime(i.guafenInfo.start_time):null,b=2==i.groupInfoList.status?i.$util.timeStampTurnTime(i.guafenInfo.end_time):null,v=2==i.groupInfoList.status?i.$util.timeStampTurnTime(i.groupInfoList.start_time):null,$=i.$util.img("public/uniapp/divideticket/explain.png"),L=i.$util.timeStampTurnTime(i.guafenInfo.start_time),k=i.$util.timeStampTurnTime(i.guafenInfo.end_time),S="-1"!=i.poster?i.$util.img(i.poster):null,P=i.inviterInfo?i.$util.img("public/uniapp/divideticket/guafen_popup.png"):null,T=i.inviterInfo?i.$util.img(i.inviterInfo.headimg?i.$util.img(i.inviterInfo.headimg):i.$util.getDefaultImage().head):null,w=i.inviterInfo?i._f("guolv")(i.inviterInfo.nickname):null,y=i.inviterInfo?i.$util.img("public/uniapp/hongbao/close.png"):null,x=i.inviterInfo?null:i.$util.img("public/uniapp/divideticket/guafen_popup.png"),D=i.inviterInfo?null:i.$util.img(i.groupInfoList.header_headimg?i.$util.img(i.groupInfoList.header_headimg):i.$util.getDefaultImage().head),M=i.inviterInfo?null:i._f("guolv")(i.groupInfoList.header_nickname),R=i.inviterInfo?null:i.$util.img("public/uniapp/hongbao/close.png"),U=i.$util.img("public/uniapp/divideticket/guafen_success.png"),q=i._f("int")(i.guafenInfo.money),G=i.$util.img("public/uniapp/divideticket/guafen_popup.png"),O=i._f("guolv")(i.groupInfoList.header_nickname),C=i._f("int")(i.guafenInfo.money),F=i.$util.img("public/uniapp/hongbao/close.png");i._isMounted||(i.e0=function(t){i.inviterInfo.headimg=i.$util.getDefaultImage().head},i.e1=function(t){i.groupInfoList.header_headimg=i.$util.getDefaultImage().head}),i.$mp.data=Object.assign({},{$root:{g0:e,g1:n,g2:o,g3:u,l0:s,g6:r,g7:a,g8:p,l1:g,f0:f,f1:d,f2:c,g11:l,g12:m,g13:_,l2:I,g16:h,g17:b,g18:v,g19:$,g20:L,g21:k,g22:S,g23:P,g24:T,f3:w,g25:y,g26:x,g27:D,f4:M,g28:R,g29:U,f5:q,g30:G,f6:O,f7:C,g31:F}})},u=[]},e5db:function(i,t,e){}},[["4030","common/runtime","common/vendor"]]]);