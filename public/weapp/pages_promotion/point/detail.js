(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_promotion/point/detail"],{"0ac6":function(n,t,o){"use strict";var i=o("44a5"),e=o.n(i);e.a},"0db2":function(n,t,o){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(o("ce70")),e=a(o("f385"));function a(n){return n&&n.__esModule?n:{default:n}}var u=function(){o.e("components/uni-popup/uni-popup").then(function(){return resolve(o("92aa"))}.bind(null,o)).catch(o.oe)},r=function(){o.e("components/uni-number-box/uni-number-box").then(function(){return resolve(o("092d"))}.bind(null,o)).catch(o.oe)},p=function(){Promise.all([o.e("common/vendor"),o.e("components/ns-goods-sku/ns-goods-sku")]).then(function(){return resolve(o("ac46"))}.bind(null,o)).catch(o.oe)},s=function(){o.e("components/toTop/toTop").then(function(){return resolve(o("1aeb"))}.bind(null,o)).catch(o.oe)},f={components:{uniPopup:u,uniNumberBox:r,nsGoodsSku:p,toTop:s},data:function(){return{id:0,pointInfo:{image:"",pointCoupon:0},isIphoneX:!1,isLogin:!1,memberPoint:0,isCommunity:!1,memberId:0,shareImg:""}},mixins:[e.default],onLoad:function(t){var o=this;if(t.source_member&&n.setStorageSync("source_member",t.source_member),t.scene){var i=decodeURIComponent(t.scene);i=i.split("&"),i.length&&i.forEach((function(t){-1!=t.indexOf("sku_id")&&(o.skuId=t.split("-")[1]),-1!=t.indexOf("m")&&n.setStorageSync("source_member",t.split("-")[1]),-1!=t.indexOf("is_test")&&n.setStorageSync("is_test",1)}))}this.isIphoneX=this.$util.uniappIsIPhoneX(),t.id?(this.id=t.id,this.getPointInfo()):this.$util.redirectTo("/pages_promotion/point/list",{},"redirectTo")},onShow:function(){n.getStorageSync("token")&&n.getStorageSync("source_member")&&this.$util.onSourceMember(n.getStorageSync("source_member"))},onShareAppMessage:function(n){var t="",o="";switch(this.pointInfo.type){case 1:t=this.pointInfo.sku_name,o=this.pointInfo.sku_image;break;case 2:case 3:t=this.pointInfo.name,o=this.pointInfo.image;break}t="仅需"+this.pointInfo.point+"积分即可兑换"+t,o=this.$util.img(o);var i=this.$util.getCurrentShareRoute(this.memberId),e=i.path;return{title:t,path:e,imageUrl:o,success:function(n){},fail:function(n){}}},onShareTimeline:function(){var n="",t="";switch(this.pointInfo.type){case 1:n=this.pointInfo.sku_name,t=this.pointInfo.sku_image;break;case 2:case 3:n=this.pointInfo.name,t=this.pointInfo.image;break}n="仅需"+this.pointInfo.point+"积分即可兑换"+n,t=this.$util.img(t);var o=this.$util.getCurrentShareRoute(this.memberId),i=o.query;return{title:n,query:i,imageUrl:t}},computed:{storeToken:function(){return this.$store.state.token},enough:function(){return parseInt(this.pointInfo.point)>parseInt(this.memberPoint)}},watch:{storeToken:function(n,t){n&&(this.isLogin=!0,this.getPointInfo())}},methods:{getAccountInfo:function(t,o){var i=this;n.getStorageSync("token")?this.$api.sendRequest({url:"/api/memberaccount/info",data:{account_type:"point"},success:function(n){if(0==n.code&&n.data){i.isLogin=!0,i.memberPoint=n.data.point;var e=Math.floor(parseInt(n.data.point)/o);i.Max=t>=e?e:t}else i.$util.showToast({title:n.message});i.$refs.loadingCover&&i.$refs.loadingCover.hide()}}):(this.isLogin=!1,this.$refs.loadingCover&&this.$refs.loadingCover.hide())},getPointInfo:function(){var n=this;this.$api.sendRequest({url:"/pointexchange/api/goods/detail",data:{id:this.id},success:function(t){if(t.code>=0&&0!==t.data.length){n.pointInfo=t.data,n.pointInfo.image?n.shareImg=n.$util.img(n.pointInfo.image):n.shareImg=n.$util.img("public/uniapp/blindbox/default.png"),n.$langConfig.title(n.pointInfo.name);var o=2==n.pointInfo.type?n.pointInfo.count:n.pointInfo.stock;if(2==n.pointInfo.type&&-1==n.pointInfo.stock&&(n.pointInfo.pointCoupon=1),1==n.pointInfo.type){if(n.pointInfo.image=n.pointInfo["sku_image"],n.pointInfo.sku_spec_format&&(n.pointInfo.sku_spec_format=JSON.parse(n.pointInfo.sku_spec_format)),n.pointInfo.goods_attr_format){var e=JSON.parse(n.pointInfo.goods_attr_format);n.pointInfo.goods_attr_format=n.$util.unique(e,"attr_id");for(var a=0;a<n.pointInfo.goods_attr_format.length;a++)for(var u=0;u<e.length;u++)n.pointInfo.goods_attr_format[a].attr_id==e[u].attr_id&&n.pointInfo.goods_attr_format[a].attr_value_id!=e[u].attr_value_id&&(n.pointInfo.goods_attr_format[a].attr_value_name+="、"+e[u].attr_value_name)}n.pointInfo.goods_spec_format&&(n.pointInfo.goods_spec_format=JSON.parse(n.pointInfo.goods_spec_format))}n.pointInfo.unit=n.pointInfo.unit||"件",n.pointInfo.content&&(n.pointInfo.content=(0,i.default)(n.pointInfo.content)),n.getAccountInfo(o,n.pointInfo.point)}else n.$util.showToast({title:t.message}),setTimeout((function(){n.$util.redirectTo("/pages_promotion/point/list",{},"redirectTo")}),1e3)}})},exchange:function(){n.getStorageSync("token")?this.$refs.goodsSku.show("point"):this.$refs.login.open("/pages_promotion/point/detail?id="+this.id)},refreshGoodsSkuDetail:function(n){Object.assign(this.pointInfo,n),this.pointInfo.unit=this.pointInfo.unit||"件"},openMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.open()},closeMerchantsServicePopup:function(){this.$refs.merchantsServicePopup.close()},openAttributePopup:function(){this.$refs.attributePopup.open()},closeAttributePopup:function(){this.$refs.attributePopup.close()},imageError:function(){this.pointInfo.image=this.$util.getDefaultImage().goods,this.$forceUpdate()},onCommunity:function(){this.isCommunity=!0},onCloseCommunity:function(){this.isCommunity=!1}}};t.default=f}).call(this,o("543d")["default"])},"2f3f":function(n,t,o){"use strict";(function(n){o("34b0");i(o("66fd"));var t=i(o("e8ed"));function i(n){return n&&n.__esModule?n:{default:n}}wx.__webpack_require_UNI_MP_PLUGIN__=o,n(t.default)}).call(this,o("543d")["createPage"])},"44a5":function(n,t,o){},6444:function(n,t,o){"use strict";o.r(t);var i=o("0db2"),e=o.n(i);for(var a in i)"default"!==a&&function(n){o.d(t,n,(function(){return i[n]}))}(a);t["default"]=e.a},e037:function(n,t,o){},e3cf:function(n,t,o){"use strict";o.d(t,"b",(function(){return e})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return i}));var i={uniPopup:function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"92aa"))},nsGoodsSku:function(){return Promise.all([o.e("common/vendor"),o.e("components/ns-goods-sku/ns-goods-sku")]).then(o.bind(null,"ac46"))},loadingCover:function(){return o.e("components/loading-cover/loading-cover").then(o.bind(null,"790a"))},nsLogin:function(){return o.e("components/ns-login/ns-login").then(o.bind(null,"2893"))}},e=function(){var n=this,t=n.$createElement,o=(n._self._c,2==n.pointInfo.type&&n.pointInfo.image?n.$util.img(n.pointInfo.image):null),i=2!=n.pointInfo.type||n.pointInfo.image?null:n.$util.img("public/uniapp/point/coupon.png"),e=2==n.pointInfo.type?n.$util.img("public/uniapp/point/coupon.png"):null,a=2!=n.pointInfo.type&&3==n.pointInfo.type&&n.pointInfo.image?n.$util.img(n.pointInfo.image):null,u=2==n.pointInfo.type||3!=n.pointInfo.type||n.pointInfo.image?null:n.$util.img("public/uniapp/point/hongbao.png"),r=2!=n.pointInfo.type&&3==n.pointInfo.type?n.$util.img("public/uniapp/point/hongbao.png"):null,p=2!=n.pointInfo.type&&3!=n.pointInfo.type?n.$util.img(n.pointInfo.image):null,s="0.00"!=n.pointInfo.exchange_price&&n.pointInfo.pay_type>0?n.$lang("common.currencySymbol"):null,f=n.pointInfo.price?n.$lang("common.currencySymbol"):null,c=n.pointInfo.coupon_type&&1!=n.pointInfo.validity_type?n.$util.timeStampTurnTime(n.pointInfo.end_time):null,l=n.pointInfo.qr_data&&1==n.pointInfo.qr_data.qr_state?n.$util.img("public/uniapp/goods/detail_erweiImage.png"):null,m=n.pointInfo.qr_data&&n.pointInfo.qr_data.qr_img&&""!=n.pointInfo.qr_data.qr_img&&1==n.pointInfo.qr_data.qr_state?n.$util.img(n.pointInfo.qr_data.qr_img):null,g=n.pointInfo.qr_data&&n.pointInfo.qr_data.qr_img&&(""==n.pointInfo.qr_data.qr_img||1!=n.pointInfo.qr_data.qr_state)?n.$util.img("public/uniapp/goods/detail_erweiImage.png"):null;n.$mp.data=Object.assign({},{$root:{g0:o,g1:i,g2:e,g3:a,g4:u,g5:r,g6:p,m0:s,m1:f,g7:c,g8:l,g9:m,g10:g}})},a=[]},e8ed:function(n,t,o){"use strict";o.r(t);var i=o("e3cf"),e=o("6444");for(var a in e)"default"!==a&&function(n){o.d(t,n,(function(){return e[n]}))}(a);o("f31b"),o("0ac6");var u,r=o("f0c5"),p=Object(r["a"])(e["default"],i["b"],i["c"],!1,null,"bf29404a",null,!1,i["a"],u);t["default"]=p.exports},f31b:function(n,t,o){"use strict";var i=o("e037"),e=o.n(i);e.a}},[["2f3f","common/runtime","common/vendor"]]]);