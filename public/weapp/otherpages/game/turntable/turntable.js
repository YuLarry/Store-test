(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/game/turntable/turntable"],{"00d0":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("ccd8"));function o(t){return t&&t.__esModule?t:{default:t}}var r=function(){n.e("components/uni-popup/uni-popup").then(function(){return resolve(n("1fce"))}.bind(null,n)).catch(n.oe)},u=function(){Promise.all([n.e("common/vendor"),n.e("components/l-time/l-time")]).then(function(){return resolve(n("1bf5"))}.bind(null,n)).catch(n.oe)},a={components:{uniPopup:r,LTime:u},data:function(){return{token:null,isClick:!1,currentIndex:-1,maxRing:6,currentRing:1,speed:300,timer:null,id:0,gameInfo:{award:[{award_img:"",award_name:""}],surplus_num:""},award:[],resultIndex:0,result:{is_winning:1},point:0,animate:!1,scrollTimer:null}},onLoad:function(t){t.id&&(this.id=t.id),this.getGameInfo()},onShow:function(){var e=this;if(!this.addonIsExit.turntable)return this.$util.showToast({title:"商家未开启幸运抽奖",mask:!0,duration:2e3}),void setTimeout((function(){e.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),2e3);this.$langConfig.refresh(),t.getStorageSync("token")&&(this.getMemberPointInfo(),this.token=t.getStorageSync("token"))},mixins:[i.default],computed:{storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(e,n){e&&(this.token=t.getStorageSync("token"),this.getMemberPointInfo(),this.getGameInfo())}},methods:{getMemberPointInfo:function(){var t=this;this.$api.sendRequest({url:"/api/memberaccount/info",data:{account_type:"point"},success:function(e){e.data&&(t.point=parseInt(e.data.point))}})},lottery:function(){var e=this;t.getStorageSync("token")?1==this.gameInfo.status&&(this.gameInfo.surplus_num<=0?this.$util.showToast({title:"您的抽奖次数已用完"}):this.gameInfo.points>0&&this.point<this.gameInfo.points?this.$util.showToast({title:"积分不足"}):this.isClick||(this.isClick=!0,this.currentIndex=0,this.currentRing=1,this.speed=300,this.timer=setInterval(this.startRoll,this.speed),this.$api.sendRequest({url:"/turntable/api/turntable/lottery",data:{id:this.id},success:function(t){t.code>=0?(e.result=t.data,t.data.is_winning?e.resultIndex=e.$util.inArray(t.data.award_id,e.award):e.resultIndex=e.$util.inArray(-1,e.award),e.point-=e.gameInfo.points,e.gameInfo.surplus_num-=1):e.$util.showToast({title:t.message})},fail:function(t){e.resultIndex=e.$util.inArray(-1,e.award)}}))):this.$refs.login.open("/otherpages/game/turntable/turntable?id="+this.id)},getGameInfo:function(){var t=this;this.$api.sendRequest({url:"/turntable/api/turntable/info",data:{id:this.id},success:function(e){e.code>=0&&e.data?(t.gameInfo=e.data,e.data.award.forEach((function(e){t.award.push(e.award_id)})),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length>6&&(t.scrollTimer=setInterval(t.scrollRecord,2e3))):(t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1500))},fail:function(e){t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1500)}})},startRoll:function(){if(this.speed>50&&(this.speed-=50),this.currentRing>=this.maxRing-1&&this.speed<700&&(this.speed+=100),this.currentRing==this.maxRing&&this.currentIndex==this.resultIndex)return clearInterval(this.timer),void this.showResult();7==this.currentIndex?(this.currentRing+=1,this.currentIndex=0):this.currentIndex+=1,clearInterval(this.timer),this.timer=setTimeout(this.startRoll,this.speed)},showResult:function(){this.$refs.resultPopup.open()},closePopup:function(){this.isClick=!1,this.currentIndex=-1,this.$refs.resultPopup.close()},openRulePopup:function(){this.$refs.rulePopup.open()},closeRulePopup:function(){this.$refs.rulePopup.close()},scrollRecord:function(){var t=this;this.animate=!0,setTimeout((function(){t.gameInfo.draw_record.push(t.gameInfo.draw_record[0]),t.gameInfo.draw_record.shift(),t.animate=!1}),1e3)}},filters:{cover:function(t){return"string"==typeof t&&t.length>0?t.substr(0,1)+"******"+t.substr(-1):""}},onHide:function(){clearInterval(this.scrollTimer)}};e.default=a}).call(this,n("543d")["default"])},"5bc1":function(t,e,n){"use strict";var i=n("a9d0"),o=n.n(i);o.a},6608:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}));var i={lTime:function(){return Promise.all([n.e("common/vendor"),n.e("components/l-time/l-time")]).then(n.bind(null,"1bf5"))},uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"1fce"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"30be"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"2e9e"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.$util.img("upload/uniapp/game/turntable_head.png")),i=t.$util.img("/upload/uniapp/game/turntable_bg.png"),o=t.__map(t.gameInfo.award,(function(e,n){var i=t.__get_orig(e),o=t.$util.img(e.award_img);return{$orig:i,g2:o}})),r=t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length?t.__map(t.gameInfo.draw_record,(function(e,n){var i=t.__get_orig(e),o=t._f("cover")(e.member_nick_name);return{$orig:i,f0:o}})):null,u=t.result.is_winning?t.$util.img(t.gameInfo.award[t.resultIndex].award_img):null,a=t.result.is_winning?t.$util.img("upload/uniapp/game/result_yes.png"):null,s=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_look.png"),l=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_no.png"),c=t.$util.img("upload/uniapp/game/rule_head.png"),d=t.$util.timeStampTurnTime(t.gameInfo.start_time),f=t.$util.timeStampTurnTime(t.gameInfo.end_time);t._isMounted||(t.e0=function(e){return t.$util.redirectTo("/otherpages/game/record/record",{id:t.id})}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:i,l0:o,l1:r,g3:u,g4:a,g5:s,g6:l,g7:c,g8:d,g9:f}})},r=[]},"68e2":function(t,e,n){},"6d44":function(t,e,n){"use strict";n.r(e);var i=n("6608"),o=n("d977");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("5bc1"),n("f53e");var u,a=n("f0c5"),s=Object(a["a"])(o["default"],i["b"],i["c"],!1,null,"787333a2",null,!1,i["a"],u);e["default"]=s.exports},a9d0:function(t,e,n){},d493:function(t,e,n){"use strict";(function(t){n("5558");i(n("66fd"));var e=i(n("6d44"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d977:function(t,e,n){"use strict";n.r(e);var i=n("00d0"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},f53e:function(t,e,n){"use strict";var i=n("68e2"),o=n.n(i);o.a}},[["d493","common/runtime","common/vendor"]]]);