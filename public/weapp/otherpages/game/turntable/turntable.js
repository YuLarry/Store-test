(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/game/turntable/turntable"],{"00d0":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){Promise.all([e.e("common/vendor"),e.e("components/ns-show-toast/ns-show-toast")]).then(function(){return resolve(e("691c"))}.bind(null,e)).catch(e.oe)},o=function(){e.e("components/uni-popup/uni-popup").then(function(){return resolve(e("1fce"))}.bind(null,e)).catch(e.oe)},r=function(){Promise.all([e.e("common/vendor"),e.e("components/l-time/l-time")]).then(function(){return resolve(e("1bf5"))}.bind(null,e)).catch(e.oe)},s={components:{nsShowToast:i,uniPopup:o,LTime:r},data:function(){return{token:null,isClick:!1,currentIndex:-1,maxRing:6,currentRing:1,speed:300,timer:null,id:0,gameInfo:{award:[{award_img:"",award_name:""}],surplus_num:""},award:[],resultIndex:0,result:{is_winning:1},point:0,animate:!1,scrollTimer:null}},onLoad:function(t){t.id&&(this.id=t.id),this.getGameInfo()},onShow:function(){this.$langConfig.refresh(),t.getStorageSync("token")&&(this.getMemberPointInfo(),this.token=t.getStorageSync("token"))},computed:{storeToken:function(){return this.$store.state.token}},watch:{storeToken:function(n,e){n&&(this.token=t.getStorageSync("token"),this.getMemberPointInfo(),this.getGameInfo())}},methods:{getMemberPointInfo:function(){var t=this;this.$api.sendRequest({url:"/api/memberaccount/info",data:{account_type:"point"},success:function(n){n.data&&(t.point=parseInt(n.data.point))}})},lottery:function(){var n=this;t.getStorageSync("token")?1==this.gameInfo.status&&(this.gameInfo.surplus_num<=0?this.$util.showToast({title:"您的抽奖次数已用完"}):this.gameInfo.points>0&&this.point<this.gameInfo.points?this.$util.showToast({title:"积分不足"}):this.isClick||(this.isClick=!0,this.currentIndex=0,this.currentRing=1,this.speed=300,this.timer=setInterval(this.startRoll,this.speed),this.$api.sendRequest({url:"/turntable/api/turntable/lottery",data:{id:this.id},success:function(t){t.code>=0?(n.result=t.data,t.data.is_winning?n.resultIndex=n.$util.inArray(t.data.award_id,n.award):n.resultIndex=n.$util.inArray(-1,n.award),n.point-=n.gameInfo.points,n.gameInfo.surplus_num-=1):n.$util.showToast({title:t.message})},fail:function(t){n.resultIndex=n.$util.inArray(-1,n.award)}}))):this.$refs.login.open("/otherpages/game/turntable/turntable?id="+this.id)},getGameInfo:function(){var t=this;this.$api.sendRequest({url:"/turntable/api/turntable/info",data:{id:this.id},success:function(n){n.code>=0&&n.data?(t.gameInfo=n.data,n.data.award.forEach((function(n){t.award.push(n.award_id)})),t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length>6&&(t.scrollTimer=setInterval(t.scrollRecord,2e3))):(t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1500))},fail:function(n){t.$util.showToast({title:"未获取到活动信息！"}),setTimeout((function(){t.$util.redirectTo("/pages/index/index/index",{},"reLaunch")}),1500)}})},startRoll:function(){if(this.speed>50&&(this.speed-=50),this.currentRing>=this.maxRing-1&&this.speed<700&&(this.speed+=100),this.currentRing==this.maxRing&&this.currentIndex==this.resultIndex)return clearInterval(this.timer),void this.showResult();7==this.currentIndex?(this.currentRing+=1,this.currentIndex=0):this.currentIndex+=1,clearInterval(this.timer),this.timer=setTimeout(this.startRoll,this.speed)},showResult:function(){this.$refs.resultPopup.open()},closePopup:function(){this.isClick=!1,this.currentIndex=-1,this.$refs.resultPopup.close()},openRulePopup:function(){this.$refs.rulePopup.open()},closeRulePopup:function(){this.$refs.rulePopup.close()},scrollRecord:function(){var t=this;this.animate=!0,setTimeout((function(){t.gameInfo.draw_record.push(t.gameInfo.draw_record[0]),t.gameInfo.draw_record.shift(),t.animate=!1}),1e3)}},filters:{cover:function(t){return"string"==typeof t&&t.length>0?t.substr(0,1)+"******"+t.substr(-1):""}},onHide:function(){clearInterval(this.scrollTimer)}};n.default=s}).call(this,e("543d")["default"])},"2bd2":function(t,n,e){},"4dd4":function(t,n,e){"use strict";var i=e("2bd2"),o=e.n(i);o.a},"5bc1":function(t,n,e){"use strict";var i=e("a9d0"),o=e.n(i);o.a},"6d44":function(t,n,e){"use strict";e.r(n);var i=e("873b"),o=e("d977");for(var r in o)"default"!==r&&function(t){e.d(n,t,(function(){return o[t]}))}(r);e("5bc1"),e("4dd4");var s,u=e("f0c5"),a=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,"56b0318d",null,!1,i["a"],s);n["default"]=a.exports},"873b":function(t,n,e){"use strict";e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return r})),e.d(n,"a",(function(){return i}));var i={lTime:function(){return Promise.all([e.e("common/vendor"),e.e("components/l-time/l-time")]).then(e.bind(null,"1bf5"))},uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,"1fce"))},nsShowToast:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-show-toast/ns-show-toast")]).then(e.bind(null,"691c"))},loadingCover:function(){return e.e("components/loading-cover/loading-cover").then(e.bind(null,"30be"))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,"2e9e"))}},o=function(){var t=this,n=t.$createElement,e=(t._self._c,t.$util.img("upload/uniapp/game/turntable_head.png")),i=t.__map(t.gameInfo.award,(function(n,e){var i=t.__get_orig(n),o=t.$util.img(n.award_img);return{$orig:i,g1:o}})),o=t.gameInfo.is_show_winner&&t.gameInfo.draw_record.length?t.__map(t.gameInfo.draw_record,(function(n,e){var i=t.__get_orig(n),o=t._f("cover")(n.member_nick_name);return{$orig:i,f0:o}})):null,r=t.result.is_winning?t.$util.img(t.gameInfo.award[t.resultIndex].award_img):null,s=t.result.is_winning?t.$util.img("upload/uniapp/game/result_yes.png"):null,u=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_look.png"),a=t.result.is_winning?null:t.$util.img("upload/uniapp/game/result_no.png"),l=t.$util.img("upload/uniapp/game/rule_head.png"),c=t.$util.timeStampTurnTime(t.gameInfo.start_time),d=t.$util.timeStampTurnTime(t.gameInfo.end_time);t._isMounted||(t.e0=function(n){return t.$util.redirectTo("/otherpages/game/record/record",{id:t.id})}),t.$mp.data=Object.assign({},{$root:{g0:e,l0:i,l1:o,g2:r,g3:s,g4:u,g5:a,g6:l,g7:c,g8:d}})},r=[]},a9d0:function(t,n,e){},d493:function(t,n,e){"use strict";(function(t){e("5558");i(e("66fd"));var n=i(e("6d44"));function i(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},d977:function(t,n,e){"use strict";e.r(n);var i=e("00d0"),o=e.n(i);for(var r in i)"default"!==r&&function(t){e.d(n,t,(function(){return i[t]}))}(r);n["default"]=o.a}},[["d493","common/runtime","common/vendor"]]]);