(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/goods/coupon/coupon"],{"0927":function(t,e,n){"use strict";var o=n("4646"),i=n.n(o);i.a},4646:function(t,e,n){},4961:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}));var o={nsEmpty:function(){return n.e("components/ns-empty/ns-empty").then(n.bind(null,"90af"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"4c1d"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"2bc6"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.list,(function(e,n){var o=t.__get_orig(e),i=t.$util.img(2==e.useState?"/upload/uniapp/coupon/bg_lingqu_gary.png":"/upload/uniapp/coupon/bg_lingqu.png"),s="reward"==e.type?parseInt(e.money):null,u="reward"!=e.type&&"discount"==e.type?parseFloat(e.discount):null,r=e.validity_type?null:t.$util.timeStampTurnTime(e.end_time);return{$orig:o,g0:i,m0:s,m1:u,g1:r}})));t.$mp.data=Object.assign({},{$root:{l0:n}})},s=[]},"9b78":function(t,e,n){"use strict";n.r(e);var o=n("4961"),i=n("d371");for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("bc19"),n("0927");var u,r=n("f0c5"),a=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"7643c411",null,!1,o["a"],u);e["default"]=a.exports},a39a:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("b6ac"));function i(t){return t&&t.__esModule?t:{default:t}}var s={data:function(){return{list:[],sort:1,types:"",couponBtnSwitch:!1,memberId:0,mpShareData:null}},onLoad:function(e){var n=this;if(this.$util.getMemberId().then((function(t){n.memberId=t})).catch((function(t){console.log("reject",t)})),e.source_member&&t.setStorageSync("source_member",e.source_member),e.scene){var o=decodeURIComponent(e.scene);o=o.split("&"),o.length&&o.forEach((function(e){-1!=e.indexOf("sku_id")&&(n.skuId=e.split("-")[1]),-1!=e.indexOf("m")&&t.setStorageSync("source_member",e.split("-")[1]),-1!=e.indexOf("is_test")&&t.setStorageSync("is_test",1)}))}},onShow:function(){var e=this;if(!this.addonIsExit.coupon)return this.$util.showToast({title:"商家未开启优惠券",mask:!0,duration:2e3}),void setTimeout((function(){e.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),2e3);t.getStorageSync("token")&&t.getStorageSync("source_member")&&this.$util.onSourceMember(t.getStorageSync("source_member")),this.$util.getMpShare().then((function(t){e.mpShareData=t})),this.$langConfig.refresh()},onShareAppMessage:function(){return this.mpShareData.appMessage},onShareTimeline:function(){return this.mpShareData.timeLine},mixins:[o.default],methods:{changeSort:function(t,e){this.list=[],this.sort=t,this.types=e,this.$refs.mescroll.refresh(!1)},liClick:function(t,e){0==t.useState?this.receiveCoupon(t,e):this.toGoodsList(t,e)},receiveCoupon:function(e,n){var o=this;if(!this.couponBtnSwitch){this.couponBtnSwitch=!0;var i=t.getStorageSync("token");""!=i?this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:e.coupon_type_id,get_type:2},success:function(t){o.couponBtnSwitch=!1;var n="";n="领取成功，快去使用吧";var i=o.list;if(n=1==t.data.is_exist&&t.code<0?"您已领取过该优惠券，快去使用吧":t.message,1==t.data.is_exist)for(var s=0;s<i.length;s++)i[s].coupon_type_id==e.coupon_type_id&&(i[s].useState=1);else for(var u=0;u<i.length;u++)i[u].coupon_type_id==e.coupon_type_id&&(i[u].useState=2);o.$util.showToast({title:n})},fail:function(t){o.couponBtnSwitch=!1}}):(this.couponBtnSwitch=!1,this.$refs.login.open("/otherpages/login/login/login"))}},getMemberCounponList:function(t){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/typepagelists",data:{page:t.num,page_size:t.size,sort:this.sort,type:this.types},success:function(n){var o=[],i=n.message;0==n.code&&n.data?o=n.data.list:e.$util.showToast({title:i}),t.endSuccess(o.length),o.length&&o.forEach((function(t){t.count==t.lead_count?t.useState=2:t.useState=0})),1==t.num&&(e.list=[]),e.list=e.list.concat(o),e.$refs.loadingCover&&e.$refs.loadingCover.hide()},fail:function(){t.endErr(),this.$refs.loadingCover&&this.$refs.loadingCover.hide()}})},imageError:function(t){this.list[t].logo=this.$util.getDefaultImage().default_goods_img,this.$forceUpdate()},couponImageError:function(t){this.list[t].image=this.$util.img("upload/uniapp/goods/coupon.png"),this.$forceUpdate()},toGoodsList:function(t){1!=t.goods_type?this.$util.redirectTo("/pages/goods/list/list",{coupon:t.coupon_type_id}):this.$util.redirectTo("/pages/goods/list/list",{})}}};e.default=s}).call(this,n("543d")["default"])},a822:function(t,e,n){},bc19:function(t,e,n){"use strict";var o=n("a822"),i=n.n(o);i.a},c683:function(t,e,n){"use strict";(function(t){n("67ba");o(n("66fd"));var e=o(n("9b78"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d371:function(t,e,n){"use strict";n.r(e);var o=n("a39a"),i=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=i.a}},[["c683","common/runtime","common/vendor"]]]);