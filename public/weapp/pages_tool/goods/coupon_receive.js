(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_tool/goods/coupon_receive"],{1577:function(e,t,o){"use strict";var n=o("b8e5"),i=o.n(n);i.a},"7e74":function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return c})),o.d(t,"a",(function(){return n}));var n={loadingCover:function(){return o.e("components/loading-cover/loading-cover").then(o.bind(null,"790a"))},nsLogin:function(){return o.e("components/ns-login/ns-login").then(o.bind(null,"2893"))}},i=function(){var e=this,t=e.$createElement,o=(e._self._c,e.$util.img(e.path)),n=0==e.info.validity_type?e.$util.timeStampTurnTime(e.info.end_time):null;e.$mp.data=Object.assign({},{$root:{g0:o,g1:n}})},c=[]},"8e10":function(e,t,o){"use strict";(function(e){o("34b0");n(o("66fd"));var t=n(o("a9d4"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])},a9d4:function(e,t,o){"use strict";o.r(t);var n=o("7e74"),i=o("f9fb");for(var c in i)"default"!==c&&function(e){o.d(t,e,(function(){return i[e]}))}(c);o("1577");var u,s=o("f0c5"),r=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],u);t["default"]=r.exports},b8e5:function(e,t,o){},e1d4:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{info:{},couponTypeId:0,path:"",button:"领取",uid:0,couponBtnSwitch:!1,memberId:0,receivedNum:0}},onLoad:function(t){var o=this;if(!this.addonIsExist.coupon)return this.$util.showToast({title:"商家未开启优惠券",mask:!0,duration:2e3}),void setTimeout((function(){o.$util.redirectTo("/pages/index/index",{},"redirectTo")}),2e3);if(t.source_member&&e.setStorageSync("source_member",t.source_member),t.coupon_type_id&&(this.couponTypeId=t.coupon_type_id),t.scene){var n=decodeURIComponent(t.scene);n=n.split("&"),n.length&&n.forEach((function(n){-1!=n.indexOf("coupon_type_id")&&(o.couponTypeId=n.split("-")[1]),-1!=n.indexOf("m")&&(o.source_member=n.split("-")[1],e.setStorageSync("source_member",t.source_member))}))}},onShow:function(){var t=this;this.getCoupon(),this.receivedNum=0,e.getStorageSync("token")&&(this.$util.getMemberId().then((function(e){t.memberId=e,t.info.coupon_type_id&&t.setPublicShare()})),this.getReceivedNum()),e.getStorageSync("token")&&e.getStorageSync("source_member")&&this.$util.onSourceMember(e.getStorageSync("source_member"))},onHide:function(){this.couponBtnSwitch=!1},methods:{getCoupon:function(){var t=this;this.$api.sendRequest({url:"/coupon/api/coupon/typeinfo",data:{coupon_type_id:this.couponTypeId},success:function(o){var n=o.data;n?(t.info=n,t.path=n.qrcode,t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.buttonRefresh(),t.setPublicShare()):(t.$util.showToast({title:o.message}),setTimeout((function(){e.navigateBack({delta:1})}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},receiveGoodsCoupon:function(t){var o=this;e.getStorageSync("token")?this.isCanReceive&&(this.couponBtnSwitch||(this.couponBtnSwitch=!0,this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:t,get_type:2},success:function(e){e.data;var t=e.message;0==e.code&&(t="领取成功",o.receivedNum+=1,o.buttonRefresh()),o.$util.showToast({title:t}),o.couponBtnSwitch=!1},fail:function(e){o.couponBtnSwitch=!1}}))):this.$refs.login.open("/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId)},getReceivedNum:function(){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/receivedNum",data:{coupon_type_id:this.couponTypeId},success:function(t){t.code>=0&&(e.receivedNum=t.data,e.buttonRefresh())}})},buttonRefresh:function(){this.button="领取",this.info.count==this.info.lead_count?this.button="来迟了该优惠券已被领取完了":0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum?this.button="领取":this.button="该优惠券领取已达到上限"},setPublicShare:function(){var e=this.$config.h5Domain+"/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId;this.memberId&&(e+="&source_member="+this.memberId);var t="恭喜您获得一张"+this.info.money+"元的优惠券";if(1==this.info.range_type)var o="满".concat(this.info.at_least,"全场可用");else o="满".concat(this.info.at_least,"部分商品可用");this.$util.setPublicShare({title:t,desc:o,link:e,imgUrl:this.$store.state.siteInfo?this.$store.state.siteInfo.logo_square:""})}},computed:{isCanReceive:{get:function(){return this.info.count!=this.info.lead_count&&(0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum)}}},onShareAppMessage:function(e){var t="恭喜您获得一张"+this.info.money+"元的优惠券";1==this.info.range_type?t+=",满".concat(this.info.at_least,"全场可用"):t+=",满".concat(this.info.at_least,"部分商品可用");var o="/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId;return this.memberId&&(o+="&source_member="+this.memberId),{title:t,path:o,success:function(e){},fail:function(e){}}}};t.default=o}).call(this,o("543d")["default"])},f9fb:function(e,t,o){"use strict";o.r(t);var n=o("e1d4"),i=o.n(n);for(var c in n)"default"!==c&&function(e){o.d(t,e,(function(){return n[e]}))}(c);t["default"]=i.a}},[["8e10","common/runtime","common/vendor"]]]);