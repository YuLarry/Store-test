(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_tool/goods/coupon"],{"0101":function(t,e,n){"use strict";n.r(e);var o=n("7a55"),i=n("7b91");for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("5976");var u,r=n("f0c5"),c=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],u);e["default"]=c.exports},5976:function(t,e,n){"use strict";var o=n("6f24"),i=n.n(o);i.a},"6f24":function(t,e,n){},"7a55":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}));var o={nsEmpty:function(){return n.e("components/ns-empty/ns-empty").then(n.bind(null,"2c4c"))},loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"790a"))},nsLogin:function(){return n.e("components/ns-login/ns-login").then(n.bind(null,"2893"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.$util.img("public/uniapp/coupon/coupon_line.png")),o=t.__map(t.list,(function(e,n){var o=t.__get_orig(e),i="reward"==e.type?parseInt(e.money):null,s="reward"!=e.type&&"discount"==e.type?parseFloat(e.discount):null,u=0==e.validity_type?t.$util.timeStampTurnTime(e.end_time):null;return{$orig:o,m0:i,m1:s,g1:u}}));t.$mp.data=Object.assign({},{$root:{g0:n,l0:o}})},s=[]},"7b91":function(t,e,n){"use strict";n.r(e);var o=n("f7e1"),i=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=i.a},"9cf9":function(t,e,n){"use strict";(function(t){n("34b0");o(n("66fd"));var e=o(n("0101"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},f7e1:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{list:[],sort:1,types:"",couponBtnSwitch:!1,memberId:0,mpShareData:null}},onLoad:function(e){var n=this;if(this.$util.getMemberId().then((function(t){n.memberId=t})),e.source_member&&t.setStorageSync("source_member",e.source_member),e.scene){var o=decodeURIComponent(e.scene);o=o.split("&"),o.length&&o.forEach((function(e){-1!=e.indexOf("sku_id")&&(n.skuId=e.split("-")[1]),-1!=e.indexOf("m")&&t.setStorageSync("source_member",e.split("-")[1]),-1!=e.indexOf("is_test")&&t.setStorageSync("is_test",1)}))}},onShow:function(){var e=this;if(!this.addonIsExist.coupon)return this.$util.showToast({title:"商家未开启优惠券",mask:!0,duration:2e3}),void setTimeout((function(){e.$util.redirectTo("/pages/index/index",{},"redirectTo")}),2e3);t.getStorageSync("token")&&t.getStorageSync("source_member")&&this.$util.onSourceMember(t.getStorageSync("source_member")),this.$util.getMpShare().then((function(t){e.mpShareData=t}))},onShareAppMessage:function(){return this.mpShareData.appMessage},onShareTimeline:function(){return this.mpShareData.timeLine},methods:{changeSort:function(t,e){this.list=[],this.sort=t,this.types=e,this.$refs.mescroll.refresh(!1)},liClick:function(t,e){0==t.useState?this.receiveCoupon(t,e):this.toGoodsList(t,e)},receiveCoupon:function(e,n){var o=this;if(!this.couponBtnSwitch){this.couponBtnSwitch=!0;var i=t.getStorageSync("token");""!=i?this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:e.coupon_type_id,get_type:2},success:function(t){o.couponBtnSwitch=!1;var n="";n="领取成功，快去使用吧";var i=o.list;if(n=1==t.data.is_exist&&t.code<0?"您已领取过该优惠券，快去使用吧":t.message,1==t.data.is_exist)for(var s=0;s<i.length;s++)i[s].coupon_type_id==e.coupon_type_id&&(i[s].useState=1);else for(var u=0;u<i.length;u++)i[u].coupon_type_id==e.coupon_type_id&&(i[u].useState=2);o.$util.showToast({title:n})},fail:function(t){o.couponBtnSwitch=!1}}):(this.couponBtnSwitch=!1,this.$refs.login.open("/pages_tool/login/login"))}},getMemberCounponList:function(t){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/typepagelists",data:{page:t.num,page_size:t.size,sort:this.sort,type:this.types},success:function(n){var o=[],i=n.message;0==n.code&&n.data?o=n.data.list:e.$util.showToast({title:i}),t.endSuccess(o.length),o.length&&o.forEach((function(t){t.count==t.lead_count?t.useState=2:0!=t.max_fetch&&t.member_coupon_num&&t.member_coupon_num>=t.max_fetch?t.useState=1:t.useState=0})),1==t.num&&(e.list=[]),e.list=e.list.concat(o),e.$refs.loadingCover&&e.$refs.loadingCover.hide()},fail:function(){t.endErr(),this.$refs.loadingCover&&this.$refs.loadingCover.hide()}})},imageError:function(t){this.list[t].logo=this.$util.getDefaultImage().goods,this.$forceUpdate()},couponImageError:function(t){this.list[t].image=this.$util.img("public/uniapp/goods/coupon.png"),this.$forceUpdate()},toGoodsList:function(t){1!=t.goods_type?this.$util.redirectTo("/pages/goods/list",{coupon:t.coupon_type_id}):this.$util.redirectTo("/pages/goods/list",{})}}};e.default=n}).call(this,n("543d")["default"])}},[["9cf9","common/runtime","common/vendor"]]]);