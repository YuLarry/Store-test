(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/ns-goods-sku/ns-goods-sku-category"],{1187:function(t,i,e){"use strict";e.r(i);var s=e(1188),o=e(1190);for(var a in o)"default"!==a&&function(t){e.d(i,t,(function(){return o[t]}))}(a);e(1192);var n,u=e(14),r=Object(u["default"])(o["default"],s["render"],s["staticRenderFns"],!1,null,"1d3829d2",null,!1,s["components"],n);r.options.__file="components/ns-goods-sku/ns-goods-sku-category.vue",i["default"]=r.exports},1188:function(t,i,e){"use strict";e.r(i);var s=e(1189);e.d(i,"render",(function(){return s["render"]})),e.d(i,"staticRenderFns",(function(){return s["staticRenderFns"]})),e.d(i,"recyclableRender",(function(){return s["recyclableRender"]})),e.d(i,"components",(function(){return s["components"]}))},1189:function(t,i,e){"use strict";var s;e.r(i),e.d(i,"render",(function(){return o})),e.d(i,"staticRenderFns",(function(){return n})),e.d(i,"recyclableRender",(function(){return a})),e.d(i,"components",(function(){return s}));try{s={uniPopup:function(){return e.e("components/uni-popup/uni-popup").then(e.bind(null,772))},nsLogin:function(){return Promise.all([e.e("common/vendor"),e.e("components/ns-login/ns-login")]).then(e.bind(null,742))}}}catch(u){if(-1===u.message.indexOf("Cannot find module")||-1===u.message.indexOf(".vue"))throw u;console.error(u.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.$util.img(t.goodsDetail.sku_image,{size:"mid"})),s=t.__map(t.goodsDetail.goods_spec_format,(function(i,e){var s=t.__get_orig(i),o=t.__map(i.value,(function(i,e){var s=t.__get_orig(i),o=i.image?t.$util.img(i.image,{size:"small"}):null;return{$orig:s,g1:o}}));return{$orig:s,l0:o}}));t.$mp.data=Object.assign({},{$root:{g0:e,l1:s}})},a=!1,n=[];o._withStripped=!0},1190:function(t,i,e){"use strict";e.r(i);var s=e(1191),o=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(i,t,(function(){return s[t]}))}(a);i["default"]=o.a},1191:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;s(e(142));function s(t){return t&&t.__esModule?t:{default:t}}var o=function(){e.e("components/uni-popup/uni-popup-sku-new").then(function(){return resolve(e(1244))}.bind(null,e)).catch(e.oe)},a={name:"ns-goods-sku-category",components:{uniPopup:o},props:{disabled:{type:Boolean,default:!1}},data:function(){return{isIphoneX:!1,systemInfo:{},number:0,btnSwitch:!1,type:"",callback:null,skuId:0,limitNumber:0,cartData:[],cartIdArr:[],goodsDetail:{},maxBuy:0,minBuy:0,isLoad:!1,goodsCartNumber:0}},created:function(){this.isIphoneX=this.$util.uniappIsIPhoneX(),this.systemInfo=t.getSystemInfoSync()},watch:{goodsDetail:function(t,i){this.skuId=t.sku_id},minBuy:function(t,i){this.minBuy>1&&(this.number=Number(this.minBuy))}},methods:{show:function(t,i,e){this.goodsDetail=i,this.dealData(),this.$refs.skuPopup.open(),this.type=t,this.callback=e,this.skuId=this.goodsDetail.sku_id,this.maxBuy=this.goodsDetail.max_buy,this.minBuy=this.goodsDetail.min_buy,this.isLoad=!0,this.getCartData(),this.getGoodsCartNum()},hide:function(){this.$refs.skuPopup.close()},change:function(t,i){if(!this.disabled){this.btnSwitch=!1,this.skuId=t;for(var e=0;e<this.goodsDetail.goods_spec_format.length;e++)for(var s=this.goodsDetail.goods_spec_format[e],o=0;o<s.value.length;o++)i==this.goodsDetail.goods_spec_format[e].value[o].spec_id&&(this.goodsDetail.goods_spec_format[e].value[o].selected=!1);this.isLoad=!0,this.getGoodsSkuInfo()}},previewMedia:function(){var i=[];i.push(this.$util.img(this.goodsDetail.sku_image,{size:"big"})),t.previewImage({current:1,urls:i})},getGoodsSkuInfo:function(){var t=this;this.getCartData();this.$api.sendRequest({url:"/api/goodssku/getInfoForCategory",data:{sku_id:void 0==this.skuId?this.goodsDetail.sku_id:this.skuId},success:function(i){var e=i.data;if(null!=e){e.unit=e.unit||"件",t.goodsDetail=e,t.dealData(),t.btnSwitch=!1;var s=t.goodsDetail;s.num=void 0!==t.cartData[t.skuId]?t.cartData[t.skuId]:0,t.$emit("refresh",s)}else t.$util.redirectTo("/pages/index/index",{},"reLaunch")},fail:function(i){t.btnSwitch=!1,t.$util.redirectTo("/pages/index/index",{},"reLaunch")}})},dealData:function(){1==this.goodsDetail.promotion_type?this.goodsDetail.member_price&&this.goodsDetail.member_price<=this.goodsDetail.price?this.goodsDetail.show_price=this.goodsDetail.member_price:this.goodsDetail.show_price=this.goodsDetail.discount_price:this.goodsDetail.member_price?this.goodsDetail.show_price=this.goodsDetail.member_price:this.goodsDetail.show_price=this.goodsDetail.price,this.goodsDetail.sku_spec_format&&"string"==typeof this.goodsDetail.sku_spec_format&&(this.goodsDetail.sku_spec_format=JSON.parse(this.goodsDetail.sku_spec_format)),this.goodsDetail.goods_spec_format&&"string"==typeof this.goodsDetail.goods_spec_format&&(this.goodsDetail.goods_spec_format=JSON.parse(this.goodsDetail.goods_spec_format)),this.goodsDetail.unit=this.goodsDetail.unit||"件",this.keyInput(!1)},changeNum:function(i,e){var s=this;if(0!=this.goodsDetail.stock){var o=this.goodsDetail.stock,a=1;if(1==this.goodsDetail.is_limit&&this.maxBuy>0&&this.maxBuy<o&&(o=this.maxBuy),1==this.goodsDetail.is_limit&&2==this.goodsDetail.limit_type&&this.maxBuy>0&&this.goodsDetail.purchased_num>0){var n=this.maxBuy-this.goodsDetail.purchased_num;o=n<this.goodsDetail.stock?n:this.goodsDetail.stock}if(this.minBuy>1&&(a=this.minBuy),"+"==i){if(this.number<o)this.number++;else{if(this.number>=this.goodsDetail.stock)return void this.$util.showToast({title:"库存不足"});if(1==this.goodsDetail.is_limit&&this.maxBuy>0){if(1==this.goodsDetail.limit_type)return void this.$util.showToast({title:"该商品每次最多购买"+this.maxBuy+this.goodsDetail.unit});if(2==this.goodsDetail.limit_type){var u="该商品每人限购"+this.maxBuy+this.goodsDetail.unit;return u+=this.goodsDetail.purchased_num>0?"，您已购买了"+this.goodsDetail.purchased_num+this.goodsDetail.unit:"",void this.$util.showToast({title:u})}}}var r=t.createSelectorQuery().in(this);r.select("#"+e.currentTarget.id+" .click-event").boundingClientRect((function(t){t&&s.$emit("addCart",t.left,t.top)})).exec()}else"-"==i&&(this.number>a?this.number-=1:this.number=0);this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.number?this.cartNumChange(this.number,this.cartIdArr[this.skuId]):this.deleteCart()}},blur:function(){var t=this;if(this.number||(this.number=1),this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.goodsDetail.is_limit&&this.maxBuy>0){var i=this.maxBuy-this.goodsDetail.purchased_num;this.number>i&&(this.number=i)}this.number<this.minBuy&&this.minBuy>0&&(this.number=this.minBuy);var e=parseInt(this.number);this.isLoad=!1,setTimeout((function(){t.number=e,t.cartNumChange(t.number,t.cartIdArr[t.skuId])}),0)},keyInput:function(t,i){var e=this;setTimeout((function(){var s=e.goodsDetail.stock;0!=e.goodsDetail.stock?(t&&0==e.number.length&&(e.number=1),t&&(e.number<=0||isNaN(e.number))&&(e.number=1),e.number>s&&(e.number=s),e.minBuy>1&&e.number<e.minBuy&&(e.number=e.minBuy),t&&(e.number=parseInt(e.number)),i&&i()):e.number=0}),0)},confirm:function(i){var e=this;t.getStorageSync("token")?(this.number=1,this.keyInput(!0,(function(){if(0!=e.goodsDetail.stock)if(e.number>e.goodsDetail.stock)e.$util.showToast({title:"库存不足"});else if(1==e.goodsDetail.is_limit&&1==e.goodsDetail.limit_type&&e.maxBuy>0&&e.number>e.maxBuy)e.$util.showToast({title:"该商品每次最多购买"+e.maxBuy+e.goodsDetail.unit});else{if(1==e.goodsDetail.is_limit&&2==e.goodsDetail.limit_type&&e.maxBuy>0&&e.number+e.goodsDetail.purchased_num>e.maxBuy){var t="该商品每人限购"+e.maxBuy+e.goodsDetail.unit;return t+=e.goodsDetail.purchased_num>0?"，您已购买了"+e.goodsDetail.purchased_num+e.goodsDetail.unit:"",void e.$util.showToast({title:t})}e.$emit("addCart",i.detail.x,i.detail.y),e.btnSwitch||(e.btnSwitch=!0,e.$api.sendRequest({url:"/api/cart/add",data:{sku_id:e.goodsDetail.sku_id,num:e.number},success:function(t){var i=t.data;i>0&&(e.getCartData(),e.getGoodsSkuInfo(),e.$store.dispatch("getCartNumber"),e.$util.showToast({title:"加入购物车成功"}),e.callback&&e.callback()),e.btnSwitch=!1},fail:function(t){e.$refs.skuPopup.close(),e.btnSwitch=!1}}))}else e.$util.showToast({title:"商品已售罄"})}))):this.$refs.login.open()},closeSkuPopup:function(){this.$refs.skuPopup.close()},imageError:function(){this.goodsDetail.sku_image=this.$util.getDefaultImage().goods,this.$forceUpdate()},valueImageError:function(t,i){this.goodsDetail.goods_spec_format[t].value[i].image=this.$util.getDefaultImage().goods,this.$forceUpdate()},getCartData:function(){var t=this;this.$api.sendRequest({url:"/api/cart/lists",success:function(i){if(i.code>=0){var e=[],s=[];if(i.data.length)for(var o=0;o<i.data.length;o++)e[i.data[o].sku_id]=i.data[o].num,s[i.data[o].sku_id]=i.data[o].cart_id;t.cartData=e,t.cartIdArr=s}t.number=t.cartData[t.skuId]?t.cartData[t.skuId]:0,t.$forceUpdate()}})},cartNumChange:function(t,i){var e=this;t<1&&(t=1),this.modifyFlag=!0,this.$api.sendRequest({url:"/api/cart/edit",data:{num:t,cart_id:i},success:function(i){i.code>=0&&(e.cartData[e.skuId]=t,e.$store.dispatch("getCartNumber"),e.getGoodsCartNum())}})},deleteCart:function(){var t=this;this.$api.sendRequest({url:"/api/cart/delete",data:{cart_id:this.cartIdArr[this.skuId]},success:function(i){i.code>=0&&(t.$store.dispatch("getCartNumber"),t.getCartData(),t.getGoodsCartNum())}})},getGoodsCartNum:function(){var t=this;this.$api.sendRequest({url:"/api/cart/goodsnum",data:{goods_id:this.goodsDetail.goods_id},success:function(i){i.code>=0&&(t.goodsCartNumber=i.data)}})}}};i.default=a}).call(this,e(1)["default"])},1192:function(t,i,e){"use strict";e.r(i);var s=e(1193),o=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(i,t,(function(){return s[t]}))}(a);i["default"]=o.a},1193:function(t,i,e){}}]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/ns-goods-sku/ns-goods-sku-category.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/ns-goods-sku/ns-goods-sku-category-create-component',
    {
        'components/ns-goods-sku/ns-goods-sku-category-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(1187))
        })
    },
    [['components/ns-goods-sku/ns-goods-sku-category-create-component']]
]);
