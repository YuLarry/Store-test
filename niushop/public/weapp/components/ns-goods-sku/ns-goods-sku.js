(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/ns-goods-sku/ns-goods-sku"],{800:function(t,e,i){"use strict";i.r(e);var o=i(801),s=i(803);for(var a in s)"default"!==a&&function(t){i.d(e,t,(function(){return s[t]}))}(a);i(805);var u,n=i(14),r=Object(n["default"])(s["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],u);r.options.__file="components/ns-goods-sku/ns-goods-sku.vue",e["default"]=r.exports},801:function(t,e,i){"use strict";i.r(e);var o=i(802);i.d(e,"render",(function(){return o["render"]})),i.d(e,"staticRenderFns",(function(){return o["staticRenderFns"]})),i.d(e,"recyclableRender",(function(){return o["recyclableRender"]})),i.d(e,"components",(function(){return o["components"]}))},802:function(t,e,i){"use strict";var o;i.r(e),i.d(e,"render",(function(){return s})),i.d(e,"staticRenderFns",(function(){return u})),i.d(e,"recyclableRender",(function(){return a})),i.d(e,"components",(function(){return o}));try{o={uniPopup:function(){return i.e("components/uni-popup/uni-popup").then(i.bind(null,772))},nsLogin:function(){return Promise.all([i.e("common/vendor"),i.e("components/ns-login/ns-login")]).then(i.bind(null,742))}}}catch(n){if(-1===n.message.indexOf("Cannot find module")||-1===n.message.indexOf(".vue"))throw n;console.error(n.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var s=function(){var t=this,e=t.$createElement,i=(t._self._c,t.$util.img(t.goodsDetail.sku_image,{size:"mid"})),o=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price?t.showPrice(t.goodsDetail.discount_price):null,s=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price?t.showPrice(t.goodsDetail.member_price):null,a=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price&&o<s?parseFloat(t.goodsDetail.discount_price).toFixed(2).split("."):null,u=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price&&!(o<s)?parseFloat(t.goodsDetail.member_price).toFixed(2).split("."):null,n=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price?t.showPrice(t.goodsDetail.discount_price):null,r=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price?t.showPrice(t.goodsDetail.member_price):null,l=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price&&n<r?parseFloat(t.goodsDetail.discount_price).toFixed(2).split("."):null,d=t.goodsDetail.discount_price>0&&t.goodsDetail.member_price&&!(n<r)?parseFloat(t.goodsDetail.member_price).toFixed(2).split("."):null,c=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price?t.showPrice(t.goodsDetail.discount_price):null,m=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price?t.showPrice(t.goodsDetail.price):null,g=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price&&c<m?parseFloat(t.goodsDetail.discount_price).toFixed(2).split("."):null,p=!(t.goodsDetail.discount_price>0)||t.goodsDetail.member_price||c<m?null:parseFloat(t.goodsDetail.price).toFixed(2).split("."),h=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price?t.showPrice(t.goodsDetail.discount_price):null,_=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price?t.showPrice(t.goodsDetail.price):null,f=t.goodsDetail.discount_price>0&&!t.goodsDetail.member_price&&h<_?parseFloat(t.goodsDetail.discount_price).toFixed(2).split("."):null,D=!(t.goodsDetail.discount_price>0)||t.goodsDetail.member_price||h<_?null:parseFloat(t.goodsDetail.price).toFixed(2).split("."),b=t.goodsDetail.discount_price>0||!t.goodsDetail.member_price?null:parseFloat(t.goodsDetail.member_price).toFixed(2).split("."),k=t.goodsDetail.discount_price>0||t.goodsDetail.member_price?null:parseFloat(t.goodsDetail.price).toFixed(2).split("."),y=t.goodsDetail.discount_price>0||!t.goodsDetail.member_price?null:parseFloat(t.goodsDetail.member_price).toFixed(2).split("."),v=t.goodsDetail.discount_price>0||t.goodsDetail.member_price?null:parseFloat(t.goodsDetail.price).toFixed(2).split("."),w=t.__map(t.goodsDetail.goods_spec_format,(function(e,i){var o=t.__get_orig(e),s=t.__map(e.value,(function(e,i){var o=t.__get_orig(e),s=e.image?t.$util.img(e.image,{size:"small"}):null;return{$orig:o,g13:s}}));return{$orig:o,l0:s}}));t.$mp.data=Object.assign({},{$root:{g0:i,m0:o,m1:s,g1:a,g2:u,m2:n,m3:r,g3:l,g4:d,m4:c,m5:m,g5:g,g6:p,m6:h,m7:_,g7:f,g8:D,g9:b,g10:k,g11:y,g12:v,l1:w}})},a=!1,u=[];s._withStripped=!0},803:function(t,e,i){"use strict";i.r(e);var o=i(804),s=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=s.a},804:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i(142));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){i.e("components/uni-popup/uni-popup-sku").then(function(){return resolve(i(1173))}.bind(null,i)).catch(i.oe)},u={name:"ns-goods-sku",components:{uniPopup:a},props:{goodsDetail:{type:Object,default:null},disabled:{type:Boolean,default:!1},maxBuy:{type:Number,default:0},minBuy:{type:Number,default:0}},data:function(){return{isIphoneX:!1,systemInfo:{},number:1,btnSwitch:!1,type:"",callback:null,skuId:0,limitNumber:0,minNumber:0,preview:0,cartNumber:0,goodsSkuDetail:{}}},created:function(){this.isIphoneX=this.$util.uniappIsIPhoneX(),this.systemInfo=t.getSystemInfoSync()},watch:{goodsDetail:function(t,e){this.skuId=t.sku_id},minBuy:function(t,e){this.minBuy>1&&(this.number=Number(this.minBuy))}},computed:{decreaseDisabled:function(){var t=this.minBuy>0?this.minBuy:1;return this.number<=t},increaseDisabled:function(){var t=this.maxBuy>0&&this.maxBuy<this.goodsDetail.stock?this.maxBuy:this.goodsDetail.stock;return this.number>=t}},methods:{show:function(t,e){this.callback=e,this.$refs.skuPopup.open(),this.type=t,this.skuId=this.goodsDetail.sku_id,this.preview=this.goodsDetail.preview||0,"join_cart"==this.type&&this.getCartData(),this.$forceUpdate()},hide:function(){this.$refs.skuPopup.close()},previewMedia:function(){var e=[];e.push(this.$util.img(this.goodsDetail.sku_image,{size:"big"})),t.previewImage({current:1,urls:e})},change:function(t,e){if(!this.disabled){this.btnSwitch=!1,this.skuId=t;for(var i=0;i<this.goodsDetail.goods_spec_format.length;i++)for(var o=this.goodsDetail.goods_spec_format[i],s=0;s<o.value.length;s++)e==this.goodsDetail.goods_spec_format[i].value[s].spec_id&&(this.goodsDetail.goods_spec_format[i].value[s].selected=!1);this.getGoodsSkuInfo()}},showPrice:function(t){return parseFloat(t)},getGoodsSkuInfo:function(){var t=this;this.$api.sendRequest({url:"/api/goodssku/info",data:{sku_id:this.skuId},success:function(e){var i=e.data;null!=i?(i.unit=i.unit||"件",t.goodsSkuDetail=i,t.dealData(),1==t.goodsSkuDetail.promotion_type&&(t.goodsSkuDetail.discountTimeMachine=t.$util.countDown(t.goodsSkuDetail.end_time-e.timestamp)),1==t.goodsSkuDetail.promotion_type&&t.goodsSkuDetail.discountTimeMachine?t.goodsSkuDetail.member_price>0&&Number(t.goodsSkuDetail.member_price)<=Number(t.goodsSkuDetail.discount_price)?t.goodsSkuDetail.show_price=t.goodsSkuDetail.member_price:t.goodsSkuDetail.show_price=t.goodsSkuDetail.discount_price:t.goodsSkuDetail.member_price>0?t.goodsSkuDetail.show_price=t.goodsSkuDetail.member_price:t.goodsSkuDetail.show_price=t.goodsSkuDetail.price,t.btnSwitch=!1,t.$emit("refresh",t.goodsSkuDetail),t.$emit("GetSkuid",t.skuId),t.$emit("levelInfo",t.levelInfo),t.$forceUpdate()):t.$util.redirectTo("/pages/index/index",{},"reLaunch")},fail:function(e){t.btnSwitch=!1,t.$util.redirectTo("/pages/index/index",{},"reLaunch")}})},dealData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.goodsSkuDetail;if(t.sku_images?t.sku_images=t.sku_images.split(","):t.sku_images=[],t.goods_spec_format&&t.goods_image&&(t.goods_image=t.goods_image.split(","),t.sku_images=t.goods_image.concat(t.sku_images)),t.sku_spec_format&&(t.sku_spec_format=JSON.parse(t.sku_spec_format)),t.goods_attr_format){var e=JSON.parse(t.goods_attr_format);t.goods_attr_format=this.$util.unique(e,"attr_id");for(var i=0;i<t.goods_attr_format.length;i++)for(var s=0;s<e.length;s++)t.goods_attr_format[i].attr_id==e[s].attr_id&&t.goods_attr_format[i].attr_value_id!=e[s].attr_value_id&&(t.goods_attr_format[i].attr_value_name+="、"+e[s].attr_value_name)}t.goods_spec_format&&(t.goods_spec_format=JSON.parse(t.goods_spec_format)),t.goods_content=(0,o.default)(t.goods_content),this.goodsDetail.unit=this.goodsDetail.unit||"件",this.keyInput(!0),"confirm"!=this.type&&this.$langConfig.title(t.goods_name)},changeNum:function(t){if(0!=this.goodsDetail.stock){var e=1,i=this.goodsDetail.stock;if(1==this.maxBuy&&(i=1),1==this.goodsDetail.is_limit&&this.maxBuy>0&&this.maxBuy<i&&(i=this.maxBuy),1==this.goodsDetail.is_limit&&2==this.goodsDetail.limit_type&&this.maxBuy>0&&this.goodsDetail.purchased_num>0){var o=this.maxBuy-this.goodsDetail.purchased_num;i=o<this.goodsDetail.stock?o:this.goodsDetail.stock}if(this.minBuy>1&&(e=this.minBuy),"+"==t)if(this.number<i)this.number++;else{if(this.number>=this.goodsDetail.stock)return void this.$util.showToast({title:"库存不足"});if(1==this.goodsDetail.is_limit&&this.maxBuy>0){if(1==this.goodsDetail.limit_type)return void this.$util.showToast({title:"该商品每次最多购买"+this.maxBuy+this.goodsDetail.unit});if(2==this.goodsDetail.limit_type){var s="该商品每人限购"+this.maxBuy+this.goodsDetail.unit;return s+=this.goodsDetail.purchased_num>0?"，您已购买了"+this.goodsDetail.purchased_num+this.goodsDetail.unit:"",void this.$util.showToast({title:s})}}}else if("-"==t){if(!(this.number>e))return void(this.minBuy>1&&this.$util.showToast({title:"该商品"+this.minBuy+this.goodsDetail.unit+"起售"}));this.number-=1}this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber)}},blur:function(){if(this.number||(this.number=0),this.number>this.limitNumber&&this.limitNumber&&(this.number=this.limitNumber),this.number<this.minNumber&&this.minNumber&&(this.number=this.minNumber),1==this.goodsDetail.is_limit&&this.maxBuy>0&&this.number>this.maxBuy&&(this.number=this.maxBuy),1==this.goodsDetail.is_limit&&this.maxBuy>0&&this.goodsDetail.purchased_num>0){var t=this.maxBuy-this.goodsDetail.purchased_num;this.number>t&&(this.number=t)}this.number<this.minBuy&&this.minBuy>0&&(this.number=this.minBuy),this.number<=0&&(this.number=1)},keyInput:function(t,e){var i=this;setTimeout((function(){var o=i.goodsDetail.stock;0!=i.goodsDetail.stock?(t&&0==i.number.length&&(i.number=1),t&&(i.number<=0||isNaN(i.number))&&(i.number=1),i.number>o&&(i.number=o),i.minBuy>1&&i.number<i.minBuy&&(i.number=i.minBuy),t&&(i.number=parseInt(i.number)),e&&e()):i.number=0}),0)},confirm:function(){var e=this;t.removeStorageSync("delivery"),this.preview?this.$util.showToast({title:"预览商品无法购买"}):t.getStorageSync("token")?this.keyInput(!0,(function(){if(0!=e.goodsDetail.stock)if(0==e.number.length||e.number<=0)e.$util.showToast({title:"购买数量不能小于等于0"});else if(e.goodsDetail.buy_num>e.goodsDetail.stock)e.$util.showToast({title:"库存小于最低购买数量"});else if(e.number>e.goodsDetail.stock)e.$util.showToast({title:"库存不足"});else if(1==e.goodsDetail.is_limit&&1==e.goodsDetail.limit_type&&e.maxBuy>0&&e.number>e.maxBuy)e.$util.showToast({title:"该商品每次最多购买"+e.maxBuy+e.goodsDetail.unit});else{if(1==e.goodsDetail.is_limit&&2==e.goodsDetail.limit_type&&e.maxBuy>0&&e.number+e.goodsDetail.purchased_num>e.maxBuy){var i="该商品每人限购"+e.maxBuy+e.goodsDetail.unit;return i+=e.goodsDetail.purchased_num>0?"，您已购买了"+e.goodsDetail.purchased_num+e.goodsDetail.unit:"",void e.$util.showToast({title:i})}if("join_cart"==e.type&&1==e.goodsDetail.is_limit&&e.maxBuy>0&&e.cartNumber+e.number>e.maxBuy)e.$util.showToast({title:"该商品每人限购"+e.maxBuy+e.goodsDetail.unit});else if(!e.btnSwitch)if(e.btnSwitch=!0,"join_cart"==e.type)e.$api.sendRequest({url:"/api/cart/add",data:{sku_id:e.skuId,num:e.number},success:function(t){var i=t.data;i>0&&(e.$util.showToast({title:"加入购物车成功"}),e.cartNumber+=e.number,e.callback&&e.callback()),e.$refs.skuPopup.close(),e.btnSwitch=!1},fail:function(t){e.$refs.skuPopup.close(),e.btnSwitch=!1}});else if("buy_now"==e.type){var o={sku_id:e.skuId,num:e.number};t.setStorage({key:"orderCreateData",data:o,success:function(){e.$util.redirectTo("/pages/order/payment"),e.btnSwitch=!1}})}else"confirm"==e.type&&(e.btnSwitch=!1,e.$refs.skuPopup.close(),e.callback&&e.callback(e.skuId,e.number))}else e.$util.showToast({title:"商品已售罄"})})):this.$refs.login.open()},closeSkuPopup:function(){this.$refs.skuPopup.close()},imageError:function(){this.goodsDetail.sku_image=this.$util.getDefaultImage().goods,this.$forceUpdate()},valueImageError:function(t,e){this.goodsDetail.goods_spec_format[t].value[e].image=this.$util.getDefaultImage().goods,this.$forceUpdate()},getCartData:function(){var t=this;this.$api.sendRequest({url:"/api/cart/goodsnum",data:{goods_id:this.goodsDetail.goods_id},success:function(e){e.code>=0&&(t.cartNumber=e.data)}})}}};e.default=u}).call(this,i(1)["default"])},805:function(t,e,i){"use strict";i.r(e);var o=i(806),s=i.n(o);for(var a in o)"default"!==a&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=s.a},806:function(t,e,i){}}]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/ns-goods-sku/ns-goods-sku.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/ns-goods-sku/ns-goods-sku-create-component',
    {
        'components/ns-goods-sku/ns-goods-sku-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(800))
        })
    },
    [['components/ns-goods-sku/ns-goods-sku-create-component']]
]);
