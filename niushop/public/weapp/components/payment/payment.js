(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/payment/payment"],{907:function(e,n,t){"use strict";t.r(n);var a=t(908),o=t(910);for(var i in o)"default"!==i&&function(e){t.d(n,e,(function(){return o[e]}))}(i);t(912);var s,c=t(14),r=Object(c["default"])(o["default"],a["render"],a["staticRenderFns"],!1,null,null,null,!1,a["components"],s);r.options.__file="components/payment/payment.vue",n["default"]=r.exports},908:function(e,n,t){"use strict";t.r(n);var a=t(909);t.d(n,"render",(function(){return a["render"]})),t.d(n,"staticRenderFns",(function(){return a["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return a["recyclableRender"]})),t.d(n,"components",(function(){return a["components"]}))},909:function(e,n,t){"use strict";var a;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return s})),t.d(n,"recyclableRender",(function(){return i})),t.d(n,"components",(function(){return a}));try{a={uniPopup:function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,772))},nsSwitch:function(){return t.e("components/ns-switch/ns-switch").then(t.bind(null,1201))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.payInfo?e._f("moneyFormat")(e.payMoney):null),a=e.payInfo&&e.balanceDeduct>0&&e.balanceUsable&&1==e.balanceConfig?e._f("moneyFormat")(e.balanceDeduct):null;e._isMounted||(e.e0=function(n,t){var a=arguments[arguments.length-1].currentTarget.dataset,o=a.eventParams||a["event-params"];t=o.index;e.payIndex=t}),e.$mp.data=Object.assign({},{$root:{f0:t,f1:a}})},i=!1,s=[];o._withStripped=!0},910:function(e,n,t){"use strict";t.r(n);var a=t(911),o=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(n,e,(function(){return a[e]}))}(i);n["default"]=o.a},911:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=function(){t.e("components/uni-popup/uni-popup").then(function(){return resolve(t(772))}.bind(null,t)).catch(t.oe)},o=function(){t.e("components/ns-switch/ns-switch").then(function(){return resolve(t(1201))}.bind(null,t)).catch(t.oe)},i={name:"payment",components:{uniPopup:a,nsSwitch:o},props:{balanceUsable:{type:Boolean,default:!0}},data:function(){return{payIndex:0,payTypeList:[{name:"微信支付",provider:"wxpay",icon:"iconweixin1",type:"wechatpay"}],payInfo:null,balanceConfig:0,sale:!0,isBalance:0,balance:0}},created:function(e){this.getPayType(),this.balanceUsable&&this.getBalanceConfig()},computed:{balanceDeduct:function(){var e=0;return this.payInfo&&this.balance&&(e=this.balance>this.payInfo.pay_money?this.payInfo.pay_money:this.balance),e},payMoney:function(){var e=0;return this.payInfo&&(e=this.payInfo.pay_money,this.balanceDeduct&&this.isBalance&&this.balanceUsable&&(e=this.payInfo.pay_money-this.balanceDeduct)),e}},methods:{close:function(){this.$emit("close"),this.$refs.choosePaymentPopup.close()},useBalance:function(){this.isBalance=this.isBalance?0:1,this.$emit("useBalance",this.isBalance)},confirm:function(){0==this.payTypeList.length&&this.payMoney>0?this.$util.showToast({title:"请选择支付方式！"}):(e.showLoading({title:"支付中...",mask:!0}),this.pay(),e.setStorageSync("pay_flag",1))},getPayInfo:function(e){var n=this;this.$api.sendRequest({url:"/api/pay/info",data:{out_trade_no:e},success:function(e){e.code>=0&&e.data?(n.payInfo=e.data,n.balanceConfig&&n.balanceUsable&&n.getMemberBalance(),setTimeout((function(){n.$refs.choosePaymentPopup.open()}))):n.$util.showToast({title:"未获取到支付信息！"})}})},getBalanceConfig:function(){var e=this;this.$api.sendRequest({url:"/api/pay/getBalanceConfig",data:{},success:function(n){e.balanceConfig=n.data.balance_show}})},getMemberBalance:function(){var e=this;this.$api.sendRequest({url:"/api/memberaccount/usablebalance",success:function(n){0==n.code&&n.data&&(e.balance=parseFloat(n.data.usable_balance))}})},getPayType:function(){var e=this;this.$api.sendRequest({url:"/api/pay/type",success:function(n){0==n.code&&(""==n.data.pay_type?e.payTypeList=[]:e.payTypeList.forEach((function(t,a){-1==n.data.pay_type.indexOf(t.type)&&e.payTypeList.splice(a,1)})))}})},pay:function(){var n=this,t=this.payTypeList[this.payIndex];this.$api.sendRequest({url:"/api/pay/pay",data:{out_trade_no:this.payInfo.out_trade_no,pay_type:t?t.type:"",scene:e.getStorageSync("is_test")?1175:wx.getLaunchOptionsSync().scene,is_balance:this.isBalance},success:function(t){if(e.hideLoading(),t.code>=0){if(t.data.pay_success)return void n.paySuccess();var a=t.data.data,o=e.getStorageSync("is_test")?1175:wx.getLaunchOptionsSync().scene;-1!=[1175,1176,1177,1191,1195].indexOf(o)?e.requestOrderPayment({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:function(e){n.paySuccess()},fail:function(t){n.flag=!1,"requestOrderPayment:fail cancel"==t.errMsg?(n.$util.showToast({title:"您已取消支付"}),n.resetpay()):(e.showModal({content:"支付失败,失败原因: "+t.errMsg,showCancel:!1}),setTimeout((function(){n.close()}),1500))}}):e.requestPayment({provider:"wxpay",timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:function(e){n.paySuccess()},fail:function(t){n.flag=!1,"requestPayment:fail cancel"==t.errMsg?(n.$util.showToast({title:"您已取消支付"}),n.resetpay()):(e.showModal({content:"支付失败,失败原因: "+t.errMsg,showCancel:!1}),setTimeout((function(){n.close()}),1500))}})}else n.$util.showToast({title:t.message})},fail:function(t){e.hideLoading(),n.$util.showToast({title:"request:fail"})}})},paySuccess:function(){"BlindboxGoodsOrderPayNotify"==this.payInfo.event?this.$util.redirectTo("/pages_promotion/blindbox/index",{outTradeNo:this.payInfo.out_trade_no},"redirectTo"):this.payInfo.return_url?-1!=this.payInfo.return_url.indexOf("http://")||-1!=this.payInfo.return_url.indexOf("https://")?location.replace(this.payInfo.return_url):this.$util.redirectTo(this.payInfo.return_url,{},"redirectTo"):this.$util.redirectTo("/pages_tool/pay/result",{code:this.payInfo.out_trade_no},"redirectTo")},resetpay:function(){var e=this;this.$api.sendRequest({url:"/api/pay/resetpay",data:{out_trade_no:this.payInfo.out_trade_no},success:function(n){0==n.code&&e.getPayInfo(n.data)}})}}};n.default=i}).call(this,t(1)["default"])},912:function(e,n,t){"use strict";t.r(n);var a=t(913),o=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(n,e,(function(){return a[e]}))}(i);n["default"]=o.a},913:function(e,n,t){}}]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/components/payment/payment.js.map
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/payment/payment-create-component',
    {
        'components/payment/payment-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('1')['createComponent'](__webpack_require__(907))
        })
    },
    [['components/payment/payment-create-component']]
]);
