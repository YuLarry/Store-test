(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_tool/login/register"],{704:function(e,t,r){"use strict";(function(e){r(5);n(r(4));var t=n(r(705));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=r,e(t.default)}).call(this,r(1)["createPage"])},705:function(e,t,r){"use strict";r.r(t);var n=r(706),i=r(708);for(var o in i)"default"!==o&&function(e){r.d(t,e,(function(){return i[e]}))}(o);r(710),r(712);var a,s=r(14),c=Object(s["default"])(i["default"],n["render"],n["staticRenderFns"],!1,null,"9e90f272",null,!1,n["components"],a);c.options.__file="pages_tool/login/register.vue",t["default"]=c.exports},706:function(e,t,r){"use strict";r.r(t);var n=r(707);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},707:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return i})),r.d(t,"staticRenderFns",(function(){return a})),r.d(t,"recyclableRender",(function(){return o})),r.d(t,"components",(function(){return n}));try{n={uniPopup:function(){return r.e("components/uni-popup/uni-popup").then(r.bind(null,772))},loadingCover:function(){return r.e("components/loading-cover/loading-cover").then(r.bind(null,714))},registerReward:function(){return r.e("components/register-reward/register-reward").then(r.bind(null,999))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,t=e.$createElement,r=(e._self._c,"mobile"==e.registerMode&&-1!=e.registerConfig.register.indexOf("username")),n="account"==e.registerMode&&-1!=e.registerConfig.register.indexOf("mobile");e.$mp.data=Object.assign({},{$root:{g0:r,g1:n}})},o=!1,a=[];i._withStripped=!0},708:function(e,t,r){"use strict";r.r(t);var n=r(709),i=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},709:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(r(262));function i(e){return e&&e.__esModule?e:{default:e}}var o=function(){r.e("components/uni-popup/uni-popup").then(function(){return resolve(r(772))}.bind(null,r)).catch(r.oe)},a=function(){r.e("components/register-reward/register-reward").then(function(){return resolve(r(999))}.bind(null,r)).catch(r.oe)},s={components:{uniPopup:o,registerReward:a},data:function(){return{allowRegister:!0,registerMode:"account",formData:{mobile:"",account:"",password:"",rePassword:"",vercode:"",dynacode:"",key:""},regisiterAgreement:{title:"",content:""},captcha:{id:"",img:""},isSub:!1,back:"",dynacodeData:{seconds:120,timer:null,codeText:"获取动态码",isSend:!1},registerConfig:{register:""},authInfo:null}},onLoad:function(t){t.back&&(this.back=t.back),this.getCaptcha(),this.getRegisiterAggrement(),this.getRegisterConfig(),this.authInfo=e.getStorageSync("authInfo")},onShow:function(){},onReady:function(){this.$refs.loadingCover&&this.$refs.loadingCover.hide()},methods:{switchRegisterMode:function(){this.registerMode="mobile"==this.registerMode?"account":"mobile"},openPopup:function(){this.$refs.registerPopup.open()},toClose:function(){this.$refs.registerPopup.close()},getRegisiterAggrement:function(){var e=this;this.$api.sendRequest({url:"/api/register/aggrement",success:function(t){t.code>=0&&(e.regisiterAgreement=t.data)}})},getRegisterConfig:function(){var e=this;this.$api.sendRequest({url:"/api/register/config",success:function(t){t.code>=0&&(e.registerConfig=t.data.value,""==e.registerConfig.register?(e.$util.showToast({title:"平台未启用注册!"}),setTimeout((function(){e.$util.redirectTo("/pages/index/index",{},"tabbar")}),1e3)):-1!=e.registerConfig.register.indexOf("username")?e.registerMode="account":e.registerMode="mobile",e.$refs.loadingCover&&e.$refs.loadingCover.hide())}})},getCaptcha:function(){var e=this;this.$api.sendRequest({url:"/api/captcha/captcha",data:{captcha_id:this.captcha.id},success:function(t){t.code>=0&&(e.captcha=t.data,e.captcha.img=e.captcha.img.replace(/\r\n/g,""))}})},register:function(){var t=this;if("account"==this.registerMode){var r="/api/register/username";n={username:this.formData.account,password:this.formData.password}}else{r="/api/register/mobile";var n={mobile:this.formData.mobile,key:this.formData.key,code:this.formData.dynacode}}if(""!=this.captcha.id&&(n.captcha_id=this.captcha.id,n.captcha_code=this.formData.vercode),this.authInfo&&(Object.assign(n,this.authInfo),this.authInfo.nickName&&(n.nickname=this.authInfo.nickName),this.authInfo.avatarUrl&&(n.headimg=this.authInfo.avatarUrl)),e.getStorageSync("source_member")&&(n.source_member=e.getStorageSync("source_member")),this.verify(n)){if(this.isSub)return;this.isSub=!0,this.$api.sendRequest({url:r,data:n,success:function(r){r.code>=0?e.setStorage({key:"token",data:r.data.token,success:function(){t.$refs.registerReward.getReward()?(t.$util.showToast({title:"注册成功"}),t.$refs.registerReward.open(t.back)):""!=t.back?t.$util.redirectTo(decodeURIComponent(t.back),{},"reLaunch"):t.$util.redirectTo("/pages/member/index",{},"reLaunch")}}):(t.isSub=!1,t.getCaptcha(),t.$util.showToast({title:r.message}))},fail:function(e){t.isSub=!1,t.getCaptcha()}})}},verify:function(e){var t=/^[A-Za-z0-9]+$/;if("mobile"==this.registerMode){var r=[{name:"mobile",checkType:"required",errorMsg:"请输入手机号"},{name:"mobile",checkType:"phoneno",errorMsg:"请输入正确的手机号"}];""!=this.captcha.id&&r.push({name:"captcha_code",checkType:"required",errorMsg:this.$lang("captchaPlaceholder")}),r.push({name:"code",checkType:"required",errorMsg:this.$lang("dynacodePlaceholder")})}if("account"==this.registerMode){r=[{name:"username",checkType:"required",errorMsg:"请输入账号"},{name:"password",checkType:"required",errorMsg:"请输入密码"}];var i=this.registerConfig;if(!t.test(e.username))return void this.$util.showToast({title:"用户名只能输入数字跟英文"});if(i.pwd_len>0&&r.push({name:"password",checkType:"lengthMin",checkRule:i.pwd_len,errorMsg:"密码长度不能小于"+i.pwd_len+"位"}),""!=i.pwd_complexity){var o="密码需包含",a="";-1!=i.pwd_complexity.indexOf("number")&&(a+="(?=.*?[0-9])",o+="数字"),-1!=i.pwd_complexity.indexOf("letter")&&(a+="(?=.*?[a-z])",o+="、小写字母"),-1!=i.pwd_complexity.indexOf("upper_case")&&(a+="(?=.*?[A-Z])",o+="、大写字母"),-1!=i.pwd_complexity.indexOf("symbol")&&(a+="(?=.*?[#?!@$%^&*-])",o+="、特殊字符"),r.push({name:"password",checkType:"reg",checkRule:a,errorMsg:o})}if(this.formData.password!=this.formData.rePassword)return this.$util.showToast({title:"两次密码不一致"}),!1;""!=this.captcha.id&&r.push({name:"captcha_code",checkType:"required",errorMsg:this.$lang("captchaPlaceholder")})}var s=n.default.check(e,r);return!!s||(this.$util.showToast({title:n.default.error}),!1)},toLogin:function(){this.back?this.$util.redirectTo("/pages_tool/login/login",{back:encodeURIComponent(this.back)}):this.$util.redirectTo("/pages_tool/login/login")},sendMobileCode:function(){var e=this;if(120==this.dynacodeData.seconds&&!this.dynacodeData.isSend){var t={mobile:this.formData.mobile,captcha_id:this.captcha.id,captcha_code:this.formData.vercode},r=[{name:"mobile",checkType:"required",errorMsg:"请输入手机号"},{name:"mobile",checkType:"phoneno",errorMsg:"请输入正确的手机号"},{name:"captcha_code",checkType:"required",errorMsg:"请输入验证码"}],i=n.default.check(t,r);i?(this.dynacodeData.isSend=!0,this.dynacodeData.timer=setInterval((function(){e.dynacodeData.seconds--,e.dynacodeData.codeText=e.dynacodeData.seconds+"s后可重新获取"}),1e3),this.$api.sendRequest({url:"/api/register/mobileCode",data:t,success:function(t){t.code>=0?e.formData.key=t.data.key:(e.$util.showToast({title:t.message}),e.refreshDynacodeData())},fail:function(){e.$util.showToast({title:"request:fail"}),e.refreshDynacodeData()}})):this.$util.showToast({title:n.default.error})}},refreshDynacodeData:function(){this.getCaptcha(),clearInterval(this.dynacodeData.timer),this.dynacodeData={seconds:120,timer:null,codeText:"获取动态码",isSend:!1}}},watch:{"dynacodeData.seconds":{handler:function(e,t){0==e&&this.refreshDynacodeData()},immediate:!0,deep:!0}}};t.default=s}).call(this,r(1)["default"])},710:function(e,t,r){"use strict";r.r(t);var n=r(711),i=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},711:function(e,t,r){},712:function(e,t,r){"use strict";r.r(t);var n=r(713),i=r.n(n);for(var o in n)"default"!==o&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},713:function(e,t,r){}},[[704,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_tool/login/register.js.map