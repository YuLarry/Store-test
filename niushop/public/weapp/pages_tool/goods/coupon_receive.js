(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_tool/goods/coupon_receive"],{472:function(e,t,n){"use strict";(function(e){n(5);o(n(4));var t=o(n(473));function o(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},473:function(e,t,n){"use strict";n.r(t);var o=n(474),i=n(476);for(var c in i)"default"!==c&&function(e){n.d(t,e,(function(){return i[e]}))}(c);n(478);var r,s=n(14),u=Object(s["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],r);u.options.__file="pages_tool/goods/coupon_receive.vue",t["default"]=u.exports},474:function(e,t,n){"use strict";n.r(t);var o=n(475);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},475:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return r})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return o}));try{o={loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,714))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,742))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$util.img(e.path)),o=0==e.info.validity_type?e.$util.timeStampTurnTime(e.info.end_time):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:o}})},c=!1,r=[];i._withStripped=!0},476:function(e,t,n){"use strict";n.r(t);var o=n(477),i=n.n(o);for(var c in o)"default"!==c&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},477:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={data:function(){return{info:{},couponTypeId:0,path:"",button:"领取",uid:0,couponBtnSwitch:!1,memberId:0,receivedNum:0}},onLoad:function(t){var n=this;if(!this.addonIsExist.coupon)return this.$util.showToast({title:"商家未开启优惠券",mask:!0,duration:2e3}),void setTimeout((function(){n.$util.redirectTo("/pages/index/index",{},"redirectTo")}),2e3);if(t.source_member&&e.setStorageSync("source_member",t.source_member),t.coupon_type_id&&(this.couponTypeId=t.coupon_type_id),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(o){-1!=o.indexOf("coupon_type_id")&&(n.couponTypeId=o.split("-")[1]),-1!=o.indexOf("m")&&(n.source_member=o.split("-")[1],e.setStorageSync("source_member",t.source_member))}))}},onShow:function(){var t=this;this.getCoupon(),this.receivedNum=0,e.getStorageSync("token")&&(this.$util.getMemberId().then((function(e){t.memberId=e,t.info.coupon_type_id&&t.setPublicShare()})),this.getReceivedNum()),e.getStorageSync("token")&&e.getStorageSync("source_member")&&this.$util.onSourceMember(e.getStorageSync("source_member"))},onHide:function(){this.couponBtnSwitch=!1},methods:{getCoupon:function(){var t=this;this.$api.sendRequest({url:"/coupon/api/coupon/typeinfo",data:{coupon_type_id:this.couponTypeId},success:function(n){var o=n.data;o?(t.info=o,t.path=o.qrcode,t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.buttonRefresh(),t.setPublicShare()):(t.$util.showToast({title:n.message}),setTimeout((function(){e.navigateBack({delta:1})}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},receiveGoodsCoupon:function(t){var n=this;e.getStorageSync("token")?this.isCanReceive&&(this.couponBtnSwitch||(this.couponBtnSwitch=!0,this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:t,get_type:2},success:function(e){e.data;var t=e.message;0==e.code&&(t="领取成功",n.receivedNum+=1,n.buttonRefresh()),n.$util.showToast({title:t}),n.couponBtnSwitch=!1},fail:function(e){n.couponBtnSwitch=!1}}))):this.$refs.login.open("/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId)},getReceivedNum:function(){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/receivedNum",data:{coupon_type_id:this.couponTypeId},success:function(t){t.code>=0&&(e.receivedNum=t.data,e.buttonRefresh())}})},buttonRefresh:function(){this.button="领取",this.info.count==this.info.lead_count?this.button="来迟了该优惠券已被领取完了":0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum?this.button="领取":this.button="该优惠券领取已达到上限"},setPublicShare:function(){var e=this.$config.h5Domain+"/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId;this.memberId&&(e+="&source_member="+this.memberId);var t="恭喜您获得一张"+this.info.money+"元的优惠券";if(1==this.info.range_type)var n="满".concat(this.info.at_least,"全场可用");else n="满".concat(this.info.at_least,"部分商品可用");this.$util.setPublicShare({title:t,desc:n,link:e,imgUrl:this.$store.state.siteInfo?this.$store.state.siteInfo.logo_square:""})}},computed:{isCanReceive:{get:function(){return this.info.count!=this.info.lead_count&&(0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum)}}},onShareAppMessage:function(e){var t="恭喜您获得一张"+this.info.money+"元的优惠券";1==this.info.range_type?t+=",满".concat(this.info.at_least,"全场可用"):t+=",满".concat(this.info.at_least,"部分商品可用");var n="/pages_tool/goods/coupon_receive?coupon_type_id="+this.couponTypeId;return this.memberId&&(n+="&source_member="+this.memberId),{title:t,path:n,success:function(e){},fail:function(e){}}}};t.default=n}).call(this,n(1)["default"])},478:function(e,t,n){"use strict";n.r(t);var o=n(479),i=n.n(o);for(var c in o)"default"!==c&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},479:function(e,t,n){}},[[472,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages_tool/goods/coupon_receive.js.map