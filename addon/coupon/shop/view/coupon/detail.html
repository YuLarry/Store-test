{extend name="app/shop/view/base.html"/}
{block name="resources"}
<link rel="stylesheet" href="STATIC_CSS/promotion_detail.css">
{/block}
{block name="main"}

<div class="layui-card card-common card-brief">
    <div class="layui-card-header">
        <div>
            <span class="card-title">基本信息</span>
        </div>
    </div>
    <div class="layui-card-body">
        <div class="promotion-view">
            <div class="promotion-view-item">
                <label>优惠券名称：</label>
                <span>{$info.coupon_name}</span>
            </div>
            <div class="promotion-view-item">
                <label>优惠券类型：</label>
                <span>{if $info.type == 'reward'} 满减 {else /} 折扣 {/if}</span>
            </div>
            <div class="promotion-view-item">
                <label>{if $info.type == 'reward'} 优惠券面额 {else /} 优惠券折扣 {/if}：</label>
                <span>{if $info.type == 'reward'} ￥ {$info.money} {else /} {$info.discount} 折 {/if}</span>
            </div>
            {if $info.type == 'discount'}
                {if $info.discount_limit != 0}
                    <div class="promotion-view-item">
                        <label>最多优惠：</label>
                        <span>￥ {$info.discount_limit}</span>
                    </div>
                {/if}
            {/if}

            <div class="promotion-view-item">
                <label>发放数量：</label>
                <span>
                     {if $info.count > 0 }
                        {$info.count} 张
                    {else /}
                        无限制
                    {/if}
                </span>
            </div>
            <div class="promotion-view-item">
                <label>最大领取数量：</label>
                <span>{$info.max_fetch} 张</span>
            </div>
            <div class="promotion-view-item">
                <label>使用门槛：</label>
                <span>{$info.at_least} 元</span>
            </div>
            <div class="promotion-view-item">
                <label>有效期：</label>
                <span>
                    {if $info.validity_type == 0}
                        {:date('Y-m-d H:i:s',$info.end_time)}
                    {else /}
                        领取之日起 {$info.fixed_term} 天有效
                    {/if}
                </span>
            </div>

            {if $info.goods_type == 1}
                <div class="promotion-view-item">
                    <label>活动商品：</label>
                    <span>全部商品参与</span>
                </div>

            {/if}
        </div>
        <div class="promotion-view">
            <div class="promotion-view-item-line">
                <label class="promotion-view-item-custom-label">优惠券图片：</label>
                <div class="promotion-view-item-custom-box img-upload">
                    <div class="upload-img-block icon">
                        <div class="upload-img-box" id="couponImg">
                            {if condition="$info.image"}
                            <img layer-src src="{:img($info.image)}" />
                            {/if}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="layui-card card-common card-brief">
    <div class="layui-card-header">
        <div>
            <span class="card-title">数据统计</span>
        </div>
    </div>
    <div class="layui-card-body">
        <div class="promotion-stat-view todo-list">
            <div class="promotion-stat-item" >
                <div class="promotion-stat-item-title">发放数</div>
                <div class="promotion-stat-item-value">{$info.count}</div>
            </div>
            <div class="promotion-stat-item" >
                <div class="promotion-stat-item-title">领取数</div>
                <div class="promotion-stat-item-value">{$info.lead_count}</div>
            </div>

            <div class="promotion-stat-item" >
                <div class="promotion-stat-item-title">使用数</div>
                <div class="promotion-stat-item-value">{$info.used_count}</div>
            </div>
        </div>
    </div>
</div>

{if $info.goods_type != 1}
<div class="layui-card card-common card-brief">
    <div class="layui-card-header">
        <div>
            <span class="card-title">活动商品</span>
        </div>
    </div>
    <div class="layui-card-body">
        <div class='promotion-view-list'>
            <table id="promotion_list"></table>
        </div>
    </div>
</div>
{/if}

{/block}
{block name="script"}
<script type='text/html'id="promotion_list_item_box_html">
    <div class="promotion-list-item-title">
        <div class="promotion-list-item-title-icon">
            <img src="{{ ns.img(d.goods_image) }}" alt="">
        </div>
        <p class="promotion-list-item-title-name multi-line-hiding">{{ d.goods_name }}</p>
    </div>
</script>
<script>
    var promotion_list = {:json_encode($info.goods_list, JSON_UNESCAPED_UNICODE)};
    layui.use('table', function() {
        new Table({
            elem: '#promotion_list',
            cols: [
                [{
                    field: 'goods_name',
                    title: '商品名称',
                    unresize: 'false',
                    width: '60%',
                    templet: '#promotion_list_item_box_html'
                }, {
                    field: 'price',
                    title: '商品价格(元)',
                    unresize: 'false',
                    align: 'right',
                    width: '20%',
                    templet: function(data) {
                        return '￥' + data.price;
                    }
                }, {
                    field: 'goods_stock',
                    title: '库存',
                    unresize: 'false',
                    align: 'center',
                    width: '20%'
                }],
            ],
            data: promotion_list
        });
    });
</script>
{/block}